<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>Gabbleblotchits</title><link>https://blog.luizirber.org/</link><description>Vogon Poetry, Computers and (some) biology</description><lastBuildDate>Fri, 24 Jul 2020 12:00:00 -0300</lastBuildDate><item><title>MinHashing all the things: a quick analysis of MAG search results</title><link>https://blog.luizirber.org/2020/07/24/mag-results/</link><description>&lt;p&gt;&lt;a href="https://blog.luizirber.org/2020/07/22/mag-search/"&gt;Last time&lt;/a&gt; I described a way to search MAGs in metagenomes, 
and teased about interesting results.
Let's dig in some of them!&lt;/p&gt;
&lt;p&gt;I prepared a &lt;a href="https://github.com/luizirber/2020-07-22-mag-search/"&gt;repo&lt;/a&gt; with the data and a notebook with the analysis I did in this
post.
You can also follow along in &lt;a href="https://mybinder.org"&gt;Binder&lt;/a&gt;,
as well as do your own analysis! &lt;a href="https://mybinder.org/v2/gh/luizirber/2020-07-22-mag-search/master?filepath=index.ipynb"&gt;&lt;img alt="Binder" src="https://mybinder.org/badge_logo.svg"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Preparing some metadata&lt;/h2&gt;
&lt;p&gt;The supplemental materials for &lt;a href="https://www.nature.com/articles/sdata2017203"&gt;Tully et al&lt;/a&gt; include more details about each MAG,
so let's download them.
I prepared a small snakemake workflow to do that,
as well as downloading information about the SRA datasets from Tara Oceans
(the dataset used to generate the MAGs),
as well as from &lt;a href="https://www.nature.com/articles/s41564-017-0012-7"&gt;Parks et al&lt;/a&gt;,
which also generated MAGs from Tara Oceans.
Feel free to include them in your analysis,
but I was curious to find matches in other metagenomes.&lt;/p&gt;
&lt;h2&gt;Loading the data&lt;/h2&gt;
&lt;p&gt;The results from the MAG search are in a CSV file,
with a column for the MAG name,
another for the SRA dataset ID for the metagenome and a third column for the
containment of the MAG in the metagenome.
I also fixed the names to make it easier to query,
and finally removed the Tara and Parks metagenomes
(because we already knew they contained these MAGs).&lt;/p&gt;
&lt;p&gt;This left us with 23,644 SRA metagenomes with matches,
covering 2,291 of the 2,631 MAGs.
These are results for a fairly low containment (10%),
so if we limit to MAGs with more than 50% containment we still have 1,407 MAGs and 2,938 metagenomes left.&lt;/p&gt;
&lt;h2&gt;TOBG_NP-110, I choose you!&lt;/h2&gt;
&lt;p&gt;That's still a lot,
so I decided to pick a candidate to check before doing any large scale analysis.
I chose TOBG_NP-110 because there were many matches above 50% containment,
and even some at 99%.
Turns out it is also an Archaeal MAG that failed to be classified further than Phylum level (Euryarchaeota),
with a 70.3% complete score in the original analysis.
Oh, let me dissect the name a bit:
TOBG is "Tara Ocean Binned Genome" and "NP" is North Pacific.&lt;/p&gt;
&lt;p&gt;And so I went checking where the other metagenome matches came from.
5 of the 12 matches above 50% containment come from one study,
&lt;a href="https://trace.ncbi.nlm.nih.gov/Traces/sra/?study=SRP044185"&gt;SRP044185&lt;/a&gt;,
with samples collected from a column of water in a station in Manzanillo, Mexico.
Other 3 matches come from 
&lt;a href="https://trace.ncbi.nlm.nih.gov/Traces/sra/?study=SRP003331"&gt;SRP003331&lt;/a&gt;,
in the South Pacific ocean (in northern Chile).
Another match,
&lt;a href="https://trace.ncbi.nlm.nih.gov/Traces/sra/?run=ERR3256923"&gt;ERR3256923&lt;/a&gt;,
also comes from the South Pacific.&lt;/p&gt;
&lt;h2&gt;What else can I do?&lt;/h2&gt;
&lt;p&gt;I'm curious to follow &lt;a href="http://merenlab.org/data/refining-mags/"&gt;the refining MAGs&lt;/a&gt; tutorial from the Meren Lab and see where this goes,
and especially in using &lt;a href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-020-02066-4"&gt;&lt;code&gt;spacegraphcats&lt;/code&gt;&lt;/a&gt;
to extract neighborhoods from the MAG and better evaluate what is missing or if there are other interesting bits that
the MAG generation methods ended up discarding.&lt;/p&gt;
&lt;p&gt;So, for now that's it.
But more important,
I didn't want to sit on these results until there is a publication in press,
especially when there are people that can do so much more with these them,
so I decided to make it all public.
It is way more exciting to see this being used to know more about these
organisms than me being the only one with access to this info.&lt;/p&gt;
&lt;p&gt;And yesterday I saw &lt;a href="https://twitter.com/DrJonathanRosa/status/1286381346605027328"&gt;this tweet&lt;/a&gt; by
&lt;a href="https://twitter.com/DrJonathanRosa/status/1286381346605027328"&gt;@DrJonathanRosa&lt;/a&gt;,
saying:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I don’t know who told students that the goal of research is to find some
previously undiscovered research topic, claim individual ownership over it,
&amp;amp; fiercely protect it from theft, but that almost sounds like, well,
colonialism, capitalism, &amp;amp; policing &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Amen.&lt;/p&gt;
&lt;h2&gt;I want to run this with my data!&lt;/h2&gt;
&lt;p&gt;Next time. But we will have a discussion about scientific infrastructure and
sustainability first =]&lt;/p&gt;
&lt;h2&gt;Comments?&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://twitter.com/luizirber/status/1286700888111738880"&gt;Thread on Twitter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Fri, 24 Jul 2020 12:00:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2020-07-24:/2020/07/24/mag-results/</guid><category>science</category><category>bioinformatics</category><category>rust</category></item><item><title>MinHashing all the things: searching for MAGs in the SRA</title><link>https://blog.luizirber.org/2020/07/22/mag-search/</link><description>&lt;p&gt;(or: Top-down and bottom-up approaches for working around sourmash limitations)&lt;/p&gt;
&lt;p&gt;In the last month I updated &lt;a href="https://wort.oxli.org"&gt;wort&lt;/a&gt;,
the system I developed for computing sourmash signature for public genomic databases,
and started calculating signatures
for the &lt;a href="https://www.ncbi.nlm.nih.gov/sra/?term=%22METAGENOMIC%22%5Bsource%5D+NOT+amplicon%5BAll+Fields%5D)"&gt;metagenomes&lt;/a&gt; in the &lt;a href="https://www.ncbi.nlm.nih.gov/sra/"&gt;Sequence Read Archive&lt;/a&gt;.
This is a more challenging subset than the &lt;a href="https://blog.luizirber.org/2016/12/28/soursigs-arch-1/"&gt;microbial datasets&lt;/a&gt; I was doing previously, 
since there are around 534k datasets from metagenomic sources in the SRA,
totalling 447 TB of data.
Another problem is the size of the datasets,
ranging from a couple of MB to 170 GB.
Turns out that the workers I have in &lt;code&gt;wort&lt;/code&gt; are very good for small-ish datasets,
but I still need to figure out how to pull large datasets faster from the SRA,
because the large ones take forever to process...&lt;/p&gt;
&lt;p&gt;The good news is that I managed to calculate signatures for almost 402k of them
&lt;sup id=sf-mag-search-1-back&gt;&lt;a href=#sf-mag-search-1 class=simple-footnote title="pulling about a 100 TB in 3 days, which was pretty fun to see because I ended up DDoS myself because I couldn't download the generated sigs fast enough from the S3 bucket where they are temporarily stored =P"&gt;1&lt;/a&gt;&lt;/sup&gt;,
which already let us work on some pretty exciting problems =]&lt;/p&gt;
&lt;h2&gt;Looking for MAGs in the SRA&lt;/h2&gt;
&lt;p&gt;Metagenome-assembled genomes are essential for studying organisms that are hard to isolate and culture in lab,
especially for environmental metagenomes.
&lt;a href="https://www.nature.com/articles/sdata2017203"&gt;Tully et al&lt;/a&gt; published 2,631 draft MAGs from 234 samples collected during the Tara Oceans expedition,
and I wanted to check if they can also be found in other metagenomes besides the Tara Oceans ones.
The idea is to extract the reads from these other matches and evaluate how the MAG can be improved,
or at least evaluate what is missing in them.
I choose to use environmental samples under the assumption they are easier to deposit on the SRA and have public access,
but there are many human gut microbiomes in the SRA and this MAG search would work just fine with those too.&lt;/p&gt;
&lt;p&gt;Moreover,
I want to search for containment,
and not similarity.
The distinction is subtle,
but similarity takes into account both datasets sizes
(well, the size of the union of all elements in both datasets),
while containment only considers the size of the query.
This is relevant because the similarity of a MAG and a metagenome is going to be very small (and is symmetrical),
but the containment of the MAG in the metagenome might be large
(and is asymmetrical, since the containment of the metagenome in the MAG is likely very small because the metagenome is so much larger than the MAG).&lt;/p&gt;
&lt;h2&gt;The computational challenge: indexing and searching&lt;/h2&gt;
&lt;p&gt;sourmash signatures are a small fraction of the original size of the datasets,
but when you have hundreds of thousands of them the collection ends up being pretty large too.
More precisely, 825 GB large.
That is way bigger than any index I ever built for sourmash,
and it would also have pretty distinct characteristics than what we usually do: 
we tend to index genomes and run &lt;code&gt;search&lt;/code&gt; (to find similar genomes) or &lt;code&gt;gather&lt;/code&gt;
(to decompose metagenomes into their constituent genomes),
but for this MAG search I want to find which metagenomes have my MAG query above a certain containment threshold.
Sort of a &lt;code&gt;sourmash search --containment&lt;/code&gt;,
but over thousands of metagenome signatures.
The main benefit of an SBT index in this context is to avoid checking all signatures because we can prune the search early,
but currently SBT indices need to be totally loaded in memory during &lt;code&gt;sourmash index&lt;/code&gt;.
I will have to do this in the medium term,
but I want a solution NOW! =]&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/dib-lab/sourmash/releases/tag/v3.4.0"&gt;sourmash 3.4.0&lt;/a&gt; introduced &lt;code&gt;--from-file&lt;/code&gt; in many commands,
and since I can't build an index I decided to use it to load signatures for the metagenomes.
But... &lt;code&gt;sourmash search&lt;/code&gt; tries to load all signatures in memory,
and while I might be able to find a cluster machine with hundreds of GBs of RAM available, 
that's not very practical.&lt;/p&gt;
&lt;p&gt;So, what to do?&lt;/p&gt;
&lt;h2&gt;The top-down solution: a snakemake workflow&lt;/h2&gt;
&lt;p&gt;I don't want to modify sourmash now,
so why not make a workflow and use snakemake to run one &lt;code&gt;sourmash search --containment&lt;/code&gt; for each metagenome?
That means 402k tasks,
but at least I can use &lt;a href="https://snakemake.readthedocs.io/en/stable/executing/cli.html#dealing-with-very-large-workflows"&gt;batches&lt;/a&gt; and &lt;a href="https://slurm.schedmd.com/job_array.html"&gt;SLURM job arrays&lt;/a&gt; to submit reasonably-sized jobs to our HPC queue.
After running all batches I summarized results for each task,
and it worked well for a proof of concept.&lt;/p&gt;
&lt;p&gt;But... it was still pretty resource intensive:
each task was running one query MAG against one metagenome,
and so each task needed to do all the overhead of starting the Python interpreter and parsing the query signature,
which is exactly the same for all tasks.
Extending it to support multiple queries to the same metagenome would involve duplicating tasks,
and 402k metagenomes times 2,631 MAGs is...
a very large number of jobs.&lt;/p&gt;
&lt;p&gt;I also wanted to avoid clogging the job queues,
which is not very nice to the other researchers using the cluster.
This limited how many batches I could run in parallel...&lt;/p&gt;
&lt;h2&gt;The bottom-up solution: Rust to the rescue!&lt;/h2&gt;
&lt;p&gt;Thinking a bit more about the problem,
here is another solution:
what if we load all the MAGs in memory
(as they will be queried frequently and are not that large),
and then for each metagenome signature load it,
perform all MAG queries,
and then unload the metagenome signature from memory?
This way we can control memory consumption
(it's going to be proportional to all the MAG sizes plus the size of the largest metagenome)
and can also efficiently parallelize the code because each task/metagenome is independent
and the MAG signatures can be shared freely (since they are read-only).&lt;/p&gt;
&lt;p&gt;This could be done with the sourmash Python API plus &lt;code&gt;multiprocessing&lt;/code&gt; or some
other parallelization approach (maybe dask?),
but turns out that everything we need comes from the Rust API.
Why not enjoy a bit of the &lt;a href="https://doc.rust-lang.org/stable/book/ch16-00-concurrency.html"&gt;fearless concurrency&lt;/a&gt; that is one of the major Rust goals?&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/luizirber/phd/blob/aa1ed9eb33ba71fdf9b3f2c92931701be6df00cd/experiments/wort/sra_search/src/main.rs"&gt;The whole code&lt;/a&gt; ended up being 176 lines long,
including command line parsing using &lt;a href="https://docs.rs/structopt/latest/structopt/"&gt;strucopt&lt;/a&gt; and parallelizing the search using &lt;a href="https://docs.rs/rayon/latest/rayon/"&gt;rayon&lt;/a&gt;
and a &lt;a href="https://doc.rust-lang.org/std/sync/mpsc/fn.channel.html"&gt;multiple-producer, single-consumer channel&lt;/a&gt; to write results to an output
(either the terminal or a file).
This version took 11 hours to run,
using less than 5GB of RAM and 32 processors,
to search 2k MAGs against 402k metagenomes.
And, bonus! It can also be parallelized again if you have multiple machines,
so it potentially takes a bit more than an hour to run if you can allocate 10 batch jobs,
with each batch 1/10 of the metagenome signatures.&lt;/p&gt;
&lt;h2&gt;So, is bottom-up always the better choice?&lt;/h2&gt;
&lt;p&gt;I would like to answer "Yes!",
but bioinformatics software tends to be organized as command line interfaces,
not as libraries.
Libraries also tend to have even less documentation than CLIs,
and this particular case is not a fair comparison because...
Well, I wrote most of the library,
and the Rust API is not that well documented for general use.&lt;/p&gt;
&lt;p&gt;But I'm pretty happy with how the sourmash CLI is viable both for the top-down approach
(and whatever workflow software you want to use) as well as how the Rust core worked for the bottom-up approach.
I think the most important is having the option to choose which way to go,
especially because now I can use the bottom-up approach to make the sourmash CLI
and Python API better.
The top-down approach is also way more accessible in general,
because you can pick your favorite workflow software and use all the tricks you're comfortable with.&lt;/p&gt;
&lt;h2&gt;But, what about the results?!?!?!&lt;/h2&gt;
&lt;p&gt;Next time. But I did find MAGs with over 90% containment in very different locations,
which is pretty exciting!&lt;/p&gt;
&lt;p&gt;I also need to find a better way of distributing all these signature,
because storing 4 TB of data in S3 is somewhat cheap,
but transferring data is very expensive.
All signatures are also available on IPFS,
but I need more people to host them and share.
Get in contact if you're interested in helping =]&lt;/p&gt;
&lt;p&gt;And while I'm asking for help,
any tips on pulling data faster from the SRA are greatly appreciated!&lt;/p&gt;
&lt;h2&gt;Comments?&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://twitter.com/luizirber/status/1285782732790849537"&gt;Thread on Twitter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;section class=footnotes&gt;&lt;hr&gt;&lt;h2&gt;Footnotes&lt;/h2&gt;&lt;ol&gt;&lt;li id=sf-mag-search-1&gt;&lt;p&gt;pulling about a 100 TB in 3 days, which was pretty fun to see because I
ended up DDoS myself because I couldn't download the generated sigs fast enough
from the S3 bucket where they are temporarily stored =P &lt;a href=#sf-mag-search-1-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/section&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Wed, 22 Jul 2020 12:00:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2020-07-22:/2020/07/22/mag-search/</guid><category>science</category><category>bioinformatics</category><category>rust</category></item><item><title>Putting it all together</title><link>https://blog.luizirber.org/2020/05/11/sbt-zip/</link><description>&lt;p&gt;sourmash &lt;a href="https://twitter.com/ctitusbrown/status/1257418140729868291"&gt;3.3&lt;/a&gt; was released last week,
and it is the first version supporting &lt;a href="http://ivory.idyll.org/blog/2020-sourmash-databases-as-zip-files.html"&gt;zipped databases&lt;/a&gt;.
Here is my personal account of how that came to be =]&lt;/p&gt;
&lt;h2&gt;What is a sourmash database?&lt;/h2&gt;
&lt;p&gt;A sourmash database contains signatures (typically Scaled MinHash sketches built from genomic datasets) and
an index for allowing efficient similarity and containment queries over these signatures.
The two types of index are SBT,
a hierarchical index that uses less memory by keeping data on disk,
and LCA,
an inverted index that uses more memory but is potentially faster.
Indices are described as JSON files,
with LCA storing all the data in one JSON file and SBT opting for saving a description of the index structure in JSON,
and all the data into a hidden directory with many files.&lt;/p&gt;
&lt;p&gt;We distribute some &lt;a href="https://sourmash.readthedocs.io/en/v3.3.0/databases.html"&gt;prepared databases&lt;/a&gt; (with SBT indices) for Genbank and RefSeq as compressed TAR files.
The compressed file is ~8GB,
but after decompressing it turns into almost 200k files in a hidden directory,
using about 40 GB of disk space.&lt;/p&gt;
&lt;h2&gt;Can we avoid generating so many hidden files?&lt;/h2&gt;
&lt;p&gt;The initial issue in this saga is &lt;a href="https://github.com/dib-lab/sourmash/issues/490"&gt;dib-lab/sourmash#490&lt;/a&gt;,
and the idea was to take the existing support for multiple data storages
(hidden dir,
TAR files,
IPFS and Redis) and save the index description in the storage,
allowing loading everything from the storage.
Since we already had the databases as TAR files,
the first test tried to use them but it didn't take long to see it was a doomed approach:
TAR files are terrible from random access
(or at least the &lt;code&gt;tarfile&lt;/code&gt; module in Python is).&lt;/p&gt;
&lt;p&gt;Zip files showed up as a better alternative,
and it helps that Python has the &lt;code&gt;zipfile&lt;/code&gt; module already available in the
standard library.
Initial tests were promising,
and led to &lt;a href="https://github.com/dib-lab/sourmash/pull/648"&gt;dib-lab/sourmash#648&lt;/a&gt;.
The main issue was performance:
compressing and decompressing was slow,
but there was also another limitation...&lt;/p&gt;
&lt;h2&gt;Loading Nodegraphs from a memory buffer&lt;/h2&gt;
&lt;p&gt;Another challenge was efficiently loading the data from a storage.
The two core methods in a storage are &lt;code&gt;save(location, content)&lt;/code&gt;,
where &lt;code&gt;content&lt;/code&gt; is a bytes buffer,
and &lt;code&gt;load(location)&lt;/code&gt;,
which returns a bytes buffer that was previously saved.
This didn't interact well with the &lt;code&gt;khmer&lt;/code&gt; &lt;code&gt;Nodegraph&lt;/code&gt;s (the Bloom Filter we use for SBTs),
since &lt;code&gt;khmer&lt;/code&gt; only loads data from files,
not from memory buffers.
We ended up doing a temporary file dance,
which made things slower for the default storage (hidden dir),
where it could have been optimized to work directly with files,
and involved interacting with the filesystem for the other storages
(IPFS and Redis could be pulling data directly from the network,
for example).&lt;/p&gt;
&lt;p&gt;This one could be fixed in &lt;code&gt;khmer&lt;/code&gt; by exposing C++ stream methods,
and I did a &lt;a href="https://github.com/luizirber/2018-cython-streams"&gt;small PoC&lt;/a&gt; to test the idea.
While doable,
this is something that was happening while the sourmash conversion to Rust was underway,
and depending on &lt;code&gt;khmer&lt;/code&gt; was a problem for my Webassembly aspirations...
so,
having the Nodegraph &lt;a href="https://github.com/luizirber/sourmash-rust/pull/15"&gt;implemented in Rust&lt;/a&gt; seemed like a better direction,
That has actually been quietly living in the sourmash codebase for quite some time,
but it was never exposed to the Python (and it was also lacking more extensive
tests).&lt;/p&gt;
&lt;p&gt;After the release of sourmash 3 and the replacement of the C++ for the Rust implementation,
all the pieces for exposing the Nodegraph where in place,
so &lt;a href="https://github.com/dib-lab/sourmash/pull/799"&gt;dib-lab/sourmash#799&lt;/a&gt; was the next step.
It wasn't a priority at first because other optimizations
(that were released in 3.1 and 3.2)
were more important,
but then it was time to check how this would perform.
And...&lt;/p&gt;
&lt;h2&gt;Your Rust code is not so fast, huh?&lt;/h2&gt;
&lt;p&gt;Turns out that my Nodegraph loading code was way slower than &lt;code&gt;khmer&lt;/code&gt;.
The Nodegraph binary format &lt;a href="https://khmer.readthedocs.io/en/latest/dev/binary-file-formats.html#nodegrap://khmer.readthedocs.io/en/latest/dev/binary-file-formats.html#nodegraph"&gt;is well documented&lt;/a&gt;,
and doing an initial implementation wasn't so hard by using the &lt;code&gt;byteorder&lt;/code&gt; crate
to read binary data with the right endianess,
and then setting the appropriate bits in the internal &lt;code&gt;fixedbitset&lt;/code&gt; in memory.
But the khmer code doesn't parse bit by bit:
it &lt;a href="https://github.com/dib-lab/khmer/blob/fe0ce116456b296c522ba24294a0cabce3b2648b/src/oxli/storage.cc#L233"&gt;reads&lt;/a&gt; a long &lt;code&gt;char&lt;/code&gt; buffer directly,
and that is many orders of magnitude faster than setting bit by bit.&lt;/p&gt;
&lt;p&gt;And there was no way to replicate this behavior directly with &lt;code&gt;fixedbitset&lt;/code&gt;.
At this point I could either bit-indexing into a large buffer
and lose all the useful methods that &lt;code&gt;fixedbitset&lt;/code&gt; provides,
or try to find a way to support loading the data directly into &lt;code&gt;fixedbitset&lt;/code&gt; and
open a PR.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/petgraph/fixedbitset/pull/42"&gt;I chose the PR&lt;/a&gt; (and even got #42! =]).&lt;/p&gt;
&lt;p&gt;It was more straightforward than I expected,
but it did expose the internal representation of &lt;code&gt;fixedbitset&lt;/code&gt;,
so I was a bit nervous it wasn't going to be merged.
But &lt;a href="https://github.com/bluss"&gt;bluss&lt;/a&gt; was super nice,
and his suggestions made the PR way better!
This &lt;a href="https://github.com/dib-lab/sourmash/blob/9a695fb03b99c060bb8d1384ab78bb3797c5eb65/src/core/src/sketch/nodegraph.rs#L235L261"&gt;simplified&lt;/a&gt; the final &lt;code&gt;Nodegraph&lt;/code&gt; code,
and actually was more correct
(because I was messing a few corner cases when doing the bit-by-bit parsing before).
Win-win!&lt;/p&gt;
&lt;h2&gt;Nodegraphs are kind of large, can we compress them?&lt;/h2&gt;
&lt;p&gt;Being able to save and load &lt;code&gt;Nodegraph&lt;/code&gt;s in Rust allowed using memory buffers,
but also opened the way to support other operations not supported in khmer &lt;code&gt;Nodegraph&lt;/code&gt;s.
One example is loading/saving compressed files,
which is supported for &lt;code&gt;Countgraph&lt;/code&gt;
(another khmer data structure,
based on Count-Min Sketch)
but not in &lt;code&gt;Nodegraph&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;If only there was an easy way to support working with compressed files...&lt;/p&gt;
&lt;p&gt;Oh wait, there is! &lt;a href="https://github.com/luizirber/niffler"&gt;niffler&lt;/a&gt; is a crate that I made with &lt;a href="https://twitter.com/pierre_marijon"&gt;Pierre Marijon&lt;/a&gt; based
on some functionality I saw in one of his projects,
and we iterated a bit on the API and documented everything to make it more
useful for a larger audience.
&lt;code&gt;niffler&lt;/code&gt; tries to be as transparent as possible,
with very little boilerplate when using it but with useful features nonetheless
(like auto detection of the compression format).
If you want more about the motivation and how it happened,
check this &lt;a href="https://twitter.com/luizirber/status/1253445504622424064"&gt;Twitter thread&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The cool thing is that adding compressed files support in &lt;code&gt;sourmash&lt;/code&gt; was mostly
&lt;a href="https://github.com/dib-lab/sourmash/pull/799/files#diff-313a7ff0fdb14f408a64b3f010f46f65R220"&gt;one-line changes&lt;/a&gt; for loading
(and &lt;a href="https://github.com/dib-lab/sourmash/pull/648/files#diff-d80ae1dd777d07300d7b6066b3318397L249-R273"&gt;a bit more&lt;/a&gt; for saving,
but mostly because converting compression levels could use some refactoring).&lt;/p&gt;
&lt;h2&gt;Putting it all together: zipped SBT indices&lt;/h2&gt;
&lt;p&gt;With all these other pieces in places,
it's time to go back to &lt;a href="https://github.com/dib-lab/sourmash/pull/648"&gt;dib-lab/sourmash#648&lt;/a&gt;.
Compressing and decompressing with the Python &lt;code&gt;zipfile&lt;/code&gt; module is slow,
but Zip files can also be used just for storage,
handing back the data without extracting it.
And since we have compression/decompression implemented in Rust with &lt;code&gt;niffler&lt;/code&gt;,
that's what the zipped sourmash databases are:
data is loaded and saved into the Zip file without using the Python module
compression/decompression,
and all the work is done before (or after) in the Rust side.&lt;/p&gt;
&lt;p&gt;This allows keeping the Zip file with similar sizes to the original TAR files we started with,
but with very low overhead for decompression.
For compression we opted for using Gzip level 1,
which doesn't compress perfectly but also doesn't take much longer to run:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Level&lt;/th&gt;
&lt;th&gt;Size&lt;/th&gt;
&lt;th&gt;Time&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;407 MB&lt;/td&gt;
&lt;td&gt;16s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;252 MB&lt;/td&gt;
&lt;td&gt;21s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;250 MB&lt;/td&gt;
&lt;td&gt;39s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;246 MB&lt;/td&gt;
&lt;td&gt;1m48s&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;In this table, &lt;code&gt;0&lt;/code&gt; is without compression,
while &lt;code&gt;9&lt;/code&gt; is the best compression.
The size difference from &lt;code&gt;1&lt;/code&gt; to &lt;code&gt;9&lt;/code&gt; is only 6 MB (~2% difference)
but runs 5x faster,
and it's only 30% slower than saving the uncompressed data.&lt;/p&gt;
&lt;p&gt;The last challenge was updating an existing Zip file.
It's easy to support appending new data,
but if any of the already existing data in the file changes
(which happens when internal nodes change in the SBT,
after a new dataset is inserted) then there is no easy way to replace the data in the Zip file.
Worse,
the Python &lt;code&gt;zipfile&lt;/code&gt; will add the new data while keeping the old one around,
leading to ginormous files over time&lt;sup id=sf-sbt-zip-1-back&gt;&lt;a href=#sf-sbt-zip-1 class=simple-footnote title="The zipfile module does throw a UserWarning pointing that duplicated files were inserted, which is useful during development but generally doesn't show during regular usage..."&gt;1&lt;/a&gt;&lt;/sup&gt;
So, what to do?&lt;/p&gt;
&lt;p&gt;I ended up opting for dealing with the complexity and &lt;a href="https://github.com/dib-lab/sourmash/pull/648/files#diff-a99b088adcc872e1b408fbdcca20ebebR110-R248"&gt;complicating the ZipStorage&lt;/a&gt; implementation a bit,
by keeping a buffer for new data.
If it's a new file or it already exists but there are no insertions
the buffer is ignored and all works as before.&lt;/p&gt;
&lt;p&gt;If the file exists and new data is inserted,
then it is first stored in the buffer
(where it might also replace a previous entry with the same name).
In this case we also need to check the buffer when trying to load some data
(because it might exist only in the buffer,
and not in the original file).&lt;/p&gt;
&lt;p&gt;Finally,
when the &lt;code&gt;ZipStorage&lt;/code&gt; is closed it needs to verify if there are new items in the buffer.
If not,
it is safe just to close the original file.
If there are new items but they were not present in the original file,
then we can append the new data to the original file.
The final case is if there are new items that were also in the original file,
and in this case a new Zip file is created and all the content from buffer and
original file are copied to it,
prioritizing items from the buffer.
The original file is replaced by the new Zip file.&lt;/p&gt;
&lt;p&gt;Turns out this worked quite well! And so the PR was merged =]&lt;/p&gt;
&lt;h2&gt;The future&lt;/h2&gt;
&lt;p&gt;Zipped databases open the possibility of distributing extra data that might be
useful for some kinds of analysis.
One thing we are already considering is adding &lt;a href="https://github.com/dib-lab/sourmash/issues/969"&gt;taxonomy information&lt;/a&gt;,
let's see what else shows up.&lt;/p&gt;
&lt;p&gt;Having &lt;code&gt;Nodegraph&lt;/code&gt; in Rust is also pretty exciting,
because now we can change the internal representation for something that uses
less memory (maybe using &lt;a href="https://alexbowe.com/rrr/"&gt;RRR encoding&lt;/a&gt;?),
but more importantly:
now they can also be used with Webassembly,
which opens many possibilities for running not only &lt;a href="https://blog.luizirber.org/2018/08/27/sourmash-wasm/"&gt;signature computation&lt;/a&gt; but
also &lt;code&gt;search&lt;/code&gt; and &lt;code&gt;gather&lt;/code&gt; in the browser,
since now we have all the pieces to build it.&lt;/p&gt;
&lt;h2&gt;Comments?&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://twitter.com/luizirber/status/1260031886744621059"&gt;Thread on Twitter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;section class=footnotes&gt;&lt;hr&gt;&lt;h2&gt;Footnotes&lt;/h2&gt;&lt;ol&gt;&lt;li id=sf-sbt-zip-1&gt;&lt;p&gt;The &lt;code&gt;zipfile&lt;/code&gt; module does throw a &lt;code&gt;UserWarning&lt;/code&gt; pointing that duplicated files were inserted,
which is useful during development but generally doesn't show during regular usage... &lt;a href=#sf-sbt-zip-1-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/section&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Mon, 11 May 2020 12:00:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2020-05-11:/2020/05/11/sbt-zip/</guid><category>science</category><category>bioinformatics</category><category>rust</category></item><item><title>Oxidizing sourmash: PR walkthrough</title><link>https://blog.luizirber.org/2020/01/10/sourmash-pr/</link><description>&lt;p&gt;sourmash 3 was released last week,
finally landing the Rust backend.
But, what changes when developing new features in sourmash?
I was thinking about how to best document this process,
and since &lt;a href="https://github.com/dib-lab/sourmash/pull/826/files"&gt;PR #826&lt;/a&gt; is a short example touching all the layers I decided to do a
small walkthrough.&lt;/p&gt;
&lt;p&gt;Shall we?&lt;/p&gt;
&lt;h2&gt;The problem&lt;/h2&gt;
&lt;p&gt;The first step is describing the problem,
and trying to convince reviewers (and yourself) that the changes bring enough benefits to justify a merge.
This is the description I put in the PR:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Calling &lt;code&gt;.add_hash()&lt;/code&gt; on a MinHash sketch is fine,
but if you're calling it all the time it's better to pass a list of hashes and call &lt;code&gt;.add_many()&lt;/code&gt; instead.
Before this PR &lt;code&gt;add_many&lt;/code&gt; just called &lt;code&gt;add_hash&lt;/code&gt; for each hash it was passed,
but now it will pass the full list to Rust (and that's way faster).&lt;/p&gt;
&lt;p&gt;No changes for public APIs,
and I changed the &lt;code&gt;_signatures&lt;/code&gt; method in LCA to accumulate hashes for each sig first,
and then set them all at once.
This is way faster,
but might use more intermediate memory (I'll evaluate this now).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There are many details that sound like jargon for someone not familiar with the codebase,
but if I write something too long I'll probably be wasting the reviewers time too.
The benefit of a very detailed description is extending the knowledge for other people
(not necessarily the maintainers),
but that also takes effort that might be better allocated to solve other problems.
Or, more realistically, putting out other fires =P&lt;/p&gt;
&lt;p&gt;Nonetheless,
some points I like to add in PR descriptions:
- why is there a problem with the current approach?
- is this the minimal viable change, or is it trying to change too many things
  at once? The former is way better, in general.
- what are the trade-offs? This PR is using more memory to lower the runtime,
  but I hadn't measure it yet when I opened it.
- Not changing public APIs is always good to convince reviewers.
  If the project follows a &lt;a href="https://semver.org/"&gt;semantic versioning&lt;/a&gt; scheme,
  changes to the public APIs are major version bumps,
  and that can brings other consequences for users.&lt;/p&gt;
&lt;h2&gt;Setting up for changing code&lt;/h2&gt;
&lt;p&gt;If this was a bug fix PR,
the first thing I would do is write a new test triggering the bug,
and then proceed to fix it in the code
(Hmm, maybe that would be another good walkthrough?).
But this PR is making performance claims ("it's going to be faster"),
and that's a bit hard to codify in tests.
&lt;sup id=sf-sourmash-pr-1-back&gt;&lt;a href=#sf-sourmash-pr-1 class=simple-footnote title="We do have https://asv.readthedocs.io/ set up for micro-benchmarks, and now that I think about it... I could have started by writing a benchmark for add_many, and then showing that it is faster. I will add this approach to the sourmash PR checklist =]"&gt;1&lt;/a&gt;&lt;/sup&gt;
Since it's also proposing to change a method (&lt;code&gt;_signatures&lt;/code&gt; in LCA indices) that is better to benchmark with a real index (and not a toy example),
I used the same data and command I run in &lt;a href="https://github.com/luizirber/sourmash_resources"&gt;sourmash_resources&lt;/a&gt; to check how memory consumption and runtime changed.
For reference, this is the command: &lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sourmash search -o out.csv --scaled &lt;span class=m&gt;2000&lt;/span&gt; -k &lt;span class=m&gt;51&lt;/span&gt; HSMA33OT.fastq.gz.sig genbank-k51.lca.json.gz
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;I'm using the &lt;code&gt;benchmark&lt;/code&gt; feature from &lt;a href="https://snakemake.readthedocs.io/"&gt;snakemake&lt;/a&gt; in &lt;a href="https://github.com/luizirber/sourmash_resources/blob/83ea237397d242e48c9d95eb0d9f50ceb4ad95c7/Snakefile#L99L114"&gt;sourmash_resources&lt;/a&gt; to
track how much memory, runtime and I/O is used for each command (and version) of sourmash,
and generate the plots in the README in that repo.
That is fine for a high-level view ("what's the maximum memory used?"),
but not so useful for digging into details ("what method is consuming most memory?").&lt;/p&gt;
&lt;p&gt;Another additional problem is the dual&lt;sup id=sf-sourmash-pr-2-back&gt;&lt;a href=#sf-sourmash-pr-2 class=simple-footnote title="or triple, if you count C"&gt;2&lt;/a&gt;&lt;/sup&gt; language nature of sourmash,
where we have Python calling into Rust code (via CFFI).
There are great tools for measuring and profiling Python code,
but they tend to not work with extension code...&lt;/p&gt;
&lt;p&gt;So, let's bring two of my favorite tools to help!&lt;/p&gt;
&lt;h3&gt;Memory profiling: heaptrack&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://github.com/KDE/heaptrack"&gt;heaptrack&lt;/a&gt; is a heap profiler, and I first heard about it from &lt;a href="https://www.vincentprouillet.com/"&gt;Vincent Prouillet&lt;/a&gt;.
It's main advantage over other solutions (like valgrind's massif) is the low
overhead and... how easy it is to use:
just stick &lt;code&gt;heaptrack&lt;/code&gt; in front of your command,
and you're good to go!&lt;/p&gt;
&lt;p&gt;Example output:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ heaptrack sourmash search -o out.csv --scaled &lt;span class=m&gt;2000&lt;/span&gt; -k &lt;span class=m&gt;51&lt;/span&gt; HSMA33OT.fastq.gz.sig genbank-k51.lca.json.gz

heaptrack stats:
        allocations:            &lt;span class=m&gt;1379353&lt;/span&gt;
        leaked allocations:     &lt;span class=m&gt;1660&lt;/span&gt;
        temporary allocations:  &lt;span class=m&gt;168984&lt;/span&gt;
Heaptrack finished! Now run the following to investigate the data:

  heaptrack --analyze heaptrack.sourmash.66565.gz
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;heaptrack --analyze&lt;/code&gt; is a very nice graphical interface for analyzing the results,
but for this PR I'm mostly focusing on the Summary page (and overall memory consumption).
Tracking allocations in Python doesn't give many details,
because it shows the CPython functions being called,
but the ability to track into the extension code (Rust) allocations is amazing
for finding bottlenecks (and memory leaks =P).
&lt;sup id=sf-sourmash-pr-3-back&gt;&lt;a href=#sf-sourmash-pr-3 class=simple-footnote title="It would be super cool to have the unwinding code from py-spy in heaptrack, and be able to see exactly what Python methods/lines of code were calling the Rust parts..."&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;h3&gt;CPU profiling: py-spy&lt;/h3&gt;
&lt;p&gt;Just as other solutions exist for profiling memory,
there are many for profiling CPU usage in Python,
including &lt;code&gt;profile&lt;/code&gt; and &lt;code&gt;cProfile&lt;/code&gt; in the standard library.
Again, the issue is being able to analyze extension code,
and bringing the cannon (the &lt;code&gt;perf&lt;/code&gt; command in Linux, for example) looses the
benefit of tracking Python code properly (because we get back the CPython
functions, not what you defined in your Python code).&lt;/p&gt;
&lt;p&gt;Enters &lt;a href="https://github.com/benfred/py-spy"&gt;py-spy&lt;/a&gt; by &lt;a href="https://www.benfrederickson.com"&gt;Ben Frederickson&lt;/a&gt;,
based on the &lt;a href="https://github.com/rbspy/rbspy"&gt;rbspy&lt;/a&gt; project by &lt;a href="https://jvns.ca"&gt;Julia Evans&lt;/a&gt;.
Both use a great idea:
read the process maps for the interpreters and resolve the full stack trace information,
with low overhead (because it uses sampling).
&lt;a href="https://github.com/benfred/py-spy"&gt;py-spy&lt;/a&gt; also goes further and resolves [native Python extensions] stack traces,
meaning we can get the complete picture all the way from the Python CLI to the
Rust core library!&lt;sup id=sf-sourmash-pr-4-back&gt;&lt;a href=#sf-sourmash-pr-4 class=simple-footnote title="Even if py-spy doesn't talk explicitly about Rust, it works very very well, woohoo!"&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;py-spy&lt;/code&gt; is also easy to use:
stick &lt;code&gt;py-spy record --output search.svg -n --&lt;/code&gt; in front of the command, 
and it will generate a flamegraph in &lt;code&gt;search.svg&lt;/code&gt;.
The full command for this PR is&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;py-spy record --output search.svg -n -- sourmash search -o out.csv --scaled &lt;span class=m&gt;2000&lt;/span&gt; -k &lt;span class=m&gt;51&lt;/span&gt; HSMA.fastq.sig genbank-k51.lca.json.gz
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Show me the code!&lt;/h2&gt;
&lt;p&gt;OK, OK, sheesh. But it's worth repeating: the code is important, but there are
many other aspects that are just as important =]&lt;/p&gt;
&lt;h3&gt;Replacing &lt;code&gt;add_hash&lt;/code&gt; calls with one &lt;code&gt;add_many&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Let's start at the &lt;a href="https://github.com/dib-lab/sourmash/pull/826/files#diff-adf06d14c535d5b22da9fb3862e4a487"&gt;&lt;code&gt;_signatures()&lt;/code&gt;&lt;/a&gt; method on LCA indices.
This is the original method:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=nd&gt;@cached_property&lt;/span&gt;
&lt;span class=k&gt;def&lt;/span&gt; &lt;span class=nf&gt;_signatures&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=p&gt;):&lt;/span&gt;
    &lt;span class=s2&gt;"Create a _signatures member dictionary that contains {idx: minhash}."&lt;/span&gt;
    &lt;span class=kn&gt;from&lt;/span&gt; &lt;span class=nn&gt;..&lt;/span&gt; &lt;span class=kn&gt;import&lt;/span&gt; &lt;span class=n&gt;MinHash&lt;/span&gt;

    &lt;span class=n&gt;minhash&lt;/span&gt; &lt;span class=o&gt;=&lt;/span&gt; &lt;span class=n&gt;MinHash&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;n&lt;/span&gt;&lt;span class=o&gt;=&lt;/span&gt;&lt;span class=mi&gt;0&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=n&gt;ksize&lt;/span&gt;&lt;span class=o&gt;=&lt;/span&gt;&lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;ksize&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=n&gt;scaled&lt;/span&gt;&lt;span class=o&gt;=&lt;/span&gt;&lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;scaled&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;

    &lt;span class=n&gt;debug&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=s1&gt;'creating signatures for LCA DB...'&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;
    &lt;span class=n&gt;sigd&lt;/span&gt; &lt;span class=o&gt;=&lt;/span&gt; &lt;span class=n&gt;defaultdict&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;minhash&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;copy_and_clear&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;

    &lt;span class=k&gt;for&lt;/span&gt; &lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;k&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=n&gt;v&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;hashval_to_idx&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;items&lt;/span&gt;&lt;span class=p&gt;():&lt;/span&gt;
        &lt;span class=k&gt;for&lt;/span&gt; &lt;span class=n&gt;vv&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=n&gt;v&lt;/span&gt;&lt;span class=p&gt;:&lt;/span&gt;
            &lt;span class=n&gt;sigd&lt;/span&gt;&lt;span class=p&gt;[&lt;/span&gt;&lt;span class=n&gt;vv&lt;/span&gt;&lt;span class=p&gt;]&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;add_hash&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;k&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;

    &lt;span class=n&gt;debug&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=s1&gt;'=&amp;gt; &lt;/span&gt;&lt;span class=si&gt;{}&lt;/span&gt;&lt;span class=s1&gt; signatures!'&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=nb&gt;len&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;sigd&lt;/span&gt;&lt;span class=p&gt;))&lt;/span&gt;
    &lt;span class=k&gt;return&lt;/span&gt; &lt;span class=n&gt;sigd&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;sigd[vv].add_hash(k)&lt;/code&gt; is the culprit.
Each call to &lt;code&gt;.add_hash&lt;/code&gt; has to go thru CFFI to reach the extension code,
and the overhead is significant.
It's similar situation to accessing array elements in NumPy:
it works,
but it is way slower than using operations that avoid crossing from Python to
the extension code.
What we want to do instead is call &lt;code&gt;.add_many(hashes)&lt;/code&gt;,
which takes a list of hashes and process it entirely in Rust
(ideally. We will get there).&lt;/p&gt;
&lt;p&gt;But, to have a list of hashes, there is another issue with this code.&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=k&gt;for&lt;/span&gt; &lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;k&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=n&gt;v&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;hashval_to_idx&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;items&lt;/span&gt;&lt;span class=p&gt;():&lt;/span&gt;
    &lt;span class=k&gt;for&lt;/span&gt; &lt;span class=n&gt;vv&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=n&gt;v&lt;/span&gt;&lt;span class=p&gt;:&lt;/span&gt;
        &lt;span class=n&gt;sigd&lt;/span&gt;&lt;span class=p&gt;[&lt;/span&gt;&lt;span class=n&gt;vv&lt;/span&gt;&lt;span class=p&gt;]&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;add_hash&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;k&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;There are two nested for loops,
and &lt;code&gt;add_hash&lt;/code&gt; is being called with values from the inner loop.
So... we don't have the list of hashes beforehand.&lt;/p&gt;
&lt;p&gt;But we can change the code a bit to save the hashes for each signature
in a temporary list,
and then call &lt;code&gt;add_many&lt;/code&gt; on the temporary list.
Like this:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=n&gt;temp_vals&lt;/span&gt; &lt;span class=o&gt;=&lt;/span&gt; &lt;span class=n&gt;defaultdict&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=nb&gt;list&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;

&lt;span class=k&gt;for&lt;/span&gt; &lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;k&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=n&gt;v&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;hashval_to_idx&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;items&lt;/span&gt;&lt;span class=p&gt;():&lt;/span&gt;
    &lt;span class=k&gt;for&lt;/span&gt; &lt;span class=n&gt;vv&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=n&gt;v&lt;/span&gt;&lt;span class=p&gt;:&lt;/span&gt;
        &lt;span class=n&gt;temp_vals&lt;/span&gt;&lt;span class=p&gt;[&lt;/span&gt;&lt;span class=n&gt;vv&lt;/span&gt;&lt;span class=p&gt;]&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;append&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;k&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;

&lt;span class=k&gt;for&lt;/span&gt; &lt;span class=n&gt;sig&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=n&gt;vals&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=n&gt;temp_vals&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;items&lt;/span&gt;&lt;span class=p&gt;():&lt;/span&gt;
    &lt;span class=n&gt;sigd&lt;/span&gt;&lt;span class=p&gt;[&lt;/span&gt;&lt;span class=n&gt;sig&lt;/span&gt;&lt;span class=p&gt;]&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;add_many&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;vals&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;There is a trade-off here:
if we save the hashes in temporary lists,
will the memory consumption be so high that the runtime gains of calling
&lt;code&gt;add_many&lt;/code&gt; in these temporary lists be cancelled?&lt;/p&gt;
&lt;p&gt;Time to measure it =]&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=left&gt;version&lt;/th&gt;
&lt;th align=left&gt;mem&lt;/th&gt;
&lt;th align=left&gt;time&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=left&gt;original&lt;/td&gt;
&lt;td align=left&gt;1.5 GB&lt;/td&gt;
&lt;td align=left&gt;160s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=left&gt;&lt;code&gt;list&lt;/code&gt;&lt;/td&gt;
&lt;td align=left&gt;1.7GB&lt;/td&gt;
&lt;td align=left&gt;173s&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Wait, it got worse?!?! Building temporary lists only takes time and memory,
and bring no benefits!&lt;/p&gt;
&lt;p&gt;This mystery goes away when you look at the &lt;a href="https://github.com/dib-lab/sourmash/pull/826/files#diff-2f53b2a5be4083c39a0275847c87f88fR190"&gt;add_many method&lt;/a&gt;:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=k&gt;def&lt;/span&gt; &lt;span class=nf&gt;add_many&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=n&gt;hashes&lt;/span&gt;&lt;span class=p&gt;):&lt;/span&gt;
    &lt;span class=s2&gt;"Add many hashes in at once."&lt;/span&gt;
    &lt;span class=k&gt;if&lt;/span&gt; &lt;span class=nb&gt;isinstance&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;hashes&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=n&gt;MinHash&lt;/span&gt;&lt;span class=p&gt;):&lt;/span&gt;
        &lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;_methodcall&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;lib&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;kmerminhash_add_from&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=n&gt;hashes&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;_objptr&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;
    &lt;span class=k&gt;else&lt;/span&gt;&lt;span class=p&gt;:&lt;/span&gt;
        &lt;span class=k&gt;for&lt;/span&gt; &lt;span class=nb&gt;hash&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=n&gt;hashes&lt;/span&gt;&lt;span class=p&gt;:&lt;/span&gt;
            &lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;_methodcall&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;lib&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;kmerminhash_add_hash&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=nb&gt;hash&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The first check in the &lt;code&gt;if&lt;/code&gt; statement is a shortcut for adding hashes from
another &lt;code&gt;MinHash&lt;/code&gt;, so let's focus on &lt;code&gt;else&lt;/code&gt; part...
And turns out that &lt;code&gt;add_many&lt;/code&gt; is lying!
It doesn't process the &lt;code&gt;hashes&lt;/code&gt; in the Rust extension,
but just loops and call &lt;code&gt;add_hash&lt;/code&gt; for each &lt;code&gt;hash&lt;/code&gt; in the list.
That's not going to be any faster than what we were doing in &lt;code&gt;_signatures&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Time to fix &lt;code&gt;add_many&lt;/code&gt;!&lt;/p&gt;
&lt;h3&gt;Oxidizing &lt;code&gt;add_many&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;The idea is to change this loop in &lt;code&gt;add_many&lt;/code&gt;:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=k&gt;for&lt;/span&gt; &lt;span class=nb&gt;hash&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=n&gt;hashes&lt;/span&gt;&lt;span class=p&gt;:&lt;/span&gt;
    &lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;_methodcall&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;lib&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;kmerminhash_add_hash&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=nb&gt;hash&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;with a call to a Rust extension function:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;_methodcall&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;lib&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;kmerminhash_add_many&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=nb&gt;list&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;hashes&lt;/span&gt;&lt;span class=p&gt;),&lt;/span&gt; &lt;span class=nb&gt;len&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;hashes&lt;/span&gt;&lt;span class=p&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;self._methodcall&lt;/code&gt; is a convenience method defined in &lt;a href="https://github.com/dib-lab/sourmash/blob/c6cbdf0398ef836797492e13371a38373c544ae1/sourmash/utils.py#L24"&gt;RustObject&lt;/a&gt;
which translates a method-like call into a function call,
since our C layer only has functions.
This is the C prototype for this function:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=kt&gt;void&lt;/span&gt; &lt;span class=nf&gt;kmerminhash_add_many&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;
    &lt;span class=n&gt;KmerMinHash&lt;/span&gt; &lt;span class=o&gt;*&lt;/span&gt;&lt;span class=n&gt;ptr&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;
    &lt;span class=k&gt;const&lt;/span&gt; &lt;span class=kt&gt;uint64_t&lt;/span&gt; &lt;span class=o&gt;*&lt;/span&gt;&lt;span class=n&gt;hashes_ptr&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;
    &lt;span class=kt&gt;uintptr_t&lt;/span&gt; &lt;span class=n&gt;insize&lt;/span&gt;
  &lt;span class=p&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;You can almost read it as a Python method declaration,
where &lt;code&gt;KmerMinHash *ptr&lt;/code&gt; means the same as the &lt;code&gt;self&lt;/code&gt; in Python methods.
The other two arguments are a common idiom when passing pointers to data in C,
with &lt;code&gt;insize&lt;/code&gt; being how many elements we have in the list.
&lt;sup id=sf-sourmash-pr-5-back&gt;&lt;a href=#sf-sourmash-pr-5 class=simple-footnote title="Let's not talk about lack of array bounds checks in C..."&gt;5&lt;/a&gt;&lt;/sup&gt;.
&lt;code&gt;CFFI&lt;/code&gt; is very good at converting Python lists into pointers of a specific type,
as long as the type is of a primitive type
(&lt;code&gt;uint64_t&lt;/code&gt; in our case, since each hash is a 64-bit unsigned integer number).&lt;/p&gt;
&lt;p&gt;And the Rust code with the implementation of the function:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=n&gt;ffi_fn&lt;/span&gt;&lt;span class=o&gt;!&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=p&gt;{&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=k&gt;unsafe&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=k&gt;fn&lt;/span&gt; &lt;span class=nf&gt;kmerminhash_add_many&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=n&gt;ptr&lt;/span&gt;: &lt;span class=o&gt;*&lt;/span&gt;&lt;span class=k&gt;mut&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=n&gt;KmerMinHash&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=n&gt;hashes_ptr&lt;/span&gt;: &lt;span class=o&gt;*&lt;/span&gt;&lt;span class=k&gt;const&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=kt&gt;u64&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=n&gt;insize&lt;/span&gt;: &lt;span class=kt&gt;usize&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;  &lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;-&amp;gt; &lt;span class=nb&gt;Result&lt;/span&gt;&lt;span class=o&gt;&amp;lt;&lt;/span&gt;&lt;span class=p&gt;()&lt;/span&gt;&lt;span class=o&gt;&amp;gt;&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=p&gt;{&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=kd&gt;let&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=n&gt;mh&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=o&gt;=&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=p&gt;{&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;        &lt;/span&gt;&lt;span class=n&gt;assert&lt;/span&gt;&lt;span class=o&gt;!&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=o&gt;!&lt;/span&gt;&lt;span class=n&gt;ptr&lt;/span&gt;&lt;span class=p&gt;.&lt;/span&gt;&lt;span class=n&gt;is_null&lt;/span&gt;&lt;span class=p&gt;());&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;        &lt;/span&gt;&lt;span class=o&gt;&amp;amp;&lt;/span&gt;&lt;span class=k&gt;mut&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=o&gt;*&lt;/span&gt;&lt;span class=n&gt;ptr&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=p&gt;};&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;

&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=kd&gt;let&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=n&gt;hashes&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=o&gt;=&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=p&gt;{&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;        &lt;/span&gt;&lt;span class=n&gt;assert&lt;/span&gt;&lt;span class=o&gt;!&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=o&gt;!&lt;/span&gt;&lt;span class=n&gt;hashes_ptr&lt;/span&gt;&lt;span class=p&gt;.&lt;/span&gt;&lt;span class=n&gt;is_null&lt;/span&gt;&lt;span class=p&gt;());&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;        &lt;/span&gt;&lt;span class=n&gt;slice&lt;/span&gt;::&lt;span class=n&gt;from_raw_parts&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;hashes_ptr&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=k&gt;as&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=o&gt;*&lt;/span&gt;&lt;span class=k&gt;mut&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=kt&gt;u64&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=n&gt;insize&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=p&gt;};&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;

&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=k&gt;for&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=n&gt;hash&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=k&gt;in&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=n&gt;hashes&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=p&gt;{&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;      &lt;/span&gt;&lt;span class=n&gt;mh&lt;/span&gt;&lt;span class=p&gt;.&lt;/span&gt;&lt;span class=n&gt;add_hash&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=o&gt;*&lt;/span&gt;&lt;span class=n&gt;hash&lt;/span&gt;&lt;span class=p&gt;);&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=p&gt;}&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;

&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=nb&gt;Ok&lt;/span&gt;&lt;span class=p&gt;(())&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=p&gt;}&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=p&gt;}&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Let's break what's happening here into smaller pieces.
Starting with the function signature:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=n&gt;ffi_fn&lt;/span&gt;&lt;span class=o&gt;!&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=p&gt;{&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=k&gt;unsafe&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=k&gt;fn&lt;/span&gt; &lt;span class=nf&gt;kmerminhash_add_many&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=n&gt;ptr&lt;/span&gt;: &lt;span class=o&gt;*&lt;/span&gt;&lt;span class=k&gt;mut&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=n&gt;KmerMinHash&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=n&gt;hashes_ptr&lt;/span&gt;: &lt;span class=o&gt;*&lt;/span&gt;&lt;span class=k&gt;const&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=kt&gt;u64&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=n&gt;insize&lt;/span&gt;: &lt;span class=kt&gt;usize&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;  &lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;-&amp;gt; &lt;span class=nb&gt;Result&lt;/span&gt;&lt;span class=o&gt;&amp;lt;&lt;/span&gt;&lt;span class=p&gt;()&lt;/span&gt;&lt;span class=o&gt;&amp;gt;&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The weird &lt;code&gt;ffi_fn! {}&lt;/code&gt; syntax around the function is a macro in Rust:
it changes the final generated code to convert the return value (&lt;code&gt;Result&amp;lt;()&amp;gt;&lt;/code&gt;) into something that is valid C code (in this case, &lt;code&gt;void&lt;/code&gt;).
What happens if there is an error, then?
The Rust extension has code for passing back an error code and message to Python,
as well as capturing panics (when things go horrible bad and the program can't recover)
in a way that Python can then deal with (raising exceptions and cleaning up).
It also sets the &lt;code&gt;#[no_mangle]&lt;/code&gt; attribute in the function,
meaning that the final name of the function will follow C semantics (instead of Rust semantics),
and can be called more easily from C and other languages.
This &lt;code&gt;ffi_fn!&lt;/code&gt; macro comes from &lt;a href="https://github.com/getsentry/symbolic"&gt;symbolic&lt;/a&gt;,
a big influence on the design of the Python/Rust bridge in sourmash.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;unsafe&lt;/code&gt; is the keyword in Rust to disable some checks in the code to allow
potentially dangerous things (like dereferencing a pointer),
and it is required to interact with C code.
&lt;code&gt;unsafe&lt;/code&gt; doesn't mean that the code is always unsafe to use:
it's up to whoever is calling this to verify that valid data is being passed and invariants are being preserved.&lt;/p&gt;
&lt;p&gt;If we remove the &lt;code&gt;ffi_fn!&lt;/code&gt; macro and the &lt;code&gt;unsafe&lt;/code&gt; keyword,
we have&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=k&gt;fn&lt;/span&gt; &lt;span class=nf&gt;kmerminhash_add_many&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=n&gt;ptr&lt;/span&gt;: &lt;span class=o&gt;*&lt;/span&gt;&lt;span class=k&gt;mut&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=n&gt;KmerMinHash&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=n&gt;hashes_ptr&lt;/span&gt;: &lt;span class=o&gt;*&lt;/span&gt;&lt;span class=k&gt;const&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=kt&gt;u64&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=n&gt;insize&lt;/span&gt;: &lt;span class=kt&gt;usize&lt;/span&gt;
  &lt;span class=p&gt;);&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;At this point we can pretty much map between Rust and the C function prototype:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=kt&gt;void&lt;/span&gt; &lt;span class=nf&gt;kmerminhash_add_many&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;
    &lt;span class=n&gt;KmerMinHash&lt;/span&gt; &lt;span class=o&gt;*&lt;/span&gt;&lt;span class=n&gt;ptr&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;
    &lt;span class=k&gt;const&lt;/span&gt; &lt;span class=kt&gt;uint64_t&lt;/span&gt; &lt;span class=o&gt;*&lt;/span&gt;&lt;span class=n&gt;hashes_ptr&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;
    &lt;span class=kt&gt;uintptr_t&lt;/span&gt; &lt;span class=n&gt;insize&lt;/span&gt;
  &lt;span class=p&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Some interesting points:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We use &lt;code&gt;fn&lt;/code&gt; to declare a function in Rust.&lt;/li&gt;
&lt;li&gt;The type of an argument comes after the name of the argument in Rust,
  while it's the other way around in C.
  Same for the return type (it is omitted in the Rust function, which means it
  is &lt;code&gt;-&amp;gt; ()&lt;/code&gt;, equivalent to a &lt;code&gt;void&lt;/code&gt; return type in C).&lt;/li&gt;
&lt;li&gt;In Rust everything is &lt;strong&gt;immutable&lt;/strong&gt; by default, so we need to say that we want
  a mutable pointer to a &lt;code&gt;KmerMinHash&lt;/code&gt; item: &lt;code&gt;*mut KmerMinHash&lt;/code&gt;).
  In C everything is mutable by default.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;u64&lt;/code&gt; in Rust -&amp;gt; &lt;code&gt;uint64_t&lt;/code&gt; in C&lt;/li&gt;
&lt;li&gt;&lt;code&gt;usize&lt;/code&gt; in Rust -&amp;gt; &lt;code&gt;uintptr_t&lt;/code&gt; in C&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let's check the implementation of the function now.
We start by converting the &lt;code&gt;ptr&lt;/code&gt; argument (a raw pointer to a &lt;code&gt;KmerMinHash&lt;/code&gt; struct)
into a regular Rust struct:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=kd&gt;let&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=n&gt;mh&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=o&gt;=&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=p&gt;{&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=n&gt;assert&lt;/span&gt;&lt;span class=o&gt;!&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=o&gt;!&lt;/span&gt;&lt;span class=n&gt;ptr&lt;/span&gt;&lt;span class=p&gt;.&lt;/span&gt;&lt;span class=n&gt;is_null&lt;/span&gt;&lt;span class=p&gt;());&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=o&gt;&amp;amp;&lt;/span&gt;&lt;span class=k&gt;mut&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=o&gt;*&lt;/span&gt;&lt;span class=n&gt;ptr&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=p&gt;};&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This block is asserting that &lt;code&gt;ptr&lt;/code&gt; is not a null pointer,
and if so it dereferences it and store in a mutable reference.
If it was a null pointer the &lt;code&gt;assert!&lt;/code&gt; would panic (which might sound extreme,
but is way better than continue running because dereferencing a null pointer is
BAD).
Note that functions always need all the types in arguments and return values,
but for variables in the body of the function
Rust can figure out types most of the time,
so no need to specify them.&lt;/p&gt;
&lt;p&gt;The next block prepares our list of hashes for use:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=kd&gt;let&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=n&gt;hashes&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=o&gt;=&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=p&gt;{&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=n&gt;assert&lt;/span&gt;&lt;span class=o&gt;!&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=o&gt;!&lt;/span&gt;&lt;span class=n&gt;hashes_ptr&lt;/span&gt;&lt;span class=p&gt;.&lt;/span&gt;&lt;span class=n&gt;is_null&lt;/span&gt;&lt;span class=p&gt;());&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;    &lt;/span&gt;&lt;span class=n&gt;slice&lt;/span&gt;::&lt;span class=n&gt;from_raw_parts&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;hashes_ptr&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=k&gt;as&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=o&gt;*&lt;/span&gt;&lt;span class=k&gt;mut&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=kt&gt;u64&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=n&gt;insize&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=p&gt;};&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;We are again asserting that the &lt;code&gt;hashes_ptr&lt;/code&gt; is not a null pointer,
but instead of dereferencing the pointer like before we use it to create a &lt;code&gt;slice&lt;/code&gt;,
a dynamically-sized view into a contiguous sequence.
The list we got from Python is a contiguous sequence of size &lt;code&gt;insize&lt;/code&gt;,
and the &lt;code&gt;slice::from_raw_parts&lt;/code&gt; function creates a slice from a pointer to data and a size.&lt;/p&gt;
&lt;p&gt;Oh, and can you spot the bug?
I created the slice using &lt;code&gt;*mut u64&lt;/code&gt;,
but the data is declared as &lt;code&gt;*const u64&lt;/code&gt;.
Because we are in an &lt;code&gt;unsafe&lt;/code&gt; block Rust let me change the mutability,
but I shouldn't be doing that,
since we don't need to mutate the slice.
Oops.&lt;/p&gt;
&lt;p&gt;Finally, let's add hashes to our MinHash!
We need a &lt;code&gt;for&lt;/code&gt; loop, and call &lt;code&gt;add_hash&lt;/code&gt; for each &lt;code&gt;hash&lt;/code&gt;:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=k&gt;for&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=n&gt;hash&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=k&gt;in&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=n&gt;hashes&lt;/span&gt;&lt;span class=w&gt; &lt;/span&gt;&lt;span class=p&gt;{&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=w&gt;  &lt;/span&gt;&lt;span class=n&gt;mh&lt;/span&gt;&lt;span class=p&gt;.&lt;/span&gt;&lt;span class=n&gt;add_hash&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=o&gt;*&lt;/span&gt;&lt;span class=n&gt;hash&lt;/span&gt;&lt;span class=p&gt;);&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;span class=p&gt;}&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;

&lt;span class=nb&gt;Ok&lt;/span&gt;&lt;span class=p&gt;(())&lt;/span&gt;&lt;span class=w&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;We finish the function with &lt;code&gt;Ok(())&lt;/code&gt; to indicate no errors occurred.&lt;/p&gt;
&lt;p&gt;Why is calling &lt;code&gt;add_hash&lt;/code&gt; here faster than what we were doing before in Python?
Rust can optimize these calls and generate very efficient native code,
while Python is an interpreted language and most of the time don't have the same
guarantees that Rust can leverage to generate the code.
And, again,
calling &lt;code&gt;add_hash&lt;/code&gt; here doesn't need to cross FFI boundaries or,
in fact,
do any dynamic evaluation during runtime,
because it is all statically analyzed during compilation.&lt;/p&gt;
&lt;h2&gt;Putting it all together&lt;/h2&gt;
&lt;p&gt;And... that's the PR code.
There are some other unrelated changes that should have been in new PRs,
but since they were so small it would be more work than necessary.
OK, that's a lame excuse:
it's confusing for reviewers to see these changes here,
so avoid doing that if possible!&lt;/p&gt;
&lt;p&gt;But, did it work?&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=left&gt;version&lt;/th&gt;
&lt;th align=left&gt;mem&lt;/th&gt;
&lt;th align=left&gt;time&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=left&gt;original&lt;/td&gt;
&lt;td align=left&gt;1.5 GB&lt;/td&gt;
&lt;td align=left&gt;160s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=left&gt;&lt;code&gt;list&lt;/code&gt;&lt;/td&gt;
&lt;td align=left&gt;1.7GB&lt;/td&gt;
&lt;td align=left&gt;73s&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;We are using 200 MB of extra memory,
but taking less than half the time it was taking before.
I think this is a good trade-off,
and so did the &lt;a href="https://github.com/dib-lab/sourmash/pull/826#pullrequestreview-339020803"&gt;reviewer&lt;/a&gt; and the PR was approved.&lt;/p&gt;
&lt;p&gt;Hopefully this was useful, 'til next time!&lt;/p&gt;
&lt;h2&gt;Comments?&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://social.lasanha.org/@luizirber/103461534713587975"&gt;Thread on Mastodon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twitter.com/luizirber/status/1215772245928235008"&gt;Thread on Twitter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://lobste.rs/s/xnaugq/oxidizing_sourmash_pr_walkthrough"&gt;Lobste.rs submission&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Bonus: &lt;code&gt;list&lt;/code&gt; or &lt;code&gt;set&lt;/code&gt;?&lt;/h2&gt;
&lt;p&gt;The first version of the PR used a &lt;code&gt;set&lt;/code&gt; instead of a &lt;code&gt;list&lt;/code&gt; to accumulate hashes.
Since a &lt;code&gt;set&lt;/code&gt; doesn't have repeated elements,
this could potentially use less memory.
The code:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=n&gt;temp_vals&lt;/span&gt; &lt;span class=o&gt;=&lt;/span&gt; &lt;span class=n&gt;defaultdict&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=nb&gt;set&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;

&lt;span class=k&gt;for&lt;/span&gt; &lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;k&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=n&gt;v&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;hashval_to_idx&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;items&lt;/span&gt;&lt;span class=p&gt;():&lt;/span&gt;
    &lt;span class=k&gt;for&lt;/span&gt; &lt;span class=n&gt;vv&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=n&gt;v&lt;/span&gt;&lt;span class=p&gt;:&lt;/span&gt;
        &lt;span class=n&gt;temp_vals&lt;/span&gt;&lt;span class=p&gt;[&lt;/span&gt;&lt;span class=n&gt;vv&lt;/span&gt;&lt;span class=p&gt;]&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;add&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;k&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;

&lt;span class=k&gt;for&lt;/span&gt; &lt;span class=n&gt;sig&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=n&gt;vals&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=n&gt;temp_vals&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;items&lt;/span&gt;&lt;span class=p&gt;():&lt;/span&gt;
    &lt;span class=n&gt;sigd&lt;/span&gt;&lt;span class=p&gt;[&lt;/span&gt;&lt;span class=n&gt;sig&lt;/span&gt;&lt;span class=p&gt;]&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;add_many&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;vals&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The runtime was again half of the original,
but...&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=left&gt;version&lt;/th&gt;
&lt;th align=left&gt;mem&lt;/th&gt;
&lt;th align=left&gt;time&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=left&gt;original&lt;/td&gt;
&lt;td align=left&gt;1.5 GB&lt;/td&gt;
&lt;td align=left&gt;160s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=left&gt;&lt;code&gt;set&lt;/code&gt;&lt;/td&gt;
&lt;td align=left&gt;3.8GB&lt;/td&gt;
&lt;td align=left&gt;80s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=left&gt;&lt;code&gt;list&lt;/code&gt;&lt;/td&gt;
&lt;td align=left&gt;1.7GB&lt;/td&gt;
&lt;td align=left&gt;73s&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;... memory consumption was almost 2.5 times the original! WAT&lt;/p&gt;
&lt;p&gt;The culprit this time? The new &lt;code&gt;kmerminhash_add_many&lt;/code&gt; call in the &lt;code&gt;add_many&lt;/code&gt;
method.
This one:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;_methodcall&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;lib&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;kmerminhash_add_many&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=nb&gt;list&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;hashes&lt;/span&gt;&lt;span class=p&gt;),&lt;/span&gt; &lt;span class=nb&gt;len&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;hashes&lt;/span&gt;&lt;span class=p&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;CFFI&lt;/code&gt; doesn't know how to convert a &lt;code&gt;set&lt;/code&gt; into something that C understands,
so we need to call &lt;code&gt;list(hashes)&lt;/code&gt; to convert it into a list.
Since Python (and &lt;code&gt;CFFI&lt;/code&gt;) can't know if the data is going to be used later
&lt;sup id=sf-sourmash-pr-6-back&gt;&lt;a href=#sf-sourmash-pr-6 class=simple-footnote title="something that the memory ownership model in Rust does, BTW"&gt;6&lt;/a&gt;&lt;/sup&gt;
it needs to keep it around
(and be eventually deallocated by the garbage collector).
And that's how we get at least double the memory being allocated...&lt;/p&gt;
&lt;p&gt;There is another lesson here.
If we look at the &lt;code&gt;for&lt;/code&gt; loop again:&lt;/p&gt;
&lt;div class=highlight&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=k&gt;for&lt;/span&gt; &lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;k&lt;/span&gt;&lt;span class=p&gt;,&lt;/span&gt; &lt;span class=n&gt;v&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=bp&gt;self&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;hashval_to_idx&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;items&lt;/span&gt;&lt;span class=p&gt;():&lt;/span&gt;
    &lt;span class=k&gt;for&lt;/span&gt; &lt;span class=n&gt;vv&lt;/span&gt; &lt;span class=ow&gt;in&lt;/span&gt; &lt;span class=n&gt;v&lt;/span&gt;&lt;span class=p&gt;:&lt;/span&gt;
        &lt;span class=n&gt;temp_vals&lt;/span&gt;&lt;span class=p&gt;[&lt;/span&gt;&lt;span class=n&gt;vv&lt;/span&gt;&lt;span class=p&gt;]&lt;/span&gt;&lt;span class=o&gt;.&lt;/span&gt;&lt;span class=n&gt;add&lt;/span&gt;&lt;span class=p&gt;(&lt;/span&gt;&lt;span class=n&gt;k&lt;/span&gt;&lt;span class=p&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;each &lt;code&gt;k&lt;/code&gt; is already unique because they are keys in the &lt;code&gt;hashval_to_idx&lt;/code&gt; dictionary,
so the initial assumption
(that a &lt;code&gt;set&lt;/code&gt; might save memory because it doesn't have repeated elements)
is... irrelevant for the problem =]&lt;/p&gt;&lt;section class=footnotes&gt;&lt;hr&gt;&lt;h2&gt;Footnotes&lt;/h2&gt;&lt;ol&gt;&lt;li id=sf-sourmash-pr-1&gt;&lt;p&gt;We do have https://asv.readthedocs.io/ set up for micro-benchmarks,
and now that I think about it...
I could have started by writing a benchmark for &lt;code&gt;add_many&lt;/code&gt;,
and then showing that it is faster.
I will add this approach to the sourmash PR checklist =] &lt;a href=#sf-sourmash-pr-1-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li id=sf-sourmash-pr-2&gt;&lt;p&gt;or triple, if you count C &lt;a href=#sf-sourmash-pr-2-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li id=sf-sourmash-pr-3&gt;&lt;p&gt;It would be super cool to have the unwinding code from py-spy in heaptrack,
and be able to see exactly what Python methods/lines of code were calling the
Rust parts... &lt;a href=#sf-sourmash-pr-3-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li id=sf-sourmash-pr-4&gt;&lt;p&gt;Even if py-spy doesn't talk explicitly about Rust,
it works very very well, woohoo! &lt;a href=#sf-sourmash-pr-4-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li id=sf-sourmash-pr-5&gt;&lt;p&gt;Let's not talk about lack of array bounds checks in C... &lt;a href=#sf-sourmash-pr-5-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li id=sf-sourmash-pr-6&gt;&lt;p&gt;something that the memory ownership model in Rust does, BTW &lt;a href=#sf-sourmash-pr-6-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/section&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Fri, 10 Jan 2020 12:00:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2020-01-10:/2020/01/10/sourmash-pr/</guid><category>science</category><category>bioinformatics</category><category>rust</category></item><item><title>Interoperability #rust2020</title><link>https://blog.luizirber.org/2019/12/01/rust-2020/</link><description>&lt;p&gt;In January I wrote a &lt;a href="https://blog.luizirber.org/2019/01/05/rust-2019/"&gt;post&lt;/a&gt; for the Rust 2019 call for blogs.
The &lt;a href="https://blog.rust-lang.org/2019/10/29/A-call-for-blogs-2020.html"&gt;2020 call&lt;/a&gt; is aiming for an RFC and roadmap earlier this time,
so here is my 2020 post =]&lt;/p&gt;
&lt;h3&gt;Last call review: what happened?&lt;/h3&gt;
&lt;h4&gt;An attribute proc-macro like &lt;code&gt;#[wasm_bindgen]&lt;/code&gt; but for FFI&lt;/h4&gt;
&lt;p&gt;This sort of happened... because WebAssembly is growing =]&lt;/p&gt;
&lt;p&gt;I was very excited when &lt;a href="https://hacks.mozilla.org/2019/08/webassembly-interface-types/"&gt;Interface Types&lt;/a&gt; showed up in August,
and while it is still very experimental it is moving fast and bringing saner
paths for interoperability than raw C FFIs.
David Beazley even point this at the end of his &lt;a href="https://www.youtube.com/watch?v=r-A78RgMhZU"&gt;PyCon India keynote&lt;/a&gt;,
talking about how easy is to get information out of a WebAssembly module
compared to what had to be done for SWIG.&lt;/p&gt;
&lt;p&gt;This doesn't solve the problem where strict C compatibility is required,
or for platforms where a WebAssembly runtime is not available,
but I think it is a great solution for scientific software
(or, at least, for my use cases =]).&lt;/p&gt;
&lt;h4&gt;"More -sys and Rust-like crates for interoperability with the larger ecosystems" and "More (bioinformatics) tools using Rust!"&lt;/h4&gt;
&lt;p&gt;I did some of those this year (&lt;a href="https://crates.io/crates/bbhash-sys"&gt;bbhash-sys&lt;/a&gt; and &lt;a href="https://crates.io/crates/mqf"&gt;mqf&lt;/a&gt;),
and also found some great crates to use in my projects.
Rust is picking up steam in bioinformatics,
being used as the primary choice for high quality software
(like &lt;a href="https://varlociraptor.github.io/"&gt;varlociraptor&lt;/a&gt;, 
or the many coming from &lt;a href="https://github.com/10XGenomics/"&gt;10X Genomics&lt;/a&gt;)
but it is still somewhat hard to find more details
(I mostly find it on Twitter,
and sometime Google Scholar alerts).
It would be great to start bringing this info together,
which leads to...&lt;/p&gt;
&lt;h4&gt;"A place to find other scientists?"&lt;/h4&gt;
&lt;p&gt;Hey, this one happened! &lt;a href="https://twitter.com/algo_luca/status/1081966759048028162"&gt;Luca Palmieri&lt;/a&gt; started a conversation on &lt;a href="https://www.reddit.com/r/rust/comments/ae77gt/scientific_computingmachine_learning_do_we_want_a/"&gt;reddit&lt;/a&gt; and
the &lt;a href="https://discord.gg/EXTSq4v"&gt;#science-and-ai&lt;/a&gt; Discord channel on the Rust community server was born!
I think it works pretty well,
and Luca also has being doing a great job running &lt;a href="https://github.com/LukeMathWalker/ndarray-koans"&gt;workshops&lt;/a&gt;
and guiding the conversation around &lt;a href="https://github.com/rust-ml/discussion"&gt;rust-ml&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Rust 2021: Interoperability&lt;/h2&gt;
&lt;p&gt;Rust is amazing because it is very good at bringing many concepts and ideas that
seem contradictory at first,
but can really shine when &lt;a href="https://rust-lang.github.io/rustconf-2018-keynote/#127"&gt;synthesized&lt;/a&gt;.
But can we share this combined wisdom and also improve the situation in other
places too?
Despite the "Rewrite it in Rust" meme,
increased interoperability is something that is already driving a lot of the
best aspects of Rust:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Interoperability with other languages: as I said before,
  with WebAssembly (and Rust being having the best toolchain for it)
  there is a clear route to achieve this,
  but it will not replace all the software that already exist and can benefit
  from FFI and C compatibility.
  Bringing together developers from the many language specific binding
  generators (&lt;a href="https://github.com/tildeio/helix"&gt;helix&lt;/a&gt;, &lt;a href="https://github.com/neon-bindings/neon"&gt;neon&lt;/a&gt;, &lt;a href="https://github.com/rusterlium/rustler"&gt;rustler&lt;/a&gt;, &lt;a href="https://github.com/PyO3/pyo3"&gt;PyO3&lt;/a&gt;...) and figuring out what's missing from
  them (or what is the common parts that can be shared) also seems productive.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Interoperability with new and unexplored domains.
  I think Rust benefits enormously from not focusing only in one domain,
  and choosing to prioritize CLI, WebAssembly, Networking and Embedded is a good
  subset to start tackling problems,
  but how to guide other domains to also use Rust and come up with new
  contributors and expose missing pieces of the larger picture?&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Another point extremely close to interoperability is training.
A great way to interoperate with other languages and domains is having good
documentation and material from transitioning into Rust without having to figure
everything at once.
Rust documentation is already amazing,
especially considering the many books published by each working group.
But... there is a gap on the transitions,
both from understanding the basics of the language and using it,
to the progression from beginner to intermediate and expert.&lt;/p&gt;
&lt;p&gt;I see good resources for &lt;a href="https://github.com/yoshuawuyts/rust-for-js-people"&gt;JavaScript&lt;/a&gt; and &lt;a href="https://github.com/rochacbruno/py2rs"&gt;Python&lt;/a&gt; developers,
but we are still covering a pretty small niche:
programmers curious enough to go learn another language,
or looking for solutions for problems in their current language.&lt;/p&gt;
&lt;p&gt;Can we bring more people into Rust?
&lt;a href="https://rustbridge.com/"&gt;RustBridge&lt;/a&gt; is obviously the reference here,
but there is space for much,
much more.
Using Rust in &lt;a href="https://carpentries.org/"&gt;The Carpentries&lt;/a&gt; lessons?
Creating &lt;code&gt;RustOpenSci&lt;/code&gt;,
mirroring the communities of practice of &lt;a href="https://ropensci.org/about/"&gt;rOpenSci&lt;/a&gt; and &lt;a href="https://www.pyopensci.org/"&gt;pyOpenSci&lt;/a&gt;?&lt;/p&gt;
&lt;h2&gt;Comments?&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://social.lasanha.org/@luizirber/103236549475802733"&gt;Thread on Mastodon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twitter.com/luizirber/status/1201373423592562690"&gt;Thread on Twitter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Sun, 01 Dec 2019 12:00:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2019-12-01:/2019/12/01/rust-2020/</guid><category>science</category><category>bioinformatics</category><category>rust</category></item><item><title>Scientific Rust #rust2019</title><link>https://blog.luizirber.org/2019/01/05/rust-2019/</link><description>&lt;p&gt;The Rust community requested feedback last year for where the language should go
in 2018, and now they are running it again for 2019.
Last year I was too new in Rust to organize a blog post,
but after an year using it I feel more comfortable writing this!&lt;/p&gt;
&lt;p&gt;(Check my previous post about &lt;a href="https://blog.luizirber.org/2018/08/23/sourmash-rust/"&gt;replacing the C++ core in sourmash with Rust&lt;/a&gt; for more details on how I spend my year in Rust).&lt;/p&gt;
&lt;h2&gt;What counts as "scientific Rust"?&lt;/h2&gt;
&lt;p&gt;Anything that involves doing science using computers counts as
scientific programming. It includes from embedded software
&lt;a href="https://www.youtube.com/watch?v=y5Yd3FC-kh8"&gt;running on satellites&lt;/a&gt; to climate models
running in supercomputers, from shell scripts running tools in a pipeline to
data analysis using notebooks.&lt;/p&gt;
&lt;p&gt;It also makes the discussion harder, because it's too general! But it is very
important to keep in mind, because scientists are not your regular user: they
are highly qualified in their field of expertise, and they are also pushing the
boundaries of what we know (and this might need flexibility in their tools).&lt;/p&gt;
&lt;p&gt;In this post I will be focusing more in two areas: array computing (what most
people consider 'scientific programming' to be) and "data structures".&lt;/p&gt;
&lt;h3&gt;Array computing&lt;/h3&gt;
&lt;p&gt;This one is booming in the last couple of years due to industry interest in data
sciences and deep learning (where they will talk about tensors instead of arrays),
and has its roots in models running in supercomputers (a field where Fortran is
still king!). Data tends to be quite regular (representable with matrices) and 
amenable to parallel processing.&lt;/p&gt;
&lt;p&gt;A good example is the SciPy stack in Python, built on top of NumPy and SciPy.
The adoption of the SciPy stack (both in academia and industry) is staggering,
and many &lt;a href="https://github.com/cupy/cupy"&gt;alternative implementations&lt;/a&gt; try to provide a NumPy-like API to try to
capture its mindshare.&lt;/p&gt;
&lt;p&gt;This is the compute-intensive side science (be it CPU or GPU/TPU), and also the kind
of data that pushed CPU evolution and is still very important in defining policy
in scientific computing funding (see countries competing for the largest
supercomputers and measuring performance in floating point operations per second).&lt;/p&gt;
&lt;h3&gt;Data structures for efficient data representation&lt;/h3&gt;
&lt;p&gt;For data that is not so regular the situation is a bit different. I'll use
bioinformatics as an example: the data we get out of nucleotide sequencers is usually
represented by long strings (of ACGT), and algorithms will do a lot of string processing
(be it building string-overlap graphs for assembly, or searching for substrings
in large collections). This is only one example: there are many analyses that
will work with other types of data, and most of them don't have a
universal data representation as in the array computing case.&lt;/p&gt;
&lt;p&gt;This is the memory-intensive science, and it's hard to measure performance in
floating point operations because... most of the time you're not even using
floating point numbers. It also suffers from limited data locality (which is
almost a prerequisite for compute-intensive performance).&lt;/p&gt;
&lt;h2&gt;High performance core, interactive API&lt;/h2&gt;
&lt;p&gt;There is something common in both cases: while performance-intensive
code is implemented in C/C++/Fortran, users usually interact with the API from
other languages (especially Python or R) because it's faster to iterate and
explore the data, and many of the tools already available in these languages are
very helpful for these tasks (think Jupyter/pandas or RStudio/tidyverse).
These languages are used to define the computation, but it is a lower-level core
library that drives it (NumPy or Tensorflow follow this idea, for example).&lt;/p&gt;
&lt;h2&gt;How to make Rust better for science?&lt;/h2&gt;
&lt;p&gt;The biggest barrier to learning Rust is the ownership model, and while we can
agree it is an important feature it is also quite daunting for newcomers,
especially if they don't have previous programming experience and exposure to
what bugs are being prevented. I don't see it being the first language we teach
to scientists any time soon, because the majority of scientists are not system
programmers, and have very different expectations for a programming language.
That doesn't mean that they can't benefit from Rust!&lt;/p&gt;
&lt;p&gt;Rust is already great for building the performance-intensive parts,
and thanks to Cargo it is also a better alternative for sharing this code around,
since they tend to get 'stuck' inside Python or R packages.
And the 'easy' approach of vendoring C/C++ instead of having packages make it
hard to keep track of changes and doesn't encourage reusable code.&lt;/p&gt;
&lt;p&gt;And, of course, if this code is Rust instead of C/C++ it also means that Rust
users can use them directly, without depending on the other languages. Seems
like a good way to bootstrap a scientific community in Rust =]&lt;/p&gt;
&lt;h2&gt;What I would like to see in 2019?&lt;/h2&gt;
&lt;h3&gt;An attribute proc-macro like &lt;code&gt;#[wasm_bindgen]&lt;/code&gt; but for FFI&lt;/h3&gt;
&lt;p&gt;While FFI is an integral part of Rust goals (interoperability with C/C++), I
have serious envy of the structure and tooling developed for WebAssembly! (Even
more now that it works in stable too)&lt;/p&gt;
&lt;p&gt;We already have &lt;code&gt;#[no_mangle]&lt;/code&gt; and &lt;code&gt;pub extern "C"&lt;/code&gt;, but they are quite
low-level. I would love to see something closer to what wasm-bindgen does,
and define some traits (like &lt;a href="https://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen/convert/trait.IntoWasmAbi.html"&gt;&lt;code&gt;IntoWasmAbi&lt;/code&gt;&lt;/a&gt;) to make it easier to
pass more complex data types through the FFI.&lt;/p&gt;
&lt;p&gt;I know it's not that simple, and there are different design restrictions than
WebAssembly to take into account... The point here is not having the perfect
solution for all use cases, but something that serves as an entry point and helps
to deal with the complexity while you're still figuring out all the quirks and
traps of FFI. You can still fallback and have more control using the lower-level
options when the need rises.&lt;/p&gt;
&lt;h3&gt;More -sys and Rust-like crates for interoperability with the larger ecosystems&lt;/h3&gt;
&lt;p&gt;There are new projects bringing more interoperability to &lt;a href="https://arrow.apache.org/"&gt;dataframes&lt;/a&gt; and &lt;a href="https://xnd.io/"&gt;tensors&lt;/a&gt;.
While this ship has already sailed and they are implemented in C/C++,
it would be great to be a first-class citizen,
and not reinvent the wheel.
(Note: the arrow project already have pretty good Rust support!)&lt;/p&gt;
&lt;p&gt;In my own corner (bioinformatics), the &lt;a href="https://github.com/rust-bio"&gt;Rust-bio community&lt;/a&gt; is doing a
great job of wrapping &lt;a href="https://github.com/rust-bio/rust-htslib"&gt;useful libraries in C/C++&lt;/a&gt; and exposing them to
Rust (and also a shout-out to 10X Genomics for doing this work for
&lt;a href="https://github.com/10XGenomics/rust-bwa"&gt;other tools&lt;/a&gt; while also contributing to Rust-bio!).&lt;/p&gt;
&lt;h3&gt;More (bioinformatics) tools using Rust!&lt;/h3&gt;
&lt;p&gt;We already have great examples like &lt;a href="https://github.com/onecodex/finch-rs"&gt;finch&lt;/a&gt; and &lt;a href="https://github.com/natir/yacrd"&gt;yacrd&lt;/a&gt;,
since Rust is great for single binary distribution of programs.
And with bioinformatics focusing so much in independent tools chained together in workflows,
I think we can start convincing people to try it out =]&lt;/p&gt;
&lt;h3&gt;A place to find other scientists?&lt;/h3&gt;
&lt;p&gt;Another idea is to draw inspiration from &lt;a href="https://ropensci.org/about/"&gt;rOpenSci&lt;/a&gt; and have a Rust equivalent,
where people can get feedback about their projects and how to better integrate it with other crates.
This is quite close to the working group idea,
but I think it would serve more as a gateway to other groups,
more focused on developing entry-level docs and bringing more scientists to the
community.&lt;/p&gt;
&lt;h2&gt;Final words&lt;/h2&gt;
&lt;p&gt;In the end, I feel like this post ended up turning into my 'wishful TODO list'
for 2019, but I would love to find more people sharing these goals (or willing
to take any of this and just run with it, I do have a PhD to finish! =P)&lt;/p&gt;
&lt;h2&gt;Comments?&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://social.lasanha.org/@luizirber/101367104235280253"&gt;Thread on Mastodon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twitter.com/luizirber/status/1081729107170193408"&gt;Thread on Twitter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Sat, 05 Jan 2019 17:00:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2019-01-05:/2019/01/05/rust-2019/</guid><category>science</category><category>bioinformatics</category><category>rust</category></item><item><title>What open science is about</title><link>https://blog.luizirber.org/2018/09/24/open-science/</link><description>&lt;p&gt;Today I got a pleasant surprise: &lt;a href="http://www.olgabotvinnik.com/"&gt;Olga Botvinnik&lt;/a&gt; posted on &lt;a href="https://twitter.com/olgabot/status/1044292704513839104"&gt;Twitter&lt;/a&gt;
about a &lt;a href="https://github.com/czbiohub/kmer-hashing/blob/olgabot/search-compare-ignore-abundance/figures/presentations/2018-09-24_beyond_the_cell_atlas_poster/2018-09-24_Beyond_the_Cell_Atlas.pdf"&gt;poster&lt;/a&gt; she is presenting at the Beyond the Cell Atlas conference
and she name-dropped a bunch of people that helped her. The cool thing? They
are all open source developers, and Olga interacted thru GitHub to &lt;a href="https://github.com/dib-lab/sourmash/pull/543"&gt;ask&lt;/a&gt; &lt;a href="https://github.com/dib-lab/sourmash/issues/545"&gt;for&lt;/a&gt; &lt;a href="https://github.com/betteridiot/bamnostic/issues/15"&gt;features&lt;/a&gt;,
&lt;a href="https://github.com/betteridiot/bamnostic/issues/20"&gt;report bugs&lt;/a&gt; and even &lt;a href="https://github.com/dib-lab/sourmash/pull/543"&gt;submit&lt;/a&gt; &lt;a href="https://github.com/dib-lab/sourmash/pull/539"&gt;pull&lt;/a&gt; &lt;a href="https://github.com/dib-lab/sourmash/pull/529"&gt;requests&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;That's what open science is about: collaboration, good practices, and in the end coming up
with something that is larger than each individual piece. Now sourmash is better,
bamnostic is better, reflow is better. I would like to see this becoming more and
more common =]&lt;/p&gt;
&lt;h2&gt;Comments?&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://social.lasanha.org/@luizirber/100783375923088450"&gt;Thread on Mastodon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twitter.com/luizirber/status/1044369382233665536"&gt;Thread on Twitter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Mon, 24 Sep 2018 17:00:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2018-09-24:/2018/09/24/open-science/</guid><category>science</category><category>bioinformatics</category><category>sourmash</category><category>open</category></item><item><title>New crate: nthash</title><link>https://blog.luizirber.org/2018/09/13/nthash/</link><description>&lt;p&gt;A quick announcement: I wrote a &lt;a href="https://github.com/luizirber/nthash"&gt;Rust implementation&lt;/a&gt; of &lt;a href="https://github.com/bcgsc/ntHash"&gt;ntHash&lt;/a&gt; and published
it in &lt;a href="https://crates.io/crates/nthash"&gt;crates.io&lt;/a&gt;. It implements an &lt;code&gt;Iterator&lt;/code&gt; to take advantage of the
rolling properties of &lt;code&gt;ntHash&lt;/code&gt; which make it so useful in bioinformatics (where
we work a lot with sliding windows over sequences).&lt;/p&gt;
&lt;p&gt;It's a pretty small crate, and probably was a better project to learn Rust than
doing a &lt;a href="https://blog.luizirber.org/2018/08/23/sourmash-rust/"&gt;sourmash implementation&lt;/a&gt; because it doesn't involve gnarly FFI
issues. I also put &lt;a href="https://github.com/luizirber/nthash/blob/d0c16d7deb0a78b8aeb29090db91bba954c14fe8/src/lib.rs#L91"&gt;some docs&lt;/a&gt;, &lt;a href="https://github.com/luizirber/nthash/blob/d0c16d7deb0a78b8aeb29090db91bba954c14fe8/benches/nthash.rs#L11"&gt;benchmarks&lt;/a&gt; using &lt;a href="https://japaric.github.io/criterion.rs/"&gt;criterion&lt;/a&gt;,
and even an &lt;a href="https://github.com/luizirber/nthash/blob/d0c16d7deb0a78b8aeb29090db91bba954c14fe8/tests/nthash.rs#L80"&gt;oracle property-based test&lt;/a&gt; with &lt;a href="https://github.com/BurntSushi/quickcheck"&gt;quickcheck&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;More info &lt;a href="https://docs.rs/nthash/"&gt;in the docs&lt;/a&gt;, and if you want an &lt;s&gt;optimization&lt;/s&gt; versioning bug
discussion be sure to check the &lt;a href="https://github.com/luizirber/nthash_bug"&gt;&lt;code&gt;ntHash bug?&lt;/code&gt;&lt;/a&gt; repo,
which has a (slow) Python implementation and a pretty nice &lt;a href="https://nbviewer.jupyter.org/github/luizirber/nthash_bug/blob/master/analysis.ipynb"&gt;analysis&lt;/a&gt; notebook.&lt;/p&gt;
&lt;h2&gt;Comments?&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://social.lasanha.org/@luizirber/100721133117928424"&gt;Thread on Mastodon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twitter.com/luizirber/status/1040386666089705472"&gt;Thread on Twitter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Thu, 13 Sep 2018 17:00:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2018-09-13:/2018/09/13/nthash/</guid><category>science</category><category>rust</category><category>hashing</category><category>bioinformatics</category></item><item><title>Oxidizing sourmash: WebAssembly</title><link>https://blog.luizirber.org/2018/08/27/sourmash-wasm/</link><description>&lt;p&gt;sourmash calculates MinHash signatures for genomic datasets,
meaning we are reducing the data (via subsampling) to a small
representative subset (a signature) capable of answering one question:
how similar is this dataset to another one? The key here is that a dataset with
10-100 GB will be reduced to something in the megabytes range, and two approaches
for doing that are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The user install our software in their computer.
  This is not so bad anymore (yay bioconda!), but still requires knowledge
  about command line interfaces and how to install all this stuff. The user
  data never leaves their computer, and they can share the signatures later
  if they want to.&lt;/li&gt;
&lt;li&gt;Provide a web service to calculate signatures. In this case no software
  need to be installed, but it's up to someone (me?) to maintain a server running with
  an API and frontend to interact with the users. On top of requiring more
  maintenance, another drawback is that
  the user need to send me the data, which is very inefficient network-wise
  and lead to questions about what I can do with their raw data (and I'm not
  into surveillance capitalism, TYVM).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;But... what if there is a third way?&lt;/h2&gt;
&lt;p&gt;What if we could keep the frontend code from the web service (very
user-friendly) but do all the calculations client-side (and avoid the network
bottleneck)? The main hurdle
here is that our software is implemented in Python (and C++), which are not
supported in browsers. My first solution was to write the core features of
&lt;a href="https://github.com/luizirber/sourmash-node"&gt;sourmash in JavaScript&lt;/a&gt;, but that quickly started hitting annoying things
like JavaScript not supporting 64-bit integers. There is also the issue of
having another codebase to maintain and keep in sync with the original sourmash,
which would be a relevant burden for us. I gave a &lt;a href="https://drive.google.com/open?id=1JvXiDaEA4J3hmEKw6sV-VHMpuHG_sxls3fLxJOht28E"&gt;lab meeting&lt;/a&gt; about this
approach, using a &lt;a href="https://soursigs-dnd-luizirber.hashbase.io/"&gt;drag-and-drop UI as proof of concept&lt;/a&gt;. It did work but it
was finicky (dealing with the 64-bit integer hashes is not fun). The good thing
is that at least I had a working UI for further testing&lt;sup id=sf-sourmash-wasm-1-back&gt;&lt;a href=#sf-sourmash-wasm-1 class=simple-footnote title="even if horrible, I need to get some design classes =P"&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;In "&lt;a href="https://blog.luizirber.org/2018/08/23/sourmash-rust/"&gt;Oxidizing sourmash: Python and FFI&lt;/a&gt;" I described my road to learn Rust,
but something that I omitted was that around the same time the &lt;code&gt;WebAssembly&lt;/code&gt;
support in Rust started to look better and better and was a huge influence in 
my decision to learn Rust. Reimplementing the sourmash C++ extension in Rust and
use the same codebase in the browser sounded very attractive,
and now that it was working I started looking into how to use the WebAssembly
target in Rust.&lt;/p&gt;
&lt;h2&gt;WebAssembly?&lt;/h2&gt;
&lt;p&gt;From the &lt;a href="https://webassembly.org/"&gt;official site&lt;/a&gt;,&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;WebAssembly (abbreviated Wasm) is a binary instruction format for a stack-based virtual machine.
Wasm is designed as a portable target for compilation of high-level languages like C/C++/Rust,
enabling deployment on the web for client and server applications.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;You can write WebAssembly by hand, but the goal is to have it as lower level
target for other languages. For me the obvious benefit is being able to use
something that is not JavaScript in the browser, even though the goal is not to replace
JS completely but complement it in a big pain point: performance. This also
frees JavaScript from being the target language for other toolchains,
allowing it to grow into other important areas (like language ergonomics).&lt;/p&gt;
&lt;p&gt;Rust is not the only language targeting WebAssembly: Go 1.11 includes
&lt;a href="https://golang.org/doc/go1.11#wasm"&gt;experimental support for WebAssembly&lt;/a&gt;, and there are even projects bringing
the &lt;a href="https://github.com/iodide-project/pyodide"&gt;scientific Python to the web&lt;/a&gt; using WebAssembly. &lt;/p&gt;
&lt;h2&gt;But does it work?&lt;/h2&gt;
&lt;p&gt;With the &lt;a href="https://github.com/luizirber/sourmash-rust"&gt;Rust implementation in place&lt;/a&gt; and with all tests working on sourmash, I 
added the finishing touches using &lt;a href="https://github.com/rustwasm/wasm-bindgen"&gt;&lt;code&gt;wasm-bindgen&lt;/code&gt;&lt;/a&gt; and built an NPM package using
&lt;a href="https://github.com/rustwasm/wasm-pack"&gt;&lt;code&gt;wasm-pack&lt;/code&gt;&lt;/a&gt;: &lt;a href="https://www.npmjs.com/package/sourmash"&gt;sourmash&lt;/a&gt; is a Rust codebase compiled to WebAssembly and ready
to use in JavaScript projects.&lt;/p&gt;
&lt;p&gt;(Many thanks to Madicken Munk, who also presented during SciPy about how they used
&lt;a href="https://munkm.github.io/2018-07-13-scipy/"&gt;Rust and WebAssembly to do interactive visualization in Jupyter&lt;/a&gt;
and helped with a good example on how to do this properly =] )&lt;/p&gt;
&lt;p&gt;Since I already had the working UI from the previous PoC, I &lt;a href="https://github.com/luizirber/wort-dnd"&gt;refactored the code&lt;/a&gt;
to use the new WebAssembly module and voilà! &lt;a href="https://wort-dnd.hashbase.io/"&gt;It works!&lt;/a&gt;&lt;sup id=sf-sourmash-wasm-2-back&gt;&lt;a href=#sf-sourmash-wasm-2 class=simple-footnote title="the first version of this demo only worked in Chrome because they implemented the BigInt proposal, which is not in the official language yet. The funny thing is that BigInt would have made the JS implementation of sourmash viable, and I probably wouldn't have written the Rust implementation =P. Turns out that I didn't need the BigInt support if I didn't expose any 64-bit integers to JS, and that is what I'm doing now."&gt;2&lt;/a&gt;&lt;/sup&gt;.
&lt;sup id=sf-sourmash-wasm-3-back&gt;&lt;a href=#sf-sourmash-wasm-3 class=simple-footnote title="Along the way I ended up writing a new FASTQ parser... because it wouldn't be bioinformatics if it didn't otherwise, right? =P"&gt;3&lt;/a&gt;&lt;/sup&gt;
But that was the demo from a year ago with updated code and I got a bit
better with frontend development since then, so here is the new demo:&lt;/p&gt;
&lt;div id=files class=box ondragover=event.preventDefault()&gt;
  &lt;h2&gt;sourmash + Wasm&lt;/h2&gt;
  &lt;div id=drag-container&gt;
    &lt;p&gt;&lt;b&gt;Drag &amp;amp; drop&lt;/b&gt; a FASTA or FASTQ file here to calculate the sourmash signature.&lt;/p&gt;
  &lt;/div&gt;

  &lt;div id=progress-container&gt;
    &lt;div id=progress-bar&gt;&lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=columns&gt;
    &lt;fieldset class="box input-button" id=params&gt;
      &lt;label for=ksize-input&gt;k-mer size:&lt;/label&gt;
      &lt;input id=ksize-input type=number value=21&gt;
      &lt;label for=scaled-input&gt;scaled:&lt;/label&gt;
      &lt;input id=scaled-input type=number value=0&gt;
      &lt;label for=num-input&gt;number of hashes:&lt;/label&gt;
      &lt;input id=num-input type=number value=500&gt;
      &lt;label for=dna-protein-group&gt;Input type:&lt;/label&gt;
      &lt;div id=dna-protein-group&gt;
        &lt;input id=dna-input name=dna-protein-input type=radio value="DNA/RNA" checked&gt;
        &lt;label for=dna-input&gt;DNA/RNA&lt;/label&gt;
        &lt;input id=protein-input name=dna-protein-input type=radio value=Protein&gt;
        &lt;label for=protein-input&gt;Protein&lt;/label&gt;
      &lt;/div&gt;
      &lt;label for=track-abundance-input&gt;Track abundance?&lt;/label&gt;
      &lt;input id=track-abundance-input type=checkbox checked&gt;
    &lt;/fieldset&gt;
    &lt;div class=box id=download&gt;
      &lt;button id=download_btn type=button disabled&gt;Download&lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;&lt;link rel=stylesheet href="https://blog.luizirber.org/static/sourmash-wasm/app.css"&gt;
&lt;script src="https://blog.luizirber.org/static/sourmash-wasm/dist/bundle.js"&gt;&lt;/script&gt;&lt;/p&gt;
&lt;p&gt;For the source code for this demo, check the &lt;a href="https://blog.luizirber.org/static/sourmash-wasm/index.html"&gt;sourmash-wasm&lt;/a&gt; directory.&lt;/p&gt;
&lt;h2&gt;Next steps&lt;/h2&gt;
&lt;p&gt;The proof of concept works, but it is pretty useless right now.
I'm thinking about building it as a &lt;a href="https://www.webcomponents.org/"&gt;Web Component&lt;/a&gt; and making it really easy
to add to any webpage&lt;sup id=sf-sourmash-wasm-4-back&gt;&lt;a href=#sf-sourmash-wasm-4 class=simple-footnote title="or maybe a React component? I really would like to have something that works independent of framework, but not sure what is the best option in this case..."&gt;4&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;Another interesting feature would be supporting more input formats (the GMOD
project implemented a lot of those!), but more features are probably better
after something simple but functional is released =P&lt;/p&gt;
&lt;h2&gt;Next time!&lt;/h2&gt;
&lt;p&gt;Where we will go next? Maybe explore some decentralized web technologies like
IPFS and dat, hmm? =]&lt;/p&gt;
&lt;h2&gt;Comments?&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://social.lasanha.org/@luizirber/100624574917435477"&gt;Thread on Mastodon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.reddit.com/r/rust/comments/9atie8/blog_post_clientside_bioinformatics_in_the/"&gt;Thread on reddit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twitter.com/luizirber/status/1034206952773935104"&gt;Thread on Twitter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Updates&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;2018-08-30: Added a demo in the blog post.&lt;/li&gt;
&lt;/ul&gt;&lt;section class=footnotes&gt;&lt;hr&gt;&lt;h2&gt;Footnotes&lt;/h2&gt;&lt;ol&gt;&lt;li id=sf-sourmash-wasm-1&gt;&lt;p&gt;even if horrible, I
need to get some design classes =P &lt;a href=#sf-sourmash-wasm-1-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li id=sf-sourmash-wasm-2&gt;&lt;p&gt;the first version
of this demo only worked in Chrome because they implemented the &lt;a href="https://github.com/tc39/proposal-bigint"&gt;BigInt proposal&lt;/a&gt;,
which is not in the official language yet. The funny thing is that BigInt would
have made the JS implementation of sourmash viable, and I probably wouldn't have
written the Rust implementation =P.
Turns out that I didn't need the BigInt support if I didn't expose any 64-bit
integers to JS, and that is what I'm doing now. &lt;a href=#sf-sourmash-wasm-2-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li id=sf-sourmash-wasm-3&gt;&lt;p&gt;Along the way I ended up writing a new FASTQ parser... because it wouldn't
be bioinformatics if it didn't otherwise, right? =P &lt;a href=#sf-sourmash-wasm-3-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li id=sf-sourmash-wasm-4&gt;&lt;p&gt;or maybe a React component? I really would like to
have something that works independent of framework, but not sure what is the
best option in this case... &lt;a href=#sf-sourmash-wasm-4-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/section&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Mon, 27 Aug 2018 15:30:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2018-08-27:/2018/08/27/sourmash-wasm/</guid><category>science</category><category>rust</category><category>webassembly</category></item><item><title>Oxidizing sourmash: Python and FFI</title><link>https://blog.luizirber.org/2018/08/23/sourmash-rust/</link><description>&lt;p&gt;I think the first time I heard about Rust was because Frank Mcsherry chose it to
write a &lt;a href="https://github.com/frankmcsherry/timely-dataflow"&gt;timely dataflow&lt;/a&gt; implementation.
Since then it started showing more and more in my news sources,
leading to Armin Ronacher publishing a post in the Sentry blog last November about
writing &lt;a href="https://blog.sentry.io/2017/11/14/evolving-our-rust-with-milksnake"&gt;Python extensions in Rust&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Last December I decided to give it a run:
I spent some time porting the C++ bits of &lt;a href="https://github.com/dib-lab/sourmash"&gt;sourmash&lt;/a&gt;
to Rust.
The main advantage here is that it's a problem I know well,
so I know what the code is supposed to do and can focus on figuring out
syntax and the mental model for the language.
I started digging into the &lt;code&gt;symbolic&lt;/code&gt; codebase and understanding what they did,
and tried to mirror or improve it for my use cases.&lt;/p&gt;
&lt;p&gt;(About the post title: The process of converting a codebase to Rust is referred as &lt;a href="https://wiki.mozilla.org/Oxidation"&gt;"Oxidation"&lt;/a&gt; in
the Rust community, following the codename Mozilla chose for the process of
integrating Rust components into the Firefox codebase.
&lt;sup id=sf-sourmash-rust-1-back&gt;&lt;a href=#sf-sourmash-rust-1 class=simple-footnote title='The creator of the language is known to keep making up different explanations for the name of the language, but in this case "oxidation" refers to the chemical process that creates rust, and rust is the closest thing to metal (metal being the hardware). There are many terrible puns in the Rust community.'&gt;1&lt;/a&gt;&lt;/sup&gt;
Many of these components were tested and derived in Servo, an experimental
browser engine written in Rust, and are being integrated into Gecko,
the current browser engine (mostly written in C++).)&lt;/p&gt;
&lt;h2&gt;Why Rust?&lt;/h2&gt;
&lt;p&gt;There are other programming languages more focused on scientific software
that could be used instead, like Julia&lt;sup id=sf-sourmash-rust-2-back&gt;&lt;a href=#sf-sourmash-rust-2 class=simple-footnote title="Even more now that it hit 1.0, it is a really nice language"&gt;2&lt;/a&gt;&lt;/sup&gt;. Many programming languages start from a
specific niche (like R and statistics,
or Maple and mathematics) and grow into larger languages over time.
While Rust goal is not to be a scientific language,
its focus on being a general purpose language allows a phenomenon similar
to what happened with Python, where people from many areas pushed the
language in different directions (system scripting, web development,
numerical programming...) allowing developers to combine all these things
in their systems.&lt;/p&gt;
&lt;p&gt;But by far my interest in Rust is for the many best practices it brings to the default experience:
integrated package management (with Cargo),
documentation (with rustdoc), testing and benchmarking.
It's understandable that older languages like C/C++ need
more effort to support some of these features (like modules and an unified
build system), since they are designed by standard and need to keep backward
compatibility with codebases that already exist.
Nonetheless, the lack of features increase the effort needed to have good
software engineering practices, since you need to choose a solution that might
not be compatible with other similar but slightly different options,
leading to fragmentation and increasing the impedance to use these features.&lt;/p&gt;
&lt;p&gt;Another big reason is that Rust doesn't aim to completely replace what already
exists, but complement and extend it. Two very good talks about how to do this,
one by &lt;a href="https://ashleygwilliams.github.io/rustfest-2017/#1"&gt;Ashley Williams&lt;/a&gt;, another by &lt;a href="http://talks.edunham.net/lca2018/should-you-rewrite-in-rust/beamer.pdf"&gt;E. Dunham&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Converting from a C++ extension to Rust&lt;/h2&gt;
&lt;p&gt;The current implementation of the core data structures in sourmash is in a
C++ extension wrapped with Cython. My main goals for converting the code are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;support additional languages and platforms. sourmash is available as a Python
  package and CLI, but we have R users in the lab that would benefit from having
  an R package, and ideally we wouldn't need to rewrite the software every time
  we want to support a new language.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;reducing the number of wheel packages necessary (one for each OS/platform).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;in the long run, use the Rust memory management concepts (lifetimes, borrowing)
to increase parallelism in the code.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Many of these goals are attainable with our current C++ codebase, and
"rewrite in a new language" is rarely the best way to solve a problem.
But the reduced burden in maintenance due to better tooling,
on top of features that would require careful planning to execute
(increasing the parallelism without data races) while maintaining compatibility
with the current codebase are promising enough to justify this experiment.
&lt;a href="https://github.com/luizirber/2018-python-rust/blob/master/03.current_impl.md"&gt;&lt;img src="/images/arch_cpp.png" title="" current="" implementation""="" alt=""&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Cython provides a nice gradual path to migrate code from Python to C++,
since it is a superset of the Python syntax. It also provides low overhead
for many C++ features, especially the STL containers, with makes it easier
to map C++ features to the Python equivalent.
For research software this also lead to faster exploration of solutions before
having to commit to lower level code, but without a good process it might also
lead to code never crossing into the C++ layer and being stuck in the Cython
layer. This doesn't make any difference for a Python user, but it becomes
harder from users from other languages to benefit from this code (since your
language would need some kind of support to calling Python code, which is not
as readily available as calling C code).&lt;/p&gt;
&lt;p&gt;Depending on the requirements, a downside is that Cython is tied to the CPython API,
so generating the extension requires a development environment set up with
the appropriate headers and compiler. This also makes the extension specific
to a Python version: while this is not a problem for source distributions,
generating wheels lead to one wheel for each OS and Python version supported.&lt;/p&gt;
&lt;h2&gt;The new implementation&lt;/h2&gt;
&lt;p&gt;This is the overall architecture of the Rust implementation:
&lt;a href="https://github.com/luizirber/2018-python-rust/blob/master/04.rust_impl.md"&gt;&lt;img src="/images/arch_rust.png" title="" the="" rust="" implementation""="" alt=""&gt;&lt;/a&gt;
It is pretty close to what &lt;code&gt;symbolic&lt;/code&gt; does,
so let's walk through it.&lt;/p&gt;
&lt;h3&gt;The Rust code&lt;/h3&gt;
&lt;p&gt;If you take a look at my Rust code, you will see it is very... C++. A lot of the
code is very similar to the original implementation, which is both a curse and a
blessing: I'm pretty sure that are more idiomatic and performant ways of doing
things, but most of the time I could lean on my current mental model for C++ to
translate code. The biggest exception was the &lt;code&gt;merge&lt;/code&gt; function, were I was doing
something on the C++ implementation that the borrow checker didn't like.
Eventually I found it was because it couldn't keep track of the lifetime
correctly and putting braces around it fixed the problem,
which was both an epiphany and a WTF moment. &lt;a href="https://play.rust-lang.org/?gist=eae9de12950d1b2a7699cd49a3571c37&amp;amp;version=stable"&gt;Here&lt;/a&gt; is an example that triggers
the problem, and the &lt;a href="https://play.rust-lang.org/?gist=c8733c5125766930a589c8d0412af99c&amp;amp;version=stable"&gt;solution&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;"Fighting the borrow checker" seems to be a common theme while learning Rust,
but the compiler really tries to help you to understand what is happening and
(most times) how to fix it. A lot of people grow to hate the borrow checker,
but I see it more as a 'eat your vegetables' situation: you might not like it
at first, but it's better in the long run. Even though I don't have a big
codebase in Rust yet, it keeps you from doing things that will come back to bite
you hard later.&lt;/p&gt;
&lt;h3&gt;Generating C headers for Rust code: cbindgen&lt;/h3&gt;
&lt;p&gt;With the Rust library working, the next step was taking the Rust code and generate C headers describing the
functions and structs we expose with the &lt;code&gt;#[no_mangle]&lt;/code&gt; attribute in Rust
(these are defined in the &lt;a href="https://github.com/luizirber/sourmash-rust/blob/ead9ae0ed3b2d16c9e3b8379919f3bfd2efd21ae/src/ffi.rs"&gt;&lt;code&gt;ffi.rs&lt;/code&gt;&lt;/a&gt; module in &lt;code&gt;sourmash-rust&lt;/code&gt;).
This attribute tells the Rust compiler to generate names that are compatible
with the C ABI, and so can be called from other languages that implement FFI
mechanisms. FFI (the foreign function interface) is quite low-level,
and pretty much defines things that C can represent: integers, floats, pointers
and structs. It doesn't support higher level concepts like objects or generics,
so in a sense it looks like a feature funnel.
This might sound bad, but ends up being something that other languages can
understand without needing too much extra functionality in their runtimes,
which means that most languages have support to calling code through an FFI.&lt;/p&gt;
&lt;p&gt;Writing the C header by hand is possible, but is very error prone.
A better solution is to use &lt;a href="https://github.com/eqrion/cbindgen"&gt;&lt;code&gt;cbindgen&lt;/code&gt;&lt;/a&gt;,
a program that takes Rust code and generate a C header file automatically.
&lt;code&gt;cbindgen&lt;/code&gt; is developed primarily to generate the C headers for &lt;a href="https://github.com/servo/webrender/"&gt;webrender&lt;/a&gt;,
the GPU-based renderer for servo,
so it's pretty likely that if it can handle a complex codebase it will work
just fine for the majority of projects.&lt;/p&gt;
&lt;h3&gt;Interfacing with Python: CFFI and Milksnake&lt;/h3&gt;
&lt;p&gt;Once we have the C headers, we can use the FFI to
call Rust code in Python. Python has a FFI module in the standard library: &lt;code&gt;ctypes&lt;/code&gt;,
but the Pypy developers also created CFFI, which has more features.&lt;/p&gt;
&lt;p&gt;The C headers generated by cbindgen can be interpreted by CFFI to generate
a low-level Python interface for the code. This is the equivalent of declaring
the functions/methods and structs/classes in a &lt;code&gt;pxd&lt;/code&gt; file (in the Cython
world): while the code is now usable in Python, it is not well adapted to
the features and idioms available in the language.&lt;/p&gt;
&lt;p&gt;Milksnake is the package developed by Sentry that takes care of running cargo
for the Rust compilation and generating the CFFI boilerplate,
making it easy to load the low-level CFFI bindings in Python.
With this low-level binding available we can now write something more Pythonic
(the &lt;code&gt;pyx&lt;/code&gt; file in Cython), and I ended up just renaming the &lt;code&gt;_minhash.pyx&lt;/code&gt; file
back to &lt;code&gt;minhash.py&lt;/code&gt; and doing one-line fixes to replace the Cython-style code
with the equivalent CFFI calls.&lt;/p&gt;
&lt;p&gt;All of these changes should be transparent to the Python code, and to guarantee
that I made sure that all the current tests that we have (both for the Python
module and the command line interface) are still working after the changes.
It also led to finding some quirks in the implementation,
and even improvements in the current C++ code (because we were moving a lot of
data from C++ to Python).&lt;/p&gt;
&lt;h2&gt;Where I see this going&lt;/h2&gt;
&lt;p&gt;It seems it worked as an experiment,
and I presented a &lt;a href="https://github.com/luizirber/2018-python-rust"&gt;poster&lt;/a&gt; at &lt;a href="https://gccbosc2018.sched.com/event/FEWp/b23-oxidizing-python-writing-extensions-in-rust"&gt;GCCBOSC 2018&lt;/a&gt; and &lt;a href="https://scipy2018.scipy.org/ehome/index.php?eventid=299527&amp;amp;tabid=712461&amp;amp;cid=2233543&amp;amp;sessionid=21618890&amp;amp;sessionchoice=1&amp;amp;"&gt;SciPy 2018&lt;/a&gt; that
was met with excitement by many people.
Knowing that it is possible,
I want to reiterate some points why Rust is pretty exciting for bioinformatics
and science in general.&lt;/p&gt;
&lt;h3&gt;Bioinformatics as libraries (and command line tools too!)&lt;/h3&gt;
&lt;p&gt;Bioinformatics is an umbrella term for many different methods, depending on
what analysis you want to do with your data (or model).
In this sense, it's distinct from other scientific areas where it is possible
to rely on a common set of libraries (numpy in linear algebra, for example), since a
library supporting many disjoint methods tend to grow too big and hard to
maintain.&lt;/p&gt;
&lt;p&gt;The environment also tends to be very diverse, with different languages being
used to implement the software. Because it is hard to interoperate,
the methods tend to be implemented in command line programs that are stitched
together in pipelines, a workflow describing how to connect the input and output of many different tools to
generate results.
Because the basic unit is a command-line tool,
pipelines tend to rely on standard operating system abstractions like
files and pipes to make the tools communicate with each other. But since tools
might have input requirements distinct from what the previous tool provides,
many times it is necessary to do format conversion or other adaptations to make the
pipeline work.&lt;/p&gt;
&lt;p&gt;Using tools as blackboxes, controllable through specific parameters at the
command-line level, make exploratory analysis and algorithm reuse harder:
if something needs to be investigated the user needs to resort to perturbations
of the parameters or the input data, without access to the more feature-rich and
meaningful abstraction happening inside the tool.&lt;/p&gt;
&lt;p&gt;Even if many languages are used for writing the software, most of the time there
is some part written in C or C++ for performance reasons, and these tend to be
the core data structures of the computational method. Because it is not easy to
package your C/C++ code in a way that other people can readily use it,
most of this code is reinvented over and over again, or is copy and pasted into
codebases and start diverging over time. Rust helps solve this problem with the
integrated package management, and due to the FFI it can also be reused inside
other programs written in other languages.&lt;/p&gt;
&lt;p&gt;sourmash is not going to be Rust-only and abandon Python,
and it would be crazy to do so when it has so many great exploratory tools
for scientific discovery. But now we can also use our method in other languages
and environment, instead of having our code stuck in one language.&lt;/p&gt;
&lt;h3&gt;Don't rewrite it all!&lt;/h3&gt;
&lt;p&gt;I could have gone all the way and rewrite sourmash in Rust&lt;sup id=sf-sourmash-rust-3-back&gt;&lt;a href=#sf-sourmash-rust-3 class=simple-footnote title="and risk being kicked out of the lab =P"&gt;3&lt;/a&gt;&lt;/sup&gt;, but it would be incredibly disruptive for
the current sourmash users and it would take way longer to pull off. Because
Rust is so focused in supporting existing code, you can do a slow transition and
reuse what you already have while moving into more and more Rust code.
A great example is this one-day effort by Rob Patro to bring &lt;a href="https://github.com/COMBINE-lab/cqf-rust"&gt;CQF&lt;/a&gt; (a C
codebase) into Rust, using &lt;code&gt;bindgen&lt;/code&gt; (a generator of C bindings for Rust).
Check &lt;a href="https://blog.luizirber.org/2018/08/27/sourmash-wasm/"&gt;the Twitter thread&lt;/a&gt; for more =]&lt;/p&gt;
&lt;h3&gt;Good scientific citizens&lt;/h3&gt;
&lt;p&gt;There is another MinHash implementation already written in Rust, &lt;a href="https://github.com/onecodex/finch-rs"&gt;finch&lt;/a&gt;.
Early in my experiment I got an email from them asking if I wanted to work
together, but since I wanted to learn the language I kept doing my thing. (They
were totally cool with this, by the way). But the fun thing is that Rust has a
pair of traits called &lt;a href="https://doc.rust-lang.org/rust-by-example/conversion/from_into.html"&gt;&lt;code&gt;From&lt;/code&gt; and &lt;code&gt;Into&lt;/code&gt;&lt;/a&gt; that you can implement for your
type, and so I &lt;a href="https://github.com/luizirber/sourmash-rust/pull/1"&gt;did that&lt;/a&gt; and now we can have interoperable
implementations. This synergy allows &lt;code&gt;finch&lt;/code&gt; to use &lt;code&gt;sourmash&lt;/code&gt; methods,
and vice versa.&lt;/p&gt;
&lt;p&gt;Maybe this sounds like a small thing, but I think it is really exciting. We can
stop having incompatible but very similar methods, and instead all benefit from
each other advances in a way that is supported by the language.&lt;/p&gt;
&lt;h2&gt;Next time!&lt;/h2&gt;
&lt;p&gt;Turns out Rust supports WebAssembly as a target,
so... what if we run sourmash in the browser?
That's what I'm covering in the &lt;a href="https://blog.luizirber.org/2018/08/27/sourmash-wasm/"&gt;next blog post&lt;/a&gt;,
so stay tuned =]&lt;/p&gt;
&lt;h2&gt;Comments?&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://social.lasanha.org/@luizirber/100602525575698239"&gt;Thread on Mastodon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.reddit.com/r/rust/comments/99vakd/blog_post_converting_c_to_rust_and_interoperate/"&gt;Thread on reddit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twitter.com/luizirber/status/1032779995129597952"&gt;Thread on Twitter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- rust libs --&gt;

&lt;!-- why rust --&gt;

&lt;!-- WASM and demos --&gt;

&lt;!-- python and FFI --&gt;

&lt;!-- rust examples --&gt;

&lt;!-- cbindgen --&gt;

&lt;!-- rust for pythonistas --&gt;

&lt;!-- understanding rust --&gt;

&lt;!-- rust and bio --&gt;

&lt;!-- rust error handling --&gt;

&lt;!-- other notes

- Implement Default trait for defaults (less verbose than ::new...)
  https://doc.rust-lang.org/std/default/trait.Default.html

--&gt;&lt;section class=footnotes&gt;&lt;hr&gt;&lt;h2&gt;Footnotes&lt;/h2&gt;&lt;ol&gt;&lt;li id=sf-sourmash-rust-1&gt;&lt;p&gt;The creator of the language is known to keep making up different
explanations for the &lt;a href="https://www.reddit.com/r/rust/comments/27jvdt/internet_archaeology_the_definitive_endall_source/"&gt;name of the language&lt;/a&gt;,
but in this case "oxidation" refers to the chemical process that creates
rust, and rust is the closest thing to metal (metal being the hardware).
There are many terrible puns in the Rust community. &lt;a href=#sf-sourmash-rust-1-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li id=sf-sourmash-rust-2&gt;&lt;p&gt;Even more now that it hit 1.0,
it is a really nice language &lt;a href=#sf-sourmash-rust-2-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li id=sf-sourmash-rust-3&gt;&lt;p&gt;and risk
being kicked out of the lab =P &lt;a href=#sf-sourmash-rust-3-back class=simple-footnote-back&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/section&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Thu, 23 Aug 2018 17:00:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2018-08-23:/2018/08/23/sourmash-rust/</guid><category>universidade</category><category>rust</category><category>sourmash</category><category>python</category></item><item><title>Minhashing all the things (part 1): microbial genomes</title><link>https://blog.luizirber.org/2016/12/28/soursigs-arch-1/</link><description>&lt;p&gt;With the &lt;a href="http://ivory.idyll.org/blog/2016-sourmash-sbt.html"&gt;MinHash&lt;/a&gt; &lt;a href="http://ivory.idyll.org/blog/2016-sourmash-sbt-more.html"&gt;craze&lt;/a&gt; currently going on in the &lt;a href="http://ivory.idyll.org/lab/"&gt;lab&lt;/a&gt;,
we started discussing how to calculate signatures efficiently,
how to index them for search and also how to distribute them.
As a proof of concept I started implementing a system to read public data available on the &lt;a href="https://www.ncbi.nlm.nih.gov/sra"&gt;Sequence Read Archive&lt;/a&gt;,
as well as a variation of the &lt;a href="https://www.cs.cmu.edu/~ckingsf/software/bloomtree/"&gt;Sequence Bloom Tree&lt;/a&gt; using Minhashes as leaves/datasets instead of the whole k-mer set (as Bloom Filters).&lt;/p&gt;
&lt;p&gt;Since this is a PoC,
I also wanted to explore some solutions that allow maintaining the least amount of explicit servers:
I'm OK with offloading a queue system to &lt;a href="https://aws.amazon.com/sqs/"&gt;Amazon SQS&lt;/a&gt; instead of maintaining a server running &lt;a href="https://www.rabbitmq.com/"&gt;RabbitMQ&lt;/a&gt;,
for example.
Even with all the DevOps movement you still can't ignore the Ops part,
and if you have a team to run your infrastructure,
good for you!
But I'm a grad student and the last thing I want to be doing is babysitting servers =]&lt;/p&gt;
&lt;h2&gt;Going serverless: AWS Lambda&lt;/h2&gt;
&lt;p&gt;The first plan was to use &lt;a href="https://aws.amazon.com/lambda/"&gt;AWS Lambda&lt;/a&gt; to calculate signatures.
Lambda is a service that exposes functions,
and it manages all the runtime details (server provisioning and so on),
while charging by the time and memory it takes to run the function.
Despite all the promises,
it is a bit annoying to balance everything to make an useful Lambda,
so I used the &lt;a href="https://gordon.readthedocs.io/en/latest/"&gt;Gordon framework&lt;/a&gt; to structure it.
I was pretty happy with it,
until I added our &lt;a href="https://github.com/dib-lab/sourmash"&gt;MinHash package&lt;/a&gt; and,
since it is a C++ extension,
needed to compile and send the resulting package to Lambda.
I was using my local machine for that,
but Lambda packaging is pretty much 'put all the Python files in one directory,
compress and upload it to S3',
which of course didn't work because I don't have the same library versions that &lt;a href="https://aws.amazon.com/amazon-linux-ami/"&gt;Amazon Linux&lt;/a&gt; runs.
I managed to hack a &lt;a href="https://github.com/jorgebastida/gordon/compare/master...luizirber:refactor/python_package"&gt;fix&lt;/a&gt;,
but it would be wonderful if Amazon adopted wheels and stayed more in line with the &lt;a href="https://packaging.python.org/"&gt;Python Package Authority&lt;/a&gt; solutions
(and hey, &lt;a href="https://www.python.org/dev/peps/pep-0513/"&gt;binary wheels&lt;/a&gt; even work on Linux now!).&lt;/p&gt;
&lt;p&gt;Anyway,
after I deployed the Lambda function and tried to run it...
I fairly quickly realized that 5 minutes is far too short to calculate a signature.
This is not a CPU-bound problem,
it's just that we are downloading the data and network I/O is the bottleneck.
I think Lambda will still be a good solution together with &lt;a href="https://aws.amazon.com/api-gateway/"&gt;API Gateway&lt;/a&gt;
for triggering calculations and providing other useful services despite the drawbacks,
but at this point I started looking for alternative architectures.&lt;/p&gt;
&lt;h2&gt;Back to the comfort zone: Snakemake&lt;/h2&gt;
&lt;p&gt;Focusing on computing signatures first and thinking about other issues later,
I wrote a quick &lt;a href="https://bitbucket.org/snakemake/snakemake/wiki/Home"&gt;Snakemake&lt;/a&gt; rules file and started calculating signatures
for all the &lt;a href="https://github.com/luizirber/soursigs/blob/6c6acf6429cec2e2e4a076dfc32adbf27fab1eed/Snakefile#L81"&gt;transcriptomic&lt;/a&gt; datasets I could find on the SRA.
Totaling 671 TB,
it was way over my storage capacity,
but since both the &lt;a href="https://github.com/ncbi/sra-tools"&gt;SRA Toolkit&lt;/a&gt; and &lt;a href="https://github.com/dib-lab/sourmash"&gt;sourmash&lt;/a&gt; have streaming modes,
I piped the output of the first as the input for the second and... voila!
We have a duct-taped but working system.
Again,
the issue becomes network bottlenecks:
the SRA seems to limit each IP to ~100 Mbps,
it would take 621 days to calculate everything.
Classes were happening during these development,
so I just considered it good enough and started running it in a 32-core server hosted at &lt;a href="https://www.rackspace.com/openstack/public"&gt;Rackspace&lt;/a&gt;
to at least have some signatures to play with.&lt;/p&gt;
&lt;h2&gt;Offloading computation: Celery + Amazon SQS&lt;/h2&gt;
&lt;p&gt;With classes over,
we changed directions a bit:
instead of going through the transcriptomic dataset,
we decided to focus on microbial genomes,
especially all those unassembled ones on SRA.
(We didn't forget the transcriptomic dataset,
but microbial genomes are small-ish,
more manageable and we already have the microbial SBTs to search against).
There are 412k SRA IDs matching the &lt;a href="https://github.com/luizirber/soursigs/blob/a049cbc5733adbcffaaf91e176bbcda43763ed23/Snakefile#L71"&gt;new search&lt;/a&gt;,
totalling 28 TB of data.
We have storage to save it,
but since we want a scalable solution (something that would work with the 8 PB of data in the SRA,
for example),
I avoided downloading all the data beforehand and kept doing it in a streaming way.&lt;/p&gt;
&lt;p&gt;I started to redesign the Snakemake solution:
first thing was to move the body of the rule to a &lt;a href="http://docs.celeryproject.org/en/latest/userguide/tasks.html"&gt;Celery task&lt;/a&gt;
and use Snakemake to control what tasks to run and get the results,
but send the computation to a (local or remote) Celery worker.
I checked other work queue solutions,
but they were either too simple or required running specialized servers.
(and thanks to &lt;a href="http://ggmarcondes.com"&gt;Gabriel Marcondes&lt;/a&gt; for enlightening me about how to best
use Celery!).
With Celery I managed to use &lt;a href="https://aws.amazon.com/sqs/"&gt;Amazon SQS&lt;/a&gt; as a broker
(the queue of tasks to be executed,
in Celery parlance),
and &lt;a href="https://github.com/robgolding/celery-s3"&gt;celery-s3&lt;/a&gt; as the results backend.
While not an official part of Celery,
using S3 to keep results allowed to avoid deploying another service
(usually Celery uses redis or RabbitMQ for result backend).
I didn't configure it properly tho,
and ended up racking up \$200 in charges because I was querying S3 too much,
but my advisor thought it was &lt;a href="https://twitter.com/ctitusbrown/status/812003429535006721"&gt;funny and mocked me on Twitter&lt;/a&gt; (I don't mind,
he is the one paying the bill =P).
For initial tests I just ran the workers locally on the 32-core server,
but... What if the worker was easy to deploy,
and other people wanted to run additional workers?&lt;/p&gt;
&lt;h3&gt;Docker workers&lt;/h3&gt;
&lt;p&gt;I wrote a &lt;a href="https://github.com/luizirber/soursigs/blob/6c6acf6429cec2e2e4a076dfc32adbf27fab1eed/Dockerfile"&gt;Dockerfile&lt;/a&gt; with all the dependencies,
and made it available on &lt;a href="https://hub.docker.com/r/luizirber/soursigs/tags/"&gt;Docker hub&lt;/a&gt;.
I still need to provide credentials to access SQS and S3,
but now I can deploy workers anywhere,
even... on the &lt;a href="https://cloud.google.com/"&gt;Google Cloud Platform&lt;/a&gt;.
They have a free trial with \$300 in credits,
so I used the &lt;a href="https://cloud.google.com/container-engine/"&gt;Container Engine&lt;/a&gt; to deploy a &lt;a href="http://kubernetes.io/"&gt;Kubernetes&lt;/a&gt; cluster and run
workers under a &lt;a href="http://kubernetes.io/docs/user-guide/replication-controller/"&gt;Replication Controller&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Just to keep track: we are posting Celery tasks from a Rackspace server
to Amazon SQS,
running workers inside Docker managed by Kubernetes on GCP,
putting results on Amazon S3
and finally reading the results on Rackspace and then posting it to &lt;a href="https://ipfs.io/ipns/minhash.oxli.org/microbial/"&gt;IPFS&lt;/a&gt;.
IPFS is the Interplanetary File System,
a decentralized solution to share data.
But more about this later!&lt;/p&gt;
&lt;h3&gt;HPCC workers&lt;/h3&gt;
&lt;p&gt;Even with Docker workers running on GCP and the Rackspace server,
it was progressing slowly and,
while it wouldn't be terribly expensive to spin up more nodes on GCP,
I decided to go use the resources we already have:
the &lt;a href="https://wiki.hpcc.msu.edu/"&gt;MSU HPCC&lt;/a&gt;.
I couldn't run Docker containers there (HPC is wary of Docker,
but &lt;a href="https://github.com/NERSC/2016-11-14-sc16-Container-Tutorial"&gt;we are trying to change that!&lt;/a&gt;),
so I used Conda to create a clean environment and used the &lt;a href="https://github.com/luizirber/soursigs/blob/a049cbc5733adbcffaaf91e176bbcda43763ed23/requirements.txt"&gt;requirements&lt;/a&gt;
file (coupled with some &lt;code&gt;PATH&lt;/code&gt; magic) to replicate what I have inside the Docker container.
The Dockerfile was very useful,
because I mostly ran the same commands to recreate the environment.
Finally,
I wrote a &lt;a href="https://github.com/luizirber/soursigs/blob/a049cbc5733adbcffaaf91e176bbcda43763ed23/submit"&gt;submission script&lt;/a&gt; to start a job array with 40 jobs,
and after a bit of tuning I decided to use 12 Celery workers for each job,
totalling 480 workers.&lt;/p&gt;
&lt;p&gt;This solution still requires a bit of babysitting,
especially when I was tuning how many workers to run per job,
but it achieved around 1600 signatures per hour,
leading to about 10 days to calculate for all 412k datasets.
Instead of downloading the whole dataset,
we are &lt;a href="https://github.com/luizirber/soursigs/blob/a049cbc5733adbcffaaf91e176bbcda43763ed23/soursigs/tasks.py#L15"&gt;reading the first million reads&lt;/a&gt; and using our &lt;a href="https://peerj.com/preprints/890/"&gt;streaming error trimming&lt;/a&gt;
solution to calculate the signatures
(and also to test if it is the best solution for this case).&lt;/p&gt;
&lt;h3&gt;Clever algorithms are better than brute force?&lt;/h3&gt;
&lt;p&gt;While things were progressing,
Titus was using the &lt;a href="https://github.com/dib-lab/sourmash/pull/45"&gt;Sequence Bloom Tree + Minhash&lt;/a&gt; code to categorize the new datasets into the 50k genomes in the [RefSeq] database,
but 99\% of the signatures didn't match anything.
After assembling a dataset that didn't match,
he found out it did match something,
so... The current approach is not so good.&lt;/p&gt;
&lt;p&gt;(UPDATE: it was a bug in the search,
so this way of calculating signatures probably also work.
Anyway,
the next approach is faster and more reasonable,
so yay bug!)&lt;/p&gt;
&lt;p&gt;Yesterday he came up with a new way to filter solid k-mers instead of doing
error trimming (and named it... &lt;a href="https://github.com/dib-lab/syrah"&gt;syrah&lt;/a&gt;?
Oh, SyRAh...
So many puns in this lab).
I &lt;a href="https://github.com/luizirber/soursigs/blob/a049cbc5733adbcffaaf91e176bbcda43763ed23/soursigs/tasks.py#L34"&gt;created a new Celery task&lt;/a&gt; and refactored the Snakemake rule,
and started running it again...
And wow is it faster!
It is currently doing around 4200 signatures per hour,
and it will end in less than five days.
The syrah approach probably works for the vast majority of the SRA,
but metagenomes and metatranscriptomes will probably fail because the minority members of the population will not be represented.
But hey,
we have people in the lab working on that too =]&lt;/p&gt;
&lt;h1&gt;Future&lt;/h1&gt;
&lt;p&gt;The solution works,
but several improvements can be made.
First,
I use Snakemake at both ends,
both to keep track of the work done and get the workers results.
I can make the workers a bit smarter and post the results to a S3 bucket,
and so I only need to use Snakemake to track what work needs to be done and post tasks to the queue.
This removes the need for celery-s3 and querying S3 all the time,
and opens the path to use Lambda again to trigger updates to IPFS.&lt;/p&gt;
&lt;p&gt;I'm insisting on using IPFS to make the data available because...
Well, it is super cool!
I always wanted to have a system like bittorrent to distribute data,
but IPFS builds up on top of other very good ideas from bitcoin (bitswap),
and git (the DAG representation) to make a resilient system and,
even more important,
something that can be used in a scientific context to both increase bandwidth for important resources (like, well, the SRA)
and to make sure data can stay around if the centralized solution goes away.
The &lt;a href="https://github.com/ga4gh/cgtd"&gt;Cancer Gene Trust&lt;/a&gt; project is already using it,
and I do hope more projects show up and adopt IPFS as a first-class dependency.
And,
even crazier,
we can actually use IPFS to store our SBT implementation,
but more about this in part 2!&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Wed, 28 Dec 2016 12:00:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2016-12-28:/2016/12/28/soursigs-arch-1/</guid><category>universidade</category></item><item><title>When life gives you lemons</title><link>https://blog.luizirber.org/2015/10/05/zotero/</link><description>&lt;p&gt;Two weeks ago,
during the CS graduate orientation at &lt;a href="http://ucdavis.edu"&gt;UC Davis&lt;/a&gt;,
the IT person was showing that we have access to 50 GB on &lt;a href="https://ucdavis.box.com/"&gt;Box&lt;/a&gt; and UNLIMITED storage on Google Drive
(I'm currently testing the limits of UNLIMITED, stay tuned).
I promptly forgot about Box because I've been using Syncthing for file syncing and it's been working quite well,
or at least way better than owncloud (which took infinite amounts of time to sync my stuff).&lt;/p&gt;
&lt;p&gt;Anyway,
today I was checking &lt;a href="http://www.papershipapp.com/"&gt;PaperShip&lt;/a&gt; (wonderful app, by the way)
and noticed my &lt;a href="https://www.zotero.org/"&gt;Zotero&lt;/a&gt; free account was almost full (it is only 300 MB).
I knew Zotero had &lt;a href="https://www.zotero.org/support/sync#webdav"&gt;WebDAV&lt;/a&gt; support,
but I don't want to maintain a WebDAV server.
Turns out Box has &lt;a href="https://support.box.com/hc/en-us/articles/200519748-Does-Box-support-WebDAV-"&gt;WebDAV support&lt;/a&gt;,
and even found &lt;a href="http://web.archive.org/web/20180617051357/http://guides.library.cornell.edu/zotero_to_Box"&gt;instructions&lt;/a&gt; on how to set everything up.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Mon, 05 Oct 2015 12:00:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2015-10-05:/2015/10/05/zotero/</guid><category>universidade</category></item><item><title>HOWTO: Moleculo raw reads coverage in reference genome</title><link>https://blog.luizirber.org/2014/02/12/moleculo/</link><description>&lt;style type="text/css"&gt;/*!
*
* IPython notebook
*
*/
/* CSS font colors for translated ANSI colors. */
.ansibold {
  font-weight: bold;
}
/* use dark versions for foreground, to improve visibility */
.ansiblack {
  color: black;
}
.ansired {
  color: darkred;
}
.ansigreen {
  color: darkgreen;
}
.ansiyellow {
  color: #c4a000;
}
.ansiblue {
  color: darkblue;
}
.ansipurple {
  color: darkviolet;
}
.ansicyan {
  color: steelblue;
}
.ansigray {
  color: gray;
}
/* and light for background, for the same reason */
.ansibgblack {
  background-color: black;
}
.ansibgred {
  background-color: red;
}
.ansibggreen {
  background-color: green;
}
.ansibgyellow {
  background-color: yellow;
}
.ansibgblue {
  background-color: blue;
}
.ansibgpurple {
  background-color: magenta;
}
.ansibgcyan {
  background-color: cyan;
}
.ansibggray {
  background-color: gray;
}
div.cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  border-radius: 2px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  border-width: 1px;
  border-style: solid;
  border-color: transparent;
  width: 100%;
  padding: 5px;
  /* This acts as a spacer between cells, that is outside the border */
  margin: 0px;
  outline: none;
  border-left-width: 1px;
  padding-left: 5px;
  background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%);
}
div.cell.jupyter-soft-selected {
  border-left-color: #90CAF9;
  border-left-color: #E3F2FD;
  border-left-width: 1px;
  padding-left: 5px;
  border-right-color: #E3F2FD;
  border-right-width: 1px;
  background: #E3F2FD;
}
@media print {
  div.cell.jupyter-soft-selected {
    border-color: transparent;
  }
}
div.cell.selected {
  border-color: #ababab;
  border-left-width: 0px;
  padding-left: 6px;
  background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 5px, transparent 5px, transparent 100%);
}
@media print {
  div.cell.selected {
    border-color: transparent;
  }
}
div.cell.selected.jupyter-soft-selected {
  border-left-width: 0;
  padding-left: 6px;
  background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 7px, #E3F2FD 7px, #E3F2FD 100%);
}
.edit_mode div.cell.selected {
  border-color: #66BB6A;
  border-left-width: 0px;
  padding-left: 6px;
  background: linear-gradient(to right, #66BB6A -40px, #66BB6A 5px, transparent 5px, transparent 100%);
}
@media print {
  .edit_mode div.cell.selected {
    border-color: transparent;
  }
}
.prompt {
  /* This needs to be wide enough for 3 digit prompt numbers: In[100]: */
  min-width: 14ex;
  /* This padding is tuned to match the padding on the CodeMirror editor. */
  padding: 0.4em;
  margin: 0px;
  font-family: monospace;
  text-align: right;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
  /* Don't highlight prompt number selection */
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  /* Use default cursor */
  cursor: default;
}
@media (max-width: 540px) {
  .prompt {
    text-align: left;
  }
}
div.inner_cell {
  min-width: 0;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_area {
  border: 1px solid #cfcfcf;
  border-radius: 2px;
  background: #f7f7f7;
  line-height: 1.21429em;
}
/* This is needed so that empty prompt areas can collapse to zero height when there
   is no content in the output_subarea and the prompt. The main purpose of this is
   to make sure that empty JavaScript output_subareas have no height. */
div.prompt:empty {
  padding-top: 0;
  padding-bottom: 0;
}
div.unrecognized_cell {
  padding: 5px 5px 5px 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.unrecognized_cell .inner_cell {
  border-radius: 2px;
  padding: 5px;
  font-weight: bold;
  color: red;
  border: 1px solid #cfcfcf;
  background: #eaeaea;
}
div.unrecognized_cell .inner_cell a {
  color: inherit;
  text-decoration: none;
}
div.unrecognized_cell .inner_cell a:hover {
  color: inherit;
  text-decoration: none;
}
@media (max-width: 540px) {
  div.unrecognized_cell &gt; div.prompt {
    display: none;
  }
}
div.code_cell {
  /* avoid page breaking on code cells when printing */
}
@media print {
  div.code_cell {
    page-break-inside: avoid;
  }
}
/* any special styling for code cells that are currently running goes here */
div.input {
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.input {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_prompt {
  color: #303F9F;
  border-top: 1px solid transparent;
}
div.input_area &gt; div.highlight {
  margin: 0.4em;
  border: none;
  padding: 0px;
  background-color: transparent;
}
div.input_area &gt; div.highlight &gt; pre {
  margin: 0px;
  border: none;
  padding: 0px;
  background-color: transparent;
}
/* The following gets added to the &lt;head&gt; if it is detected that the user has a
 * monospace font with inconsistent normal/bold/italic height.  See
 * notebookmain.js.  Such fonts will have keywords vertically offset with
 * respect to the rest of the text.  The user should select a better font.
 * See: https://github.com/ipython/ipython/issues/1503
 *
 * .CodeMirror span {
 *      vertical-align: bottom;
 * }
 */
.CodeMirror {
  line-height: 1.21429em;
  /* Changed from 1em to our global default */
  font-size: 14px;
  height: auto;
  /* Changed to auto to autogrow */
  background: none;
  /* Changed from white to allow our bg to show through */
}
.CodeMirror-scroll {
  /*  The CodeMirror docs are a bit fuzzy on if overflow-y should be hidden or visible.*/
  /*  We have found that if it is visible, vertical scrollbars appear with font size changes.*/
  overflow-y: hidden;
  overflow-x: auto;
}
.CodeMirror-lines {
  /* In CM2, this used to be 0.4em, but in CM3 it went to 4px. We need the em value because */
  /* we have set a different line-height and want this to scale with that. */
  padding: 0.4em;
}
.CodeMirror-linenumber {
  padding: 0 8px 0 4px;
}
.CodeMirror-gutters {
  border-bottom-left-radius: 2px;
  border-top-left-radius: 2px;
}
.CodeMirror pre {
  /* In CM3 this went to 4px from 0 in CM2. We need the 0 value because of how we size */
  /* .CodeMirror-lines */
  padding: 0;
  border: 0;
  border-radius: 0;
}
/*

Original style from softwaremaniacs.org (c) Ivan Sagalaev &lt;Maniac@SoftwareManiacs.Org&gt;
Adapted from GitHub theme

*/
.highlight-base {
  color: #000;
}
.highlight-variable {
  color: #000;
}
.highlight-variable-2 {
  color: #1a1a1a;
}
.highlight-variable-3 {
  color: #333333;
}
.highlight-string {
  color: #BA2121;
}
.highlight-comment {
  color: #408080;
  font-style: italic;
}
.highlight-number {
  color: #080;
}
.highlight-atom {
  color: #88F;
}
.highlight-keyword {
  color: #008000;
  font-weight: bold;
}
.highlight-builtin {
  color: #008000;
}
.highlight-error {
  color: #f00;
}
.highlight-operator {
  color: #AA22FF;
  font-weight: bold;
}
.highlight-meta {
  color: #AA22FF;
}
/* previously not defined, copying from default codemirror */
.highlight-def {
  color: #00f;
}
.highlight-string-2 {
  color: #f50;
}
.highlight-qualifier {
  color: #555;
}
.highlight-bracket {
  color: #997;
}
.highlight-tag {
  color: #170;
}
.highlight-attribute {
  color: #00c;
}
.highlight-header {
  color: blue;
}
.highlight-quote {
  color: #090;
}
.highlight-link {
  color: #00c;
}
/* apply the same style to codemirror */
.cm-s-ipython span.cm-keyword {
  color: #008000;
  font-weight: bold;
}
.cm-s-ipython span.cm-atom {
  color: #88F;
}
.cm-s-ipython span.cm-number {
  color: #080;
}
.cm-s-ipython span.cm-def {
  color: #00f;
}
.cm-s-ipython span.cm-variable {
  color: #000;
}
.cm-s-ipython span.cm-operator {
  color: #AA22FF;
  font-weight: bold;
}
.cm-s-ipython span.cm-variable-2 {
  color: #1a1a1a;
}
.cm-s-ipython span.cm-variable-3 {
  color: #333333;
}
.cm-s-ipython span.cm-comment {
  color: #408080;
  font-style: italic;
}
.cm-s-ipython span.cm-string {
  color: #BA2121;
}
.cm-s-ipython span.cm-string-2 {
  color: #f50;
}
.cm-s-ipython span.cm-meta {
  color: #AA22FF;
}
.cm-s-ipython span.cm-qualifier {
  color: #555;
}
.cm-s-ipython span.cm-builtin {
  color: #008000;
}
.cm-s-ipython span.cm-bracket {
  color: #997;
}
.cm-s-ipython span.cm-tag {
  color: #170;
}
.cm-s-ipython span.cm-attribute {
  color: #00c;
}
.cm-s-ipython span.cm-header {
  color: blue;
}
.cm-s-ipython span.cm-quote {
  color: #090;
}
.cm-s-ipython span.cm-link {
  color: #00c;
}
.cm-s-ipython span.cm-error {
  color: #f00;
}
.cm-s-ipython span.cm-tab {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=);
  background-position: right;
  background-repeat: no-repeat;
}
div.output_wrapper {
  /* this position must be relative to enable descendents to be absolute within it */
  position: relative;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  z-index: 1;
}
/* class for the output area when it should be height-limited */
div.output_scroll {
  /* ideally, this would be max-height, but FF barfs all over that */
  height: 24em;
  /* FF needs this *and the wrapper* to specify full width, or it will shrinkwrap */
  width: 100%;
  overflow: auto;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  display: block;
}
/* output div while it is collapsed */
div.output_collapsed {
  margin: 0px;
  padding: 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
div.out_prompt_overlay {
  height: 100%;
  padding: 0px 0.4em;
  position: absolute;
  border-radius: 2px;
}
div.out_prompt_overlay:hover {
  /* use inner shadow to get border that is computed the same on WebKit/FF */
  -webkit-box-shadow: inset 0 0 1px #000;
  box-shadow: inset 0 0 1px #000;
  background: rgba(240, 240, 240, 0.5);
}
div.output_prompt {
  color: #D84315;
}
/* This class is the outer container of all output sections. */
div.output_area {
  padding: 0px;
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.output_area .MathJax_Display {
  text-align: left !important;
}
div.output_area 
div.output_area 
div.output_area img,
div.output_area svg {
  max-width: 100%;
  height: auto;
}
div.output_area img.unconfined,
div.output_area svg.unconfined {
  max-width: none;
}
/* This is needed to protect the pre formating from global settings such
   as that of bootstrap */
.output {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.output_area {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
div.output_area pre {
  margin: 0;
  padding: 0;
  border: 0;
  vertical-align: baseline;
  color: black;
  background-color: transparent;
  border-radius: 0;
}
/* This class is for the output subarea inside the output_area and after
   the prompt div. */
div.output_subarea {
  overflow-x: auto;
  padding: 0.4em;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
  max-width: calc(100% - 14ex);
}
div.output_scroll div.output_subarea {
  overflow-x: visible;
}
/* The rest of the output_* classes are for special styling of the different
   output types */
/* all text output has this class: */
div.output_text {
  text-align: left;
  color: #000;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
}
/* stdout/stderr are 'text' as well as 'stream', but execute_result/error are *not* streams */
div.output_stderr {
  background: #fdd;
  /* very light red background for stderr */
}
div.output_latex {
  text-align: left;
}
/* Empty output_javascript divs should have no height */
div.output_javascript:empty {
  padding: 0;
}
.js-error {
  color: darkred;
}
/* raw_input styles */
div.raw_input_container {
  line-height: 1.21429em;
  padding-top: 5px;
}
pre.raw_input_prompt {
  /* nothing needed here. */
}
input.raw_input {
  font-family: monospace;
  font-size: inherit;
  color: inherit;
  width: auto;
  /* make sure input baseline aligns with prompt */
  vertical-align: baseline;
  /* padding + margin = 0.5em between prompt and cursor */
  padding: 0em 0.25em;
  margin: 0em 0.25em;
}
input.raw_input:focus {
  box-shadow: none;
}
p.p-space {
  margin-bottom: 10px;
}
div.output_unrecognized {
  padding: 5px;
  font-weight: bold;
  color: red;
}
div.output_unrecognized a {
  color: inherit;
  text-decoration: none;
}
div.output_unrecognized a:hover {
  color: inherit;
  text-decoration: none;
}
.rendered_html {
  color: #000;
  /* any extras will just be numbers: */
}



.rendered_html :link {
  text-decoration: underline;
}
.rendered_html :visited {
  text-decoration: underline;
}






.rendered_html h1:first-child {
  margin-top: 0.538em;
}
.rendered_html h2:first-child {
  margin-top: 0.636em;
}
.rendered_html h3:first-child {
  margin-top: 0.777em;
}
.rendered_html h4:first-child {
  margin-top: 1em;
}
.rendered_html h5:first-child {
  margin-top: 1em;
}
.rendered_html h6:first-child {
  margin-top: 1em;
}








.rendered_html * + ul {
  margin-top: 1em;
}
.rendered_html * + ol {
  margin-top: 1em;
}


.rendered_html pre,



.rendered_html tr,
.rendered_html th,

.rendered_html td,


.rendered_html * + table {
  margin-top: 1em;
}

.rendered_html * + p {
  margin-top: 1em;
}

.rendered_html * + img {
  margin-top: 1em;
}
.rendered_html img,

.rendered_html img.unconfined,

div.text_cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.text_cell &gt; div.prompt {
    display: none;
  }
}
div.text_cell_render {
  /*font-family: "Helvetica Neue", Arial, Helvetica, Geneva, sans-serif;*/
  outline: none;
  resize: none;
  width: inherit;
  border-style: none;
  padding: 0.5em 0.5em 0.5em 0.4em;
  color: #000;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
a.anchor-link:link {
  text-decoration: none;
  padding: 0px 20px;
  visibility: hidden;
}
h1:hover .anchor-link,
h2:hover .anchor-link,
h3:hover .anchor-link,
h4:hover .anchor-link,
h5:hover .anchor-link,
h6:hover .anchor-link {
  visibility: visible;
}
.text_cell.rendered .input_area {
  display: none;
}
.text_cell.rendered 
.text_cell.unrendered .text_cell_render {
  display: none;
}
.cm-header-1,
.cm-header-2,
.cm-header-3,
.cm-header-4,
.cm-header-5,
.cm-header-6 {
  font-weight: bold;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}
.cm-header-1 {
  font-size: 185.7%;
}
.cm-header-2 {
  font-size: 157.1%;
}
.cm-header-3 {
  font-size: 128.6%;
}
.cm-header-4 {
  font-size: 110%;
}
.cm-header-5 {
  font-size: 100%;
  font-style: italic;
}
.cm-header-6 {
  font-size: 100%;
  font-style: italic;
}
&lt;/style&gt;
&lt;style type="text/css"&gt;.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sa { color: #BA2121 } /* Literal.String.Affix */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0000FF } /* Name.Function.Magic */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .vm { color: #19177C } /* Name.Variable.Magic */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */&lt;/style&gt;
&lt;style type="text/css"&gt;
/* Temporary definitions which will become obsolete with Notebook release 5.0 */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }
&lt;/style&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;Since last month I'm a PhD student in MSU at &lt;a href="http://ivory.idyll.org/blog/"&gt;Titus&lt;/a&gt; &lt;a href="http://ged.msu.edu/"&gt;lab&lt;/a&gt;, and my
research is focused on building infrastructure for exploring and
merging multiple read types and multiples assemblies.&lt;/p&gt;
&lt;p&gt;Titus and all the labbies are awesome mentors, and I'm making some
progress while learning how do deal with this brave new world.&lt;/p&gt;
&lt;p&gt;One thing I'm doing is checking how good is a &lt;em&gt;Gallus gallus&lt;/em&gt; Moleculo
sequencing dataset we have, which is being used for the
&lt;a href="http://ivory.idyll.org/blog/2013-posted-chick-improvement-grant.html"&gt;chicken genome sequence improvement project&lt;/a&gt;. The first question was:
How many of Moleculo raw reads align to the reference genome, and how much is
the coverage?&lt;/p&gt;
&lt;p&gt;To answer these questions we are using &lt;a href="http://arxiv.org/abs/1303.3997"&gt;bwa-mem&lt;/a&gt; to do the alignments,
&lt;a href="http://samtools.sourceforge.net/"&gt;samtools&lt;/a&gt; to work with the alignment data and a and a mix of Bash and
Python scripts to glue everything together and do analysis.&lt;/p&gt;
&lt;p&gt;First, let's download the reference genome.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[&amp;nbsp;]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;wget -c ftp://hgdownload.cse.ucsc.edu/goldenPath/galGal4/bigZips/galGal4.fa.masked.gz
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;With the reference genome available, we need to prepare it for the BWA algorithms by constructing its FM-index. The command to do this is&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[&amp;nbsp;]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;bwa index galGal4.fa.masked.gz
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;SAMtools also require preprocessing of the original FASTA file:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[&amp;nbsp;]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;samtools faidx galGal4.fa.masked.gz
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;I had 10 files with Moleculo reads, varying from 500 bp to 16 Kbp. In this example let's assume all reads are in the same file, &lt;em&gt;reads.fastq&lt;/em&gt;, but in the original analysis I ran the next commands inside a Bash for-loop.&lt;/p&gt;
&lt;p&gt;Let's align reference and reads using the BWA-MEM algorithm:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[&amp;nbsp;]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;bwa mem galGal4.fa.masked.gz reads.fastq &amp;gt; reads.fastq.sam
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;Next we are going to optimize the &lt;em&gt;reads.fastq.sam&lt;/em&gt; file, transforming it into the BAM format (a binary version of SAM). We also sort based on leftmost coordinates and index the file for faster access:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[&amp;nbsp;]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;samtools import galGal4.fa.masked.gz.fai reads.fastq.sam reads.fastq.bam
&lt;span class="o"&gt;!&lt;/span&gt;samtools sort reads.fastq.bam reads.fastq.sorted
&lt;span class="o"&gt;!&lt;/span&gt;samtools index reads.fastq.sorted.bam
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;We can query our alignments using the &lt;em&gt;view&lt;/em&gt; commands from samtools. How many reads didn't align with the reference?&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[&amp;nbsp;]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;samtools view -c -f &lt;span class="m"&gt;4&lt;/span&gt; reads.fastq.sorted.bam
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;In my case I got 7,985 reads that didn't align to the reference, from a total of 1,579,060 reads.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[&amp;nbsp;]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;samtools view -c reads.fastq.sorted.bam
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;There were 4,411,380 possible alignments.&lt;/p&gt;
&lt;p&gt;But how good is the coverage of these alignments in the reference genome? To do this calculation I refactored &lt;a href="https://github.com/ngs-docs/ngs-scripts/blob/master/blast/calc-blast-cover.py"&gt;calc-blast-cover&lt;/a&gt;, resulting in &lt;a href="https://github.com/luizirber/bioinfo/blob/master/bioinfo/bam_coverage.py"&gt;bam-coverage&lt;/a&gt;. The idea is to create arrays initialized to zero with the size of the sequence for each sequence in the reference. We go over the alignments and set the array position to 1 if there is an alignment
matching this position. After doing this we can calculate the coverage by summing the array and dividing by the sequence size.&lt;/p&gt;
&lt;p&gt;To make it easier to use I've started a new project (oh no! Another bioinformatics scripts collection!)
with my modifications of the original script. This project is called &lt;a href="https://github.com/luizirber/bioinfo"&gt;bioinfo&lt;/a&gt; and it is available
in &lt;a href="https://pypi.python.org/pypi/bioinfo"&gt;PyPI&lt;/a&gt;.
Basic dependencies are just &lt;a href="http://docopt.org"&gt;docopt&lt;/a&gt; (which is awesome, BTW) and
&lt;a href="https://github.com/noamraph/tqdm"&gt;tqdm&lt;/a&gt; (same). Additional dependencies are needed based on which command
you intend to run. For example, bam_coverage needs &lt;a href="http://pysam.readthedocs.org/en/latest/"&gt;PySAM&lt;/a&gt; and &lt;a href="http://screed.readthedocs.org/en/latest/"&gt;screed&lt;/a&gt;. At first
this seems counter-intuitive, because the user need to explicitly install new
packages, but this way avoids another problem: installing all the packages in
the world just to run a subset of the program. I intend to give an informative
message when the user try to run a command and dependencies are missing.&lt;/p&gt;
&lt;p&gt;If you've never used Python before, a good way to have a working environment is to use &lt;a href="http://continuum.io/downloads"&gt;Anaconda&lt;/a&gt;.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;Since bioinfo is available in PyPI, you can install it with&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[&amp;nbsp;]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;pip install bioinfo
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;To see available commands and options in bioinfo you can run&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[&amp;nbsp;]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;bioinfo -h
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;Running the bam_coverage command over the alignment generated by BWA-MEM:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[&amp;nbsp;]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;bioinfo bam_coverage galGal4.fa.masked reads.fastq.sorted.bam &lt;span class="m"&gt;200&lt;/span&gt; reads.fastq --mapq&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;30&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;The same command is available as a function in bioinfo and can be run inside a Python script:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[&amp;nbsp;]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;bioinfo&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;bam_coverage&lt;/span&gt;

&lt;span class="c1"&gt;## same call, using the module.&lt;/span&gt;
&lt;span class="n"&gt;bam_coverage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;galGal4.fa.masked&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;reads.fastq.sorted.bam&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;reads.fastq&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;If you don't want to install bioinfo (why not?!??!), you can just download bam-coverage:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[&amp;nbsp;]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;wget -c https://github.com/luizirber/bioinfo/blob/master/bioinfo/bam_coverage.py
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;And pass the options to the script:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[&amp;nbsp;]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;python bam_coverage.py galGal4.fa.masked reads.fastq.sorted.bam &lt;span class="m"&gt;200&lt;/span&gt; reads.fastq &lt;span class="m"&gt;45&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;The result I got for my analysis was a 82.3% coverage of the reference genome by the alignments generated with BWA-MEM.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;

&lt;pre&gt;&lt;code&gt;reading query
1579060 [elapsed: 01:16, 20721.82 iters/sec]
creating empty lists
15932 [elapsed: 01:08, 232.67 iters/sec]
building coverage
4411380 [elapsed: 34:36, 2123.96 iters/sec]
Summing stats
|##########| 15932/15932 100% [elapsed: 00:07 left: 00:00, 2008.90 iters/sec]

total bases in reference: 1046932099
total ref bases covered : 861340070
fraction                : 0.822727730693
reference               : galGal4.fa.masked
alignment file          : ../moleculo/LR6000017-DNA_A01-LRAAA-AllReads.sorted.bam
query sequences         : ../moleculo/LR6000017-DNA_A01-LRAAA-AllReads.fastq&lt;/code&gt;&lt;/pre&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;This post was written entirely in the IPython notebook. You can &lt;a href="http://blog.luizirber.org/downloads/notebooks/bam_coverage.ipynb"&gt;download&lt;/a&gt; this notebook, or see a static view &lt;a href="http://nbviewer.ipython.org/url/blog.luizirber.org/downloads/notebooks/bam_coverage.ipynb"&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
 


&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Wed, 12 Feb 2014 12:00:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2014-02-12:/2014/02/12/moleculo/</guid><category>phd</category></item><item><title>Of ThinkPads and MacBooks</title><link>https://blog.luizirber.org/2013/06/27/thinkpad/</link><description>&lt;p&gt;Since 2009 I was a Mac user. I was working with iOS development, and it made
sense to have a MacBook for the SDK. I was curious too, because I've been
using Linux distros (Debian, then Ubuntu, then Gentoo when Ubuntu was getting
too heavy for my old laptop) for some time and was a bit tired of making
everything work. Losing control was discomfortable at first, but so many
things working out of the box (like sleep and hibernation!) was worth it. And
Mac apps were much more polished (oh, Garageband).&lt;/p&gt;
&lt;p&gt;When I arrived at INPE I got a Linux workstation, the mighty Papera (all the
computers there have Tupi names, Tupi being a language spoken by native
indians here in Brazil). And I tested some new things, like using Awesome&lt;a href="http://awesome.naquadah.org/"&gt;1&lt;/a&gt;
as a window manager, and love it. But it lasted just for some months, because
the machines were swapped for some iMacs and Papera was assigned for other
person. I missed a tiling manager, but I also found Homebrew&lt;a href="http://mxcl.github.io/homebrew/"&gt;2&lt;/a&gt; and it helped
a lot setting up a dev environment in OSX (I know macports and fink existed,
but writing a Homebrew formula is pretty easy, I even contributed one back),
so no big problems in the transition.&lt;/p&gt;
&lt;p&gt;But after some time I was getting uneasy. New OSX versions seemed to remove
features instead of adding then (sigh, matrix-organized Spaces...). Lack of
expansibility on new laptops (despite MacBook Air being an awesome computer)
was pushing me back too, because a maxed one would cost way more than I was
willing to pay. And I was spending most of my time in SSH sessions to other
computers or using web apps, so why not go back to Linux?&lt;/p&gt;
&lt;p&gt;At the end of 2012 I bought a used ThinkPad X220 with the dock and everything.
When I was younger I always liked the visual, with its black and red look, and
the durability (MacBooks are pretty, but they are easy to scratch and bend).
And the X220 was cheap and in perfect state, and with a small upgrade when I
went to PyCon (ahem, 16 GB RAM and a 128 GB SSD) it is a BEAST now. And all
these benefits too:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;I have Awesome again!&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Updated packages thanks to pacman (I installed Arch Linux and I'm loving
    it)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;When I need a new package it is as easy to write a PKGBUILD file as it was
    to write a Homebrew formula. I wrote some Debian packages in the past and
    they worked, but there were so many rules and parts that I don't think I
    want to write one again. I recognize that a lot of the rules and parts make
    sense with a project as big as Debian (and Ubuntu and everyone else), but
    it could be simpler.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Sleep works! Hibernation works! &lt;a href="http://forums.lenovo.com/t5/X-Series-ThinkPad-Laptops/x220-does-not-resume-from-sleep/m-p/1083233/highlight/false#M48825"&gt;Except when it doesn't because your EFI
    is half full after the kernel wrote some stacktraces and the chip refuses
    to wake up.&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It isn't for those faint of heart, but I'm happy to be back =]&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Thu, 27 Jun 2013 12:00:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2013-06-27:/2013/06/27/thinkpad/</guid><category>a day in the life</category></item><item><title>A Tale of Two Stadiums</title><link>https://blog.luizirber.org/2013/06/17/two-stadiums/</link><description>&lt;p&gt;Last weekend I went with some friends to Maracanã watch Italy vs Mexico
at the first round of the Confederations Cup.
We got some cheap tickets (R$ 57, about US$ 25) on an area meant for
Brazilians only (and that's why they were so cheap, usually tickets cost
at least double). And it was so good to go again to a stadium, it's a very
different experience from watching a game on TV, where the camera give you
a limited perspective. Our seats were behind one of the goals, and we were
lucky: we saw two goals on our side, one from Mexico (a penalty kick) and
one from Italy, a beautiful goal by Balotelli, who was a bit of a diva, by
the way, always complaining and making drama.&lt;/p&gt;
&lt;p&gt;It was the third time I went to a stadium. Previous ones were Grêmio matches,
one versus River Plate in 2002 and other versus Figueirense in 2008. These
games were on Grêmio's last stadium, Olímpico Monumental, which gave way to
a new one, the Arena, built at the entrance of the city (and far from the
old one). This is happening a lot around here, given that next year we have
the World Cup and there are at least ten new stadiums built or reformed for
the competition. At first they should have been prepared with private
funding, but as time passed and they were all late public funding came into
the picture, and only in Maracanã more than one billion brazilian reais were
spent.&lt;/p&gt;
&lt;p&gt;They are now much closer to developed countries' stadiums, like those we used
to see on TV. By brazilian standards they aren't even stadiums anymore,
looking more like theaters, were you just sit and watch the game. It
shouldn't be bad, but I couldn't avoid a comparison between this weekend
game and my previous experience. OK, this time the crowd didn't have a
prefered side and so it wasn't cheering up as much as I saw before, but it
was worrisome because it was obvious that almost everyone at the match was
people that could pay for the expensive tickets, and sometimes didn't even
have a strong connection with football, something that always gave a match
that catarsis aura.&lt;/p&gt;
&lt;p&gt;Last week I tried to go with my family to see the new Grêmio stadium and we
weren't so lucky. Cheapest tickets cost almost R$ 100 each, and for the four
of us this meant R$ 400 less, not out of league but way too expensive. This
high cost ticket means the usual fan can't go to the stadium anymore,
and is replaced by this new fan, a consumer above everything else. And
maybe it's just a romantic vision, and of course there were a lot of problems
before, but the price paid for comfort might be too expensive in the long run.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Mon, 17 Jun 2013 22:00:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2013-06-17:/2013/06/17/two-stadiums/</guid><category>a day in the life</category></item><item><title>I finally met Tupã</title><link>https://blog.luizirber.org/2013/06/07/tupa/</link><description>&lt;p&gt;So, after two and a half years, I finally met &lt;a href="http://supercomputacao.inpe.br/recursos2"&gt;Tupã&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.flickr.com/photos/luizirber/sets/72157633820118765/"&gt;&lt;img class="center" src="https://farm3.staticflickr.com/2875/8896385074_5a48573f57.jpg" width="500" height="375"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Curiously, it was only after I left INPE. &lt;a href="http://ciclotux.blogspot.com"&gt;Arnaldo&lt;/a&gt; came to Cachoeira
to visit us and I planned to show him the center, but I wasn't expecting
to do the whole tour. When I began working there they only showed the
public part, because Tupã was off-limits at that time, and I thought it
still was since then. Well, me and everybody else that got into the group
after me... We went on a small tour to see Tupã, the engines, no-breaks
and all the electrical installation needed to support the building.&lt;/p&gt;
&lt;p&gt;And it was &lt;strong&gt;AMAZING!&lt;/strong&gt; I always liked more software than hardware, but it
is awesome to see things that you just knew from a SSH session. I could see
the tape library, disk arrays, the blinkenlights... It is in some ways the
physical manifestation of your code, or at least you have a better notion
of how many things are in motion when you execute something on the computer.&lt;/p&gt;
&lt;p&gt;All in all, good times. It wasn't exactly what I expected at first, but I
made some great friends there, I could bike to work everyday, and I
learned (by trial and error) that you need to choose better who do you
trust. So it goes.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Fri, 07 Jun 2013 23:45:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2013-06-07:/2013/06/07/tupa/</guid><category>a day in the life</category></item><item><title>Ocean</title><link>https://blog.luizirber.org/2011/04/19/ocean/</link><description>&lt;p&gt;Tudo começou com &lt;a href="http://www.reddit.com/r/compsci/comments/gp0wr/bored_with_webdevelopment_want_to_change_careers/c1p731j"&gt;uma pergunta no Reddit&lt;/a&gt;. Compartilhei ela no
&lt;a href="https://profiles.google.com/107474098146584337559/posts/Ln5D9CFTMjS"&gt;Google Reader&lt;/a&gt;, comentando que era bem parecido com o que eu faço no
INPE. O &lt;a href="https://profiles.google.com/thiago.camposmoraes/about"&gt;Thiago&lt;/a&gt; ficou interessado e perguntou se eu não podia contar
um pouco mais.&lt;/p&gt;
&lt;p&gt;Fazem cinco meses que comecei a trabalhar no grupo de modelagem oceânica
acoplada do INPE. O nosso grupo é responsável pelo &lt;a href="http://www.ccst.inpe.br/modelo-brasileiro.php"&gt;MBSCG&lt;/a&gt;, além da
produção científica. Eu estou desenvolvendo ferramentas para auxiliar os
pesquisadores na análise das saídas do modelo e como relacionar elas com
as observações dos instrumentos espalhados pelo mundo.&lt;/p&gt;
&lt;p&gt;Mas isso é uma descrição muito genérica. O primeiro aplicativo que fiz
(ainda não tem release público, shame on me, mas não falta muito) é um
editor de grades oceânicas. O modelo oceânico necessita de um arquivo
descrevendo a grade que ele vai usar para saber como é o mundo (onde é
terra, onde é água, qual a profundidade da água em cada local). Em
resoluções baixas, costuma subdividir o mundo em incrementos de 1 grau
(cerca de 100km no Equador). Em qualquer resolução escolhida ocorrem
vários problemas diferentes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Em resoluções baixas o estreito de Gibraltar pode ficar fechado, e o
    Mediterrâneo vira um lago gigante sem trocas com o oceano.
    Obviamente o resultado fica bem longe da realidade.&lt;/li&gt;
&lt;li&gt;Em resoluções altas o canal do Panamá pode abrir, o que causa um
    fluxo inexistente entre o Pacífico e o Atlântico.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Entre muitos outros. O modelo tem ferramentas para gerar uma grade a
partir de uma batimetria fornecida, mas ele não corrige todos os
problemas que surgem. Até hoje era muito trabalhoso arrumar essa grade,
pois era difícil visualizar e selecionar cada ponto da grade e conferir
se ele é consistente com as necessidades do experimento.&lt;/p&gt;
&lt;p&gt;Então o que eu fiz foi fazer um aplicativo que pega a grade, plota na
projeção desejada (ortográfica, por padrão), e permite a seleção de
células e edição de profundidade delas em diferentes níveis de zoom.
Relativamente simples, mas de uma utilidade muito grande para os
pesquisadores prepararem seus experimentos.&lt;/p&gt;
&lt;p&gt;Hoje estou trabalhando num módulo para extrair dados do modelo e
compará-los com observações disponíveis. Um exemplo são os dados do
projeto &lt;a href="http://www.pmel.noaa.gov/pirata/"&gt;PIRATA&lt;/a&gt;, que inclui &lt;a href="http://www.whoi.edu/instruments/viewInstrument.do?id=1003"&gt;CTD&lt;/a&gt;s e &lt;a href="http://en.wikipedia.org/wiki/Radiosonde"&gt;radiossondas&lt;/a&gt; (quer quiser
brincar um pouco para ver o que é disponibilizado pode ver &lt;a href="http://opendap.ccst.inpe.br/pirata/"&gt;esse site&lt;/a&gt;
que o &lt;a href="http://roberto.dealmeida.net"&gt;Beto&lt;/a&gt; fez). O PIRATA tem cruzeiros de manutenção das boias em
alguns períodos do ano, e é interessante comparar os dados coletados
nesses cruzeiros com um cruzeiro virtual que passe na mesma localização
no modelo. Inicialmente fiz algo bem simples, que só pega a latitude e
longitude da medição e interpola os arredores dessa localização no
modelo (a resolução pode não ser tão alta a ponto de incluir o ponto
exato, por isso a interpolação). Mesmo com uma técnica tão simples já é
possível perceber como o modelo se aproxima bastante da realidade em
muitos lugares. Na semana passada o &lt;a href="http://blog.castelao.net/"&gt;Guilherme&lt;/a&gt; chegou para trabalhar
no nosso grupo e fez algumas sugestões para fazer uma análise mais
avançada, e na verdade esse email todo é para comentar sobre isso.&lt;/p&gt;
&lt;p&gt;Assim como o pessoal da computação é muito procurado já a algum tempo,
devido à ascensão do computador a ferramenta essencial da maioria das
atividades da humanidade, os próximos serão os estatísticos (e
cientistas da informação, onde cursos de biblioteconomia se
atualizaram). Cada vez mais geramos montanhas de dados, mas não sabemos
muito bem como lidar com toda essa complexidade. E existem técnicas que
são comuns a muitas áreas de conhecimento, e portanto genéricas: você
pode aplicá-las para analisar uma gama gigantesca de dados. Por exemplo,
eu tive análise de sinais na universidade, e apesar de orientada à
circuitos quase tudo se aplica no estudo de medidas realizadas pelos
instrumentos. Foi até curioso, porque eu associava tanto a circuitos que
ficava com a impressão de que nunca usaria na vida, porque eu não ia
trabalhar com hardware (sim, eu era um bixo burro).&lt;/p&gt;
&lt;p&gt;Relacionado a isso surgiu pela tarde outro assunto, conversando com o
&lt;a href="http://vainalousachefe.wordpress.com"&gt;GG&lt;/a&gt;. Falei que, durante a graduação, tinha matérias da engenharia que
ficávamos nos perguntando pra que serviriam. Fenômenos dos transportes?
Estatística? A já citada análise de sinais? Só pra morder a língua, são
as três coisas que mais uso aqui: a primeira é essencial para a
modelagem de processos físicos (oceanografia geofísica) que governam o
modelo, a segunda e a terceira para análise das saídas. E também
percebemos que não apenas a computação é uma área-meio (que pode ser
aplicada a várias áreas-fim), como também a engenharia o é. Fico feliz
te ter achado um meio que permita usar as minhas profissões genéricas.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Tue, 19 Apr 2011 19:01:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2011-04-19:/2011/04/19/ocean/</guid><category>Projetos, universidade</category></item><item><title>Minha (quase) vida bandida</title><link>https://blog.luizirber.org/2010/08/10/minha-quase-vida-bandida/</link><description>&lt;p&gt;Blog juntando moscas, deixa eu ressucitar um projetinho de fim de semana
para ver se anima um pouco.&lt;/p&gt;
&lt;p&gt;A ideia inicial desse post surgiu na &lt;a href="http://www.pythonbrasil.org.br/"&gt;PythonBrasil&lt;/a&gt; do ano passado.
Pensei em fazer uma lightning talk, mas não ficou pronta a tempo (Nota:
sempre bom deixar alguma lightning talk preparada).&lt;/p&gt;
&lt;p&gt;Como começou a história: recebi email de uma prima, pedindo para que os
amigos e parentes ajudassem a votar na filha dela em um site de roupas
infantis. A criança mais votada participaria de um comercial e ia
embolsar um monte de roupas.&lt;/p&gt;
&lt;p&gt;Ok, ok. Odeio esse tipo de spam, mas também não custa ajudar, né? Fui na
página de votação. Votei uma vez, depois de preencher um captcha, e
tentei votar de novo para ver o que acontecia. "Você votou na última
hora, aguarde para votar novamente". Hmm. Como será que o controle disso
é feito?&lt;/p&gt;
&lt;p&gt;Abri o código. Hmm, essa função em javascript aqui que processa o evento
do botão, ela chama uma URL...&lt;/p&gt;
&lt;figure class='code'&gt;
&lt;figcaption&gt;&lt;span&gt;votoAprovar.js&lt;/span&gt; &lt;a href='/downloads/code/votoAprovar.js'&gt;download&lt;/a&gt;&lt;/figcaption&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;votoAprovar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;cadastroId&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
  &lt;span class="nx"&gt;captcha&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;cadastroCaptcha&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;value&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;voto_v.php?votoStatus=1&amp;amp;cadastroId=&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nx"&gt;cadastroId&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;amp;captcha=&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nx"&gt;captcha&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/figure&gt;

&lt;p&gt;Opa. E se eu tentar acessar essa URL direto?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;voto_v.php?votoStatus=1&amp;amp;cadastroId=98374&amp;amp;captcha=adb356&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Tenho que acertar o captcha. Onde está o captcha? Ah, olha só, o link da
imagem é um arquivo captcha.php, será que dá para acessar direto? Deu.&lt;/p&gt;
&lt;p&gt;&lt;img class="center" src="/images/original1.png" width="173" title="A imagem original." alt="A imagem original."&gt;&lt;/p&gt;
&lt;p&gt;Resumindo, eu tinha a URL para votar, e atualizando o captcha eu
conseguia votar quantas vezes quisesse. Mas ficar fazendo isso na mão é
chato. Como será que funciona identificação de captcha? Uma pesquisa
rapidinha e caí &lt;a href="http://alwaysmovefast.com/2007/11/21/cracking-captchas-for-fun-and-profit/"&gt;nesse site&lt;/a&gt;. E em Python, para facilitar ainda mais
minha vida.&lt;/p&gt;
&lt;p&gt;Brinquei um pouco com o PIL, e consegui deixar a imagem com caracteres
bem definidos. Incrivelmente, só precisei converter para escala de
cinza, e aplicar um limiar.&lt;/p&gt;
&lt;figure class='code'&gt;
&lt;figcaption&gt;&lt;span&gt;clean_captcha.py&lt;/span&gt; &lt;a href='/downloads/code/clean_captcha.py'&gt;download&lt;/a&gt;&lt;/figcaption&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;captcha_to_greyscale&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;captcha&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;captcha&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;L&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;captcha&lt;/span&gt;
    &lt;span class="n"&gt;captcha&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;captcha&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;convert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;L&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;captcha&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;light_pixels_to_white_pixels&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pixels&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;xrange&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;xrange&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;pixels&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;255&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;clean_captcha&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;img&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;img2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;captcha_to_greyscale&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;img&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;img2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;
    &lt;span class="n"&gt;light_pixels_to_white_pixels&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;img2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;img2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/figure&gt;

&lt;p&gt;&lt;img class="center" src="/images/limpa1.png" width="173" title="Imagem, depois de processada pelo PIL." alt="Imagem, depois de processada pelo PIL."&gt;&lt;/p&gt;
&lt;p&gt;E, conforme ia acumulando mais imagens, vi que a minha vida seria mais
fácil ainda: o captcha só tinha caracteres hexadecimais, então nem
precisaria mapear o alfabeto inteiro, só de zero a nove e de 'a' até
'f'. Depois de limpar algumas imagens e juntá-las numa pasta, rodei o
treinador do &lt;a href="http://code.google.com/p/tesseract-ocr/"&gt;tesseract-ocr&lt;/a&gt;, e depois dos arquivos de treinos
prontos, tinha 100% de acerto nas imagens. Sigh, que maravilha de
captcha...&lt;/p&gt;
&lt;p&gt;Agora, testar. Criei um perfil falso, e me assustei. Tentei rodar o
script para ver se contava um voto, e quando abri o perfil já tinha 5!
Aparentemente, as mães fazem um "vote-no-meu-filho-que-eu-voto-no-seu",
e como os perfis mais novos aparecem na página principal, me acharam
rapidinho. Ok, rodemos um loop então, cem votos. Yep, todos contados.&lt;/p&gt;
&lt;figure class='code'&gt;
&lt;figcaption&gt;&lt;span&gt;break_captcha.py&lt;/span&gt; &lt;a href='/downloads/code/break_captcha.py'&gt;download&lt;/a&gt;&lt;/figcaption&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;commands&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;getoutput&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;StringIO&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;StringIO&lt;/span&gt;

&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;PIL&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Image&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;mechanize&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;captcha_to_greyscale&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;captcha&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;captcha&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;L&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;captcha&lt;/span&gt;
    &lt;span class="n"&gt;captcha&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;captcha&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;convert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;L&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;captcha&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;light_pixels_to_white_pixels&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pixels&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;xrange&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;xrange&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;pixels&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;255&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;clean_captcha&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;img&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;img2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;captcha_to_greyscale&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;img&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;light_pixels_to_white_pixels&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;img2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;img2&lt;/span&gt;


&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;br&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mechanize&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Browser&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;xrange&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;voto&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;

        &lt;span class="n"&gt;page&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;br&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;*****/captcha/captcha.php&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;img_str&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;StringIO&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;

        &lt;span class="n"&gt;fp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;original.tif&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;wb&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;img&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Image&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;img_str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;img&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tiff&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;clean_captcha&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;img&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;fp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tmp.tif&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;wb&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tiff&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;fp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

        &lt;span class="n"&gt;getoutput&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tesseract tmp.tif output -l brand&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;fp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;output.txt&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;captcha&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()[:&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;fp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

        &lt;span class="n"&gt;cadId&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;28477&lt;/span&gt;

        &lt;span class="n"&gt;vote_page&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;*****/voto_v.php?votoStatus=1&amp;amp;cadastroId=&lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="s1"&gt;&amp;amp;captcha=&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;cadId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;captcha&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;br&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vote_page&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/figure&gt;

&lt;p&gt;Omiti o endereço do site, mas basicamente o script é esse.&lt;/p&gt;
&lt;p&gt;Agora chega o grande momento, o clímax da história, onde o herói escolhe
entre a fama e fortuna ou o que parece moralmente certo. (Que
grandioso!). "Com grandes poderes vêm grandes responsabilidades!". E
todo esse lero-lero.&lt;/p&gt;
&lt;p&gt;Apesar de o propósito inicial ter sido ajudar a minha prima, rodar o
script me pareceu uma ajuda grande demais. E meu objetivo era testar o
buraco no sistema de votação, não me aproveitar dele. Acabei deixando
pra lá, e o código ficou mofando no meu computador.&lt;/p&gt;
&lt;p&gt;Hoje, quando fui escrever o post, vi que já aconteceu a segunda edição
do concurso, e miseravelmente o sistema é exatamente o mesmo. Vou mandar
esse post para a empresa, quem sabe para o próximo corrijam.&lt;/p&gt;
&lt;p&gt;UPDATE: O &lt;a href="http://lameiro.wordpress.com"&gt;Lameiro&lt;/a&gt; deu a dica nos comentários: buscando no
google.com.br por "captcha PHP" temos, como primeiro hit,
&lt;a href="http://www.numaboa.com/informatica/tutos/php/949-captcha"&gt;um tutorial ensinando a gerar o captcha&lt;/a&gt;
que esse site usa. E, como ele bem notou,
deve ter muitos sites no Brasil com esse mesmo problema.&lt;/p&gt;
&lt;p&gt;Fica a dica: nunca confie no primeiro hit do google para implementar a
sua solução de segurança. Aliás, não confie em nenhuma, até saber como
ela funciona.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Tue, 10 Aug 2010 14:08:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2010-08-10:/2010/08/10/minha-quase-vida-bandida/</guid><category>Hacking</category><category>captcha</category><category>PIL</category><category>python</category><category>tesseract</category></item><item><title>Robô Shrek</title><link>https://blog.luizirber.org/2009/06/12/robo-shrek/</link><description>&lt;p&gt;Na última quarta-feira aconteceu a Feira de Informática Aplicada, ligada
à Semana de Computação da UFSCar. Eu e Alphalpha resolvemos participar
para testar o Arduino que eu tinha comprado no começo do ano. O tempo
era curto, mas mesmo assim fomos em frente e juntamos algumas peças que
sobraram do &lt;a href="http://www.youtube.com/watch?v=4PPXEsENpCY"&gt;robô&lt;/a&gt; do &lt;a href="http://www2.dc.ufscar.br/~gedai/"&gt;GEDAI&lt;/a&gt;, um N800, um Arduino Duemilanove e
montamos nosso próprio robô, chamado de Shrek.&lt;/p&gt;
&lt;p&gt;Por que Shrek? Porque Shrek é um ogro, ogros são como cebolas
(&lt;span style="text-decoration:line-through;"&gt;fedem&lt;/span&gt; são feitos de
camadas), e nosso robô é feito de várias camadas simples que, juntas,
fazem algo complexo.&lt;/p&gt;
&lt;p&gt;Como funciona? O Arduino controla os motores, e recebe dados pelo USB
(como uma porta serial) vindos do N800. O N800 está conectado em uma
rede wifi, e recebe comandos via socket. Além disso, também envia vídeo
e áudio para a aplicação (que no momento roda em um PC), e a aplicação
envia os comandos e exibe o vídeo e o áudio.&lt;/p&gt;
&lt;p&gt;Devido ao pouco tempo, apenas 3 comandos simples foram implementados
(frente, giro à esquerda, giro à direita), mas nosso objetivo estava
cumprido: a comunicação entre as partes estava funcionando direitinho, e
agora podemos partir para incrementá-lo.&lt;/p&gt;
&lt;p&gt;Todo o código está disponível no &lt;a href="http://github.com/luizirber/shrekenc"&gt;GitHub&lt;/a&gt;, e queremos levá-lo
para o FISL (depois de arranjarmos motores melhores).&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Fri, 12 Jun 2009 11:29:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2009-06-12:/2009/06/12/robo-shrek/</guid><category>Hacking</category><category>arduino</category><category>FIA</category><category>gstreamer</category><category>N800</category><category>python</category><category>ufscar</category><category>Projetos</category><category>universidade</category></item><item><title>OMG Kitties!</title><link>https://blog.luizirber.org/2009/05/26/omg-kitties/</link><description>&lt;p&gt;Ontem foi o dia da toalha. Uma imagem vale mais que mil palavras.&lt;/p&gt;
&lt;p&gt;&lt;img class="center" src="/images/toalha2009.jpg" width="300"&gt;&lt;/p&gt;
&lt;p&gt;À esquerda, minha querida toalha. Ao fundo, &lt;a href="http://www.wowarmory.com/character-sheet.xml?r=Ravenholdt&amp;amp;n=Lebriziur"&gt;World of Warcraft&lt;/a&gt; (sim,
cometi esse erro. Seja o que Deus quiser). E na frente, em primeiro
plano, Ada.&lt;/p&gt;
&lt;p&gt;Quem é Ada? Semana passada minha namorada veio perguntar se eu já tinha
ouvido falar de Ada Byron, condessa de Lovelace (não confundir com
&lt;a href="http://en.wikipedia.org/wiki/Linda_Lovelace"&gt;Linda Lovelace&lt;/a&gt;, condessa de... clique no link e veja). Eu disse
"claro, a primeira programadora", e começamos a conversar sobre isso.
Ela reclamou da falta de reconhecimento da importância dela, e acabamos
concluindo que Ada é um nome legal.&lt;/p&gt;
&lt;p&gt;Na sexta, fomos até a Arca de São Franscisco, uma entidade de proteção
aos animais em São Carlos. E lá achamos essa gatinha, que deveria ter
ficado em outro lugar, mas por incompatibilidade de gênios foi rejeitada
e acabou ficando no apartamento mesmo. E resolvemos batizar ela como
Ada. Diga-se que é a primeira vez que tenho um gato, o único animal de
estimação que tive foi uma coelha, quando eu tinha uns 6 anos. Mas tô
curtindo por enquanto =]&lt;/p&gt;
&lt;p&gt;E acabei descobrindo que essa tirinha do XKCD realmente é verdade:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://xkcd.com/231/"&gt;&lt;img class="center" src="https://imgs.xkcd.com/comics/cat_proximity.png" width="300" title=""Yes you are!  And youre sitting there!  Hi, kitty!"" alt=""Yes you are!  And youre sitting there!  Hi, kitty!""&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Randall Munroe, mestre.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Alguém aí tem dicas?&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Tue, 26 May 2009 08:49:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2009-05-26:/2009/05/26/omg-kitties/</guid><category>A day in the life</category></item><item><title>Hand</title><link>https://blog.luizirber.org/2009/02/12/hand/</link><description>&lt;p&gt;Ontem, enquanto gravava um DVD, comecei a generalizar os scripts que
geram os feeds do post anterior. E disso surgiu o Hand, um gerador de
feeds RSS.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Como funciona?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;O meu objetivo inicial era gerar feeds para sites que não os
disponibilizavam, recorrendo ao bom e velho &lt;a href="http://en.wikipedia.org/wiki/Screen_scraping"&gt;screen scraping&lt;/a&gt;. Comecei
fazendo o feed dos quadrinhos da Folha, o mais complicado, pois era
necessário fazer autenticação de usuário e percorrer várias páginas para
extrair links. Ao fazer o dos Malvados, segui a mesma estrutura de
funções, e comecei a perceber que dava para generalizar bastante o
processo.&lt;/p&gt;
&lt;p&gt;Eis que surge Hand. No fundo é uma classe que implementa alguns métodos
(build_date, generate_description, build_feed, process), e exige que
você derive a classe e implemente o método generate_data.
generate_data é um método que retorna uma lista de dicionários, com
cada dicionário contendo os campos title, page_link, description,
pubDate e guid correspondentes a um item do feed. Simples assim.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;E funciona?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Yep. Mantenho quatro feeds no momento:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://luizirber.org/rss/fsp.xml"&gt;Quadrinhos da Folha de São Paulo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://luizirber.org/rss/malvados.xml"&gt;Malvados&lt;/a&gt; &lt;strong&gt;Update:&lt;/strong&gt; &lt;a href="http://feed43.com/malvados.xml"&gt;Feed alternativo, sem o CATA CORNO GOOGLE&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Magias e Barbaridades &lt;strong&gt;Update:&lt;/strong&gt; &lt;a href="http://magiasebarbaridades.blogspot.com/feeds/posts/default"&gt;Feed oficial&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Rehabilitating Mr. Wiggles &lt;strong&gt;Update:&lt;/strong&gt; &lt;a href="http://www.instantrimshot.com"&gt;Feed oficial&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Onde posso ver esta maravilha?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;O código está disponível no &lt;a href="http://github.com/luizirber/Hand"&gt;GitHub&lt;/a&gt;, mas ainda está bem cru, preciso
empacotá-lo direito.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Quais os próximos passos?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;O feed da Folha demora para ser gerado, porque toda vez que o script é
rodado ele precisa consultar todas as páginas. Portanto penso em
adicionar persistência, mas bem simples, um sqlite é mais que
suficiente.&lt;/p&gt;
&lt;p&gt;Além disso, quero descrever a configuração do feed (onde gerá-lo, qual
template usar) num arquivo, e fazer a classe base ler essas opções.
Assim fica ainda mais fácil fazer um novo feed.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Que nominho, hein?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Para quem não entendeu o nome: qual um bom para um gerador de feeds?
Enquanto pensava, lembrei de uma música do &lt;a href="http://www.nin.com/"&gt;NIN&lt;/a&gt; chamada
&lt;a href="http://en.wikipedia.org/wiki/The_Hand_That_Feeds"&gt;'The Hand That Feeds'&lt;/a&gt;. E, além disso, ele também te dá uma mão
para gerar feeds, certo? &lt;a href="http://www.instantrimshot.com"&gt;*TU-DUM-TISH*&lt;/a&gt;!&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Thu, 12 Feb 2009 07:13:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2009-02-12:/2009/02/12/hand/</guid><category>Hacking</category><category>feed</category><category>mechanize</category><category>python</category><category>Projetos</category></item><item><title>Feeds de quadrinhos</title><link>https://blog.luizirber.org/2009/01/20/feeds-de-quadrinhos/</link><description>&lt;p&gt;Infelizmente a &lt;a href="http://www1.folha.uol.com.br/fsp/"&gt;Folha de São Paulo&lt;/a&gt; não disponibiliza feeds dos
quadrinhos diários dela. Isso significa privar-nos de &lt;a href="http://www.laerte.com.br"&gt;Laerte&lt;/a&gt; e
&lt;a href="http://www2.uol.com.br/adaoonline/"&gt;Adão&lt;/a&gt;, mas não temam! Caso queiram tirinhas frescas toda a manhã no
seu leitor de feeds favorito, basta usar o que &lt;a href="http://luizirber.org/rss/fsp.xml"&gt;eu fiz&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A idéia (sim, sou antigo, meus netos ainda vão dizer 'meu vô é do tempo
que se escrevia ideia com acento') é simples, e foi baseada na do
&lt;a href="http://leandrosiqueira.com/quadrinhos/"&gt;Leandro Siqueira&lt;/a&gt;: apesar do conteúdo da Folha ser exclusivo para
assinantes, as imagens das tirinhas são acessíveis. Basta descobrir o
padrão do nome delas. Mas percebi que as tirinhas de domingo não estavam
aparecendo, pois existem autores diferentes nesse dia (Allan Sieber e
irmãos Bá, atualmente). Então resolvi fazer um que fosse um pouquinho
mais dinâmico, e deu certo, porque quando houve a transição das
dominicais o feed continuou funcionando sem modificações.&lt;/p&gt;
&lt;p&gt;Como foi feito? &lt;a href="http://www.python.org"&gt;Python&lt;/a&gt;, &lt;a href="http://www.crummy.com/software/BeautifulSoup/"&gt;Beautiful Soup&lt;/a&gt; e &lt;a href="http://wwwsearch.sourceforge.net/mechanize/"&gt;Mechanize&lt;/a&gt;. O script
autentica no site, busca o índice dos quadrinhos, e acha o link das
imagens para gerar o feed. Aliás, Beautiful Soup é uma das bibliotecas
mais úteis que já usei, para mexer com HTML não tem nada melhor.&lt;/p&gt;
&lt;p&gt;E, como o mais complicado já estava feito, semana passada fiz rapidinho
um &lt;a href="http://luizirber.org/rss/malvados.xml"&gt;feed&lt;/a&gt; para os &lt;a href="http://www.malvados.com.br"&gt;Malvados&lt;/a&gt; também. Até tem um feed lá, mas é só
para o blog. Ainda não resolvi como fazer para mostrar as séries, mas as
normais aparecem sem problemas no feed (acho, eu uso Google Reader e
aparece. Por favor, testem em outros readers e me avisem).&lt;/p&gt;
&lt;p&gt;Ando pensando em generalizar um pouco os dois scripts, para facilitar a
escrita de &lt;a href="http://en.wikipedia.org/wiki/Screen_scraping"&gt;screen scrapers&lt;/a&gt;, mas não sei se vale a pena, já que eles
são extremamente dependentes da estrutura da página. Mas vamos ver o que
sai =D&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Tue, 20 Jan 2009 17:29:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2009-01-20:/2009/01/20/feeds-de-quadrinhos/</guid><category>Hacking</category><category>adao</category><category>beautifulsoup</category><category>feed</category><category>fsp</category><category>laerte</category><category>malvados</category><category>python</category></item><item><title>Tidbits</title><link>https://blog.luizirber.org/2008/12/29/tidbits/</link><description>&lt;p&gt;Um monte de coisas que merecem ser ditas, mas pequenas demais para posts
separados. Vamos lá:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;A minha palestra na PyConBrasil desse ano está no &lt;a href="http://video.google.com/videoplay?docid=-2177235750911656588"&gt;Google Video&lt;/a&gt;.
Desde metade de novembro, mas só descobri agora =D&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Aliás, eu dei uma palestra em um evento chamado &lt;a href="http://arcodigital.com.br/mobile/prog_1712.php"&gt;Mobile Expert&lt;/a&gt;,
promovido pela Editora Europa, na Livraria Cultura. Os slides estão
&lt;a href="http://www.luizirber.org/talks/python_games"&gt;aqui&lt;/a&gt;. O detalhe é que eles erraram meu nome (que é com Z), o nome da
linguagem (é PYTHON) e o nome da empresa (Pinuts StudioS, com S no
final). Mas foi bem massa mesmo assim.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Liniers lançou o Macanudo #6 por conta própria, e a primeira edição,
de 5000 exemplares, saiu com a capa em branco. E ele DESENHOU TODAS A
MÃO. Quando fiquei sabendo disso logo dei um jeito de comprar dois, por
uma loja argentina que vende na internet. Eles chegaram no começo de
dezembro, e são umas belezinhas. Um ficou comigo, o outro dei de
presente de natal para a Na.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Que, fodasticamente, fez três miniaturas em biscuit de alguns
personagens da tirinha e me deu de Natal. Olhaê:&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="http://www.flickr.com/photos/luizirber/3143780731/"&gt;&lt;img class="center" src="https://farm4.static.flickr.com/3224/3143780731_746a8da28d.jpg"&gt;&lt;/a&gt; Duende, Fellini y El Misterioso Hombre de Negro&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Finalizando com Liniers: &lt;a href="http://autoliniers.blogspot.com/2008/12/liniers-macanudo_28.html"&gt;ontem&lt;/a&gt; ele deu um susto naquelas pessoas
que acompanham a tirinha e não entendem espanhol muito bem. Só que ontem
era Dia dos Inocentes em países hispânicos, o equivalente ao nosso
Primeiro de Abril. Tsc.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Agora MTV pega na parabólica. Yay! Não que seja grande coisa, mas pelo
menos passa alguns clipes legais de madrugada, e por pior que esteja a
programação ainda é uma opção interessante quando comparada aos outros
canais disponíveis na TV aberta...&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Fallout 2 é FOODA. Tudo bem que tá todo mundo falando do 3, mas esse
não roda no meu PC. Então aproveitei para jogar o &lt;a href="http://www.nma-fallout.com/forum/viewtopic.php?t=40443"&gt;Restoration
Project&lt;/a&gt;, mod que adiciona alguns detalhes que tinham sido planejados,
mas não foram implementados. Sweet!&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Alguém aí sabe jogar Magic? Ganhei um deck de natal, mas preciso de
oponentes (de preferência compreensivos, e dispostos a explicar tudo).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://www.imdb.com/name/nm0594898/"&gt;Ela&lt;/a&gt; &lt;a href="http://www.imdb.com/title/tt0490196/"&gt;prova&lt;/a&gt; que &lt;a href="http://vainalousachefe.wordpress.com/"&gt;GG&lt;/a&gt; é &lt;a href="http://www.flickr.com/photos/luizirber/3145992838/"&gt;lindo&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Mon, 29 Dec 2008 06:54:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2008-12-29:/2008/12/29/tidbits/</guid><category>A day in the life</category></item><item><title>Presente de aniversário</title><link>https://blog.luizirber.org/2008/11/22/presente-de-aniversario/</link><description>&lt;p&gt;O meu aniversário foi dia 17, mas há pessoas impacientes no mundo. No
dia 05 de novembro já tinha recebido um presente =]&lt;/p&gt;
&lt;p&gt;Teaser:&lt;/p&gt;
&lt;p&gt;&lt;img class="center" src="/images/asuka-hd1.jpg"&gt;&lt;/p&gt;
&lt;p&gt;O presente:&lt;/p&gt;
&lt;p&gt;&lt;img class="center" src="/images/asuka-gk1.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Tão legal quanto o presente é a reação das pessoas. Os que nunca ouviram
falar de &lt;a href="http://en.wikipedia.org/wiki/Garage_kit"&gt;Garage Kit&lt;/a&gt; e &lt;a href="http://en.wikipedia.org/wiki/Asuka_Langley_Soryu"&gt;Evangelion&lt;/a&gt; dizem 'Mas isso não é coisa de
menininha?'. Os que entendem dizem 'Que foda!'&lt;/p&gt;
&lt;p&gt;Eu? Eu adorei, qualquer que seja a opinião dos outros =D&lt;/p&gt;
&lt;p&gt;Obrigado, Na!&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Sat, 22 Nov 2008 11:20:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2008-11-22:/2008/11/22/presente-de-aniversario/</guid><category>A day in the life</category></item><item><title>PETAR</title><link>https://blog.luizirber.org/2008/10/22/petar/</link><description>&lt;p&gt;Fim de semana emocionante. No sábado de manhã fomos eu, Maja (a croata
que esteve morando com a gente por dois meses, fazendo intercâmbio em
Sanca) e a Stéfanie (a vizinha) para o &lt;a href="http://www.petaronline.com.br/"&gt;PETAR&lt;/a&gt;, a convite do Sinfa.
Saímos bem cedo de São Carlos, cinco da manhã, passamos por São Paulo
para encontrar o Sinfa e a namorada dele, e depois vamos em direção ao
parque. Que, como fica na região sul de São Paulo, é longe pra dedéu.
Chegamos lá só às quatro e tanto da tarde.&lt;/p&gt;
&lt;p&gt;Mas já chegamos preocupados. Ao sair de São Carlos o tempo estava
quente, chegando em Sampa chovia, e quanto mais para o sul íamos, mais a
chuva castigava. E, ao chegar no PETAR, ela não tinha parado. Péssimo
sinal, tínhamos poucas roupas para frio, e estávamos indo para o núcleo
mais isolado e selvagem do lugar, o &lt;a href="http://www.petaronline.com.br/caboclos.htm"&gt;Caboclos&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Depois de sacolejar por mais uma hora em estradas de chão batido,
chegamos ao local do acampamento. Várias cabanas, mas todas reservadas
para pesquisadores. Vamos dar uma olhada no local do camping, e meus
ossos já ficam gelados só de imaginar como vai ser a noite...&lt;/p&gt;
&lt;p&gt;Eu e a Maja montamos rapidinho a barraca onde eu, ela e a Stéfanie vamos
dormir, e depois vamos ajudar o Sinfa a montar a dele e da namorada
(que, por sinal, é bem maior). Mais uns 20 minutos, e estamos
suficientemente ensopados para começar a amaldiçoar a viagem. Ah, que
vontade de estar em casa, assistindo a um filminho e comendo pipoca...&lt;/p&gt;
&lt;p&gt;Mas como diz o sábio, já que tá que vá. Jantamos, e quando começamos a
nos ajeitar para dormir, percebemos que a nossa barraca não é tão
impermeável assim. Começamos a discutir seriamente a possibilidade de
seguir viagem e ir para Curitiba. Mas antes que a situação piore, vamos
todos para a barraca do Sinfa, e lá jogamos um pouco de truco antes de
ir dormir (eu e Maja ganhamos, apesar de eu quase nunca jogar e de ser a
primeira vez dela jogando =] )&lt;/p&gt;
&lt;p&gt;No domingo de manhã somos acordados pela chegada do guia, mas a vontade
de sair da cama era nula. Eu e a Stéfanie já tínhamos idéia de onde nos
metemos, e somos contra seguir com a trilha planejada, até porque
demoraríamos demais para ir embora e chegaríamos muito tarde em São
Carlos. Mas a Maja ainda achava que seria uma trilha bem aberta e
tranquila, com uma caverna acessível. Como eram 3 votos contra 2, vamos
todos fazer a trilha.&lt;/p&gt;
&lt;p&gt;Como eu sou um simplório, me diverti horrores. Cada vez que eu
escorregava e caia na lama eu dava risada, possivelmente pela insanidade
da coisa. E situações dessas são ótimas para deixar o humor negro e a
ironia aflorar, então eu e a Stéfanie estávamos impossíveis. Pena que o
guia não entendia metade das piadas que a gente fazia.&lt;/p&gt;
&lt;p&gt;Aliás, o guia. Ele fez curso técnico em mecatrônica, mas enquanto não
arranja um emprego trabalha no PETAR como guia. Ele deu umas explicações
que deixariam cientistas de cabelo em pé (destaque para o Bagre Cego),
mas era gente fina. E comentou, em certo ponto, que achou que nós
seríamos um grupo de aventureiros experientes loucões, por querer ir na
chuva na trilha mais difícil do parque. HAH! Um computeiro, uma croata
que nunca viu mato na vida, e uma anêmica? Loucos com certeza,
aventureiros contra a vontade, mas experientes nunca...&lt;/p&gt;
&lt;p&gt;Depois de três horas de muitos tombos, arranhões e lama, chegamos até a
caverna. Para descobrir que não podemos entrar, porque o rio está muito
alto. Sem muitas opções, começamos a volta, agora por outro lado.
Atravessamos o rio duas vezes (na segunda, muita correnteza), subimos
uma encosta íngreme auxiliados por cordas, e cada vez mais me sinto um
escoteirinho. O guia não está dando muita bola, mas a Maja e a Stéfanie
estão exaustas, e várias vezes tenho que ajudá-las a atravessar alguns
pontos. Aliás, é admirável a calma do guia: em vários pontos um
escorregão levaria a uma queda beeeem horrenda, pelo menos uns 30 metros
rolando ribanceira abaixo, e ele nem aí.&lt;/p&gt;
&lt;p&gt;Perto do fim, a coisa está realmente feia. Maja desesperada porque vai
ficar doente (err, e realmente ficou...), Stéfanie com hipoglicemia,
Leandro e namorada um pouco mais atrás de nós. E eu? Sei lá de onde, mas
ainda com energia para seguir adiante. Que dizer, sei sim, mas isso é
assunto para outro post. Por mais que tenha sido uma roubada, que a
gente tivesse que tomar banho frio logo depois (energia elétrica? pfff),
que tívessemos que voltar para Sanca dividindo o único par de tênis
limpos, eu estava me divertindo. Nada melhor do que rir de nós mesmos =D&lt;/p&gt;
&lt;p&gt;Na segunda nem consegui ir trabalhar, foi muito difícil simplesmente
sair da cama. Acho que a adrenalina da hora não deixou perceber que eu
estava me estropiando todo.&lt;/p&gt;
&lt;p&gt;Portanto, recomendações: Se for ao PETAR, comece pela caverna de
Santana, e depois se arrisque nas mais selvagens. Vale a pena, mas evite
ir na chuva! =D&lt;/p&gt;
&lt;p&gt;UPDATE: já que tive um comentário ilustre por parte da Stéfanie, fique
explicado que:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Ela ajudou a pregar no chão e a por a cobertura. Portanto, ajudou na
montagem da nossa barraca.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Sim, eu fiquei a maior parte do tempo atrás dela. Ou seja, não fui
de muita ajuda para ela (só quando ela escorregava e quase caia no chão,
já no final da trilha). Ah, e também quando ela tava com hipoglicemia,
servindo Negresco e dando apoio. Portanto, meu lado escoteirinho
auxiliador apareceu mais para a Maja e, às vezes, pra namorada do Sinfa.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;E ela sabe muito bem de onde eu tirei energia =]&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Wed, 22 Oct 2008 18:01:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2008-10-22:/2008/10/22/petar/</guid><category>A day in the life</category><category>aventura</category><category>caverna</category><category>lama</category><category>PETAR</category><category>tombo</category><category>trilha</category></item><item><title>#iphonedev-br</title><link>https://blog.luizirber.org/2008/09/30/iphonedev-br/</link><description>&lt;p&gt;Buenas. Estava eu no #python-br quando o &lt;a href="http://elyezer.com/"&gt;Elyézer&lt;/a&gt; perguntou algo
sobre Python e Objective-C. Indiquei o PyObjC, e ele perguntou se ele
estava disponível no iPhone. Hmm, não está.&lt;/p&gt;
&lt;p&gt;Mas achei mais alguém desenvolvendo pra iPhone!&lt;/p&gt;
&lt;p&gt;Antes que ficasse off-topic demais pra #python-br, fomos para o canal
#iphonedev-br no Freenode. E agora precisamos popularizá-lo!&lt;/p&gt;
&lt;p&gt;Então, se você procura por um lugar em português para discutir as
agruras do Objective C (que, na minha opinião, é beeeem melhor que C++
...), apareça no #iphonedev-br @ irc.freenode.org .&lt;/p&gt;
&lt;p&gt;UPDATE: Se você não tem um cliente IRC instalado, o &lt;a href="http://mibbit.com/"&gt;mibbit&lt;/a&gt; pode te
salvar. Dica do &lt;a href="http://ayharano.wordpress.com/"&gt;Frank&lt;/a&gt;!&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Tue, 30 Sep 2008 05:14:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2008-09-30:/2008/09/30/iphonedev-br/</guid><category>Projetos</category><category>brazil</category><category>dev</category><category>iphone</category><category>irc</category></item><item><title>Minha primeira hackeada</title><link>https://blog.luizirber.org/2008/08/10/minha-primeira-hackeada/</link><description>&lt;p&gt;Memes de internet são como powerpoints no email: você pode até seguí-los
ou lê-los, mas não deve repassar adiante essas pragas. Como o &lt;a href="http://vainalousachefe.wordpress.com/2008/07/31/minha-primeira-hackeada/" title="Vai na Lousa, Chéééééoééfe!"&gt;GG&lt;/a&gt;
levantou a bola vou chutá-la, mas não recomendo que mais ninguém faça o
mesmo! =D&lt;/p&gt;
&lt;p&gt;Minha primeira hackeada? O primeiro computador lá de casa era um 286,
comprado em 1993. Só rodava um editor de texto chamado Pangloss, e um
misto de agenda, organizador pessoal e planilha chamado Every. E sei lá
como, eu ainda conseguia me divertir com a bagaça. A minha mãe arranjou
um curso de informática do Banco do Brasil chamado INFO2000, que
ensinava enquanto contava uma historinha muito legalzinha sobre um
viajante espacial.&lt;/p&gt;
&lt;p&gt;E todos os softwares citados são tão velhos ou obscuros que não achei
nada no Google sobre eles. Vou tentar recuperá-los da próxima vez que
for para casa e achar mais informações.&lt;/p&gt;
&lt;p&gt;Um dia meu primo levou 'Outrun' e 'Prince of Persia' em dois disquetes.
E daí eu tive bastante o que fazer =D&lt;/p&gt;
&lt;p&gt;Mas, hackeada mesmo, eu lembro que só fui fazer em um 486, em 1994. Um
amigo meu trouxe vários Commander Keen (2, 3 e 5, se não me engano), e
eu fiz um .BAT com um menu para acessar os jogos. Inútil, mas foi meu
primeiro 'shell script': tinha que imprimir mensagens, ler a entrada do
usuário, e executar o jogo correto.&lt;/p&gt;
&lt;p&gt;Além disso, eu lembro que tive que fuçar várias vezes no CONFIG.SYS e no
AUTOEXEC.BAT para desabilitar algumas coisas a fim de liberar memória
(ah, os saudosos 640KB...) para algum jogo. Pra quem tinha nove anos na
época e não tinha com quem aprender, até que está bom, né?&lt;/p&gt;
&lt;p&gt;Uma outra história interessante: quando eu ia na quarta série as freiras
do meu colégio compraram um computador e deixaram na secretaria. E,
certo dia, a secretária foi me chamar na sala de aula, porque não estava
conseguindo fazer algo (não lembro o quê, fazem 14 anos, oras!). Fui lá,
resolvi, e voltei para a aula. Suporte técnico desde criança, hehehe.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Sun, 10 Aug 2008 10:27:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2008-08-10:/2008/08/10/minha-primeira-hackeada/</guid><category>A day in the life</category></item><item><title>Dia do Amigo</title><link>https://blog.luizirber.org/2008/07/20/dia-do-amigo/</link><description>&lt;p&gt;&lt;img class="center" src="/images/20072008278-001.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Às vezes dá vontade de fazer um blog só com tirinhas do Liniers, mas daí
eu lembro que você sempre pode ir no site da &lt;a href="http://www.livrariacultura.com.br/scripts/cultura/catalogo/busca.asp?tipo_pesq=titulo&amp;amp;palavra=macanudo&amp;amp;topo=livro&amp;amp;sid=01351501910720655571867732&amp;amp;k5=259E5B04&amp;amp;uid=&amp;amp;lastreg=&amp;amp;parceiro=121233"&gt;Cultura&lt;/a&gt; e comprar as
coletâneas. Tá esperando o quê?&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Sun, 20 Jul 2008 18:03:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2008-07-20:/2008/07/20/dia-do-amigo/</guid><category>A day in the life</category></item><item><title>Herbie Hancock</title><link>https://blog.luizirber.org/2008/06/02/herbie-hancock/</link><description>&lt;p&gt;&lt;img class="center" src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/Herbie_hancock.jpg/600px-Herbie_hancock.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Fui no show dele ontem, no Parque Villa-Lobos. Muito bom, apesar de eu
conhecer muito pouco de sua carreira.&lt;/p&gt;
&lt;p&gt;Mas, o que eu realmente queria dizer é que poucas vezes me senti tão
nerd. Eu ouvia ele tocando e lembrava da trilha sonora do
&lt;a href="http://en.wikipedia.org/wiki/Transport_Tycoon"&gt;Transport Tycoon&lt;/a&gt; =D&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Mon, 02 Jun 2008 14:28:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2008-06-02:/2008/06/02/herbie-hancock/</guid><category>Games, roque enrow</category></item><item><title>Crônicas da Fundação</title><link>https://blog.luizirber.org/2008/05/25/cronicas-da-fundacao/</link><description>&lt;blockquote&gt;
&lt;p&gt;Você é uma criatura complexa, Dors, e não tenho respostas simples para
lhe oferecer. Na minha vida, conheci vários indivíduos em cuja
presença sentia-me melhor comigo mesmo. Tentei comparar o prazer que
sentira na presença dessas pessoas com a tristeza que senti quando
elas finalmente se foram, para saber se o saldo tinha sido positivo ou
negativo. Cheguei à conclusão de que o prazer de sua companhia
superava de longe a tristeza de sua perda. Minha conclusão, portanto,
é de que o que está experimentado agora fará bem a você.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Crônicas da Fundação, Isaac Asimov.&lt;/p&gt;
&lt;p&gt;Agora só falta "A Fundação e a Terra", vou completar a leitura da série
antes de comentar. Por enquanto, fiquem com outra citação =D&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Sun, 25 May 2008 12:18:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2008-05-25:/2008/05/25/cronicas-da-fundacao/</guid><category>Livros</category></item><item><title>Zone of the Enders</title><link>https://blog.luizirber.org/2008/05/23/zone-of-the-enders/</link><description>&lt;p&gt;&lt;img class="left" src="/images/jehuty1.jpg" width="195"&gt;&lt;/p&gt;
&lt;p&gt;Como comentado a alguns posts atrás, comprei um PS2. E, assim,
começou a busca por bons jogos.&lt;/p&gt;
&lt;p&gt;Eu sempre li vários blogs de jogos, mas mais por curiosidade sobre do
que necessidade de jogá-los. E a poucos dias, em um &lt;a href="http://continue.com.br/29/04/2008/kojima-abre-o-bico-enders-saindo-da-zona-do-esquecimento"&gt;deles&lt;/a&gt;,
comentaram sobre uma série produzida por Hideo Kojima, criador do Metal
Gear Solid, chamada &lt;a href="http://en.wikipedia.org/wiki/Zone_of_the_Enders"&gt;Zone of the Enders&lt;/a&gt;. Te colocar no controle de
robôs gigantes, no espaço, com várias armas diferentes? Sonho de
qualquer nerd que cresceu assistindo a &lt;a href="http://en.wikipedia.org/wiki/Choushinsei_Flashman"&gt;Flashman&lt;/a&gt; e que adora &lt;a href="http://en.wikipedia.org/wiki/Neon_Genesis_Evangelion_(TV_series)"&gt;EVA&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;O jogo citado era o segundo da série, mas resolvi
&lt;span style="text-decoration:line-through;"&gt;baixar&lt;/span&gt; começar pelo
primeiro, para não estragar a história. Aliás, é por isso que ainda não
comecei a jogar MGS, tenho que jogar o primeiro antes. Coloquei ele no
videogame, comecei, e é bonitão, ainda mais para um jogo de 2001. A
câmera é em terceira pessoa, logo atrás do
&lt;span style="text-decoration:line-through;"&gt;robô&lt;/span&gt; Orbital Frame, e
há liberdade completa de movimento, já que a maior parte do tempo você
fica voando, e não no chão.&lt;/p&gt;
&lt;p&gt;O jogo conta a história de Leo, um garoto que vê seus amigos serem
mortos por um Orbital Frame dos invasores de sua colônia. Durante a sua
fuga ele encontra um outro Orbital Frame, aparentemente abandonado, e
durante uma explosão cai dentro da cabine do OF e é reconhecido como o
piloto (ou Runner). A partir daí ele deve levar o OF para o movimento de
resistência, apesar de contra sua vontade, e conviver com o dilema de
matar outros seres humanos.&lt;/p&gt;
&lt;p&gt;Ou seja, basicamente é a história padrão de todas as histórias de
mechas. Mesmo que não seja revolucionária como EVA, a história flui bem.
Depois de cinco horas e pouco de jogo, chego até o ponto de encontro
para entregar o OF, e aparece Anubis, o OF gêmeo de Jehuty, OF que
pilotei até o momento. E tomo um piau desgraçado, mas só resta fugir,
porque Anubis é muito forte. Atlantis, a nave que levará Jehuty até
Marte, auxilia e consigo escapar. E começam os créditos.&lt;/p&gt;
&lt;p&gt;Não é a primeira vez que vejo os créditos aparecerem tão longe do começo
do jogo, então acompanho-os. Até que a tela fica preta, sobem mais
alguns e... o jogo reinicia. COMO ASSIM? Já é o fim do jogo? Tá certo
que não é um RPG, mas menos de seis horas de jogo? E deixando um gancho
desse tamanho?!? Como o jogo foi lançado junto com um demo de MGS:2,
fiquei com a péssima impressão de que ele foi feito só para tapar o
buraco do MGS:2, e se aproveitou disso para vender.&lt;/p&gt;
&lt;p&gt;Mas, então, porque investir em uma história tão boa, para abandoná-la
pela metade?&lt;/p&gt;
&lt;p&gt;Paciência. Já estou
&lt;span style="text-decoration:line-through;"&gt;baixando&lt;/span&gt;
providenciando o segundo, e este parece ser um pouco mais longo.
Felizmente, pelos &lt;a href="http://www.youtube.com/watch?v=K_B1x8E_mJc"&gt;vídeos no YouTube&lt;/a&gt;, a jogabilidade ainda é a mesma,
e os gráficos estão ainda melhores.&lt;/p&gt;
&lt;p&gt;&lt;img class="center" src="/images/zoe1.jpg" width="300"&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Fri, 23 May 2008 11:53:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2008-05-23:/2008/05/23/zone-of-the-enders/</guid><category>Games</category></item><item><title>Fundação</title><link>https://blog.luizirber.org/2008/05/12/fundacao/</link><description>&lt;blockquote&gt;
&lt;p&gt;A linguagem foi, originalmente, o expediente por meio do qual o Homem
aprendeu, imperfeitamente, a transmitir os pensamentos e emoções do
seu espírito. Erigindo sons arbitrários e combinações de sons como
representação de gradação de cores mentais, desenvolveu um método de
comunicação, porém um método que, na sua inabilidade e pesada
inadequação, fez degenerar toda a delicadeza do espírito numa
transmissão grosseira e gutural de sinais.&lt;br&gt;
 Os resultados podem ser seguidos profundamente e todo o sofrimento
que a humanidade conheceu pode ser avaliado apenas pelo fato de nenhum
homem na história da Galáxia até &lt;a href="http://en.wikipedia.org/wiki/Hari_Seldon"&gt;Hari Seldon&lt;/a&gt;, e muito poucos
homens depois dele, ter conseguido compreender realmente outro homem.
Cada ser humano vivia atrás de uma parede impenetrável de névoa
sufocante, dentro da qual ninguém mais existia senão ele. Havia,
ocasionalmente, os sinais sumidos das profundidades da caverna em que
o outro homem estava metido, de modo que cada um podia caminhar às
apalpadelas na direção do outro. Contudo, por não se conhecerem uns
aos outros, não poderem compreender-se uns aos outros, não ousarem
confiar uns nos outros, e sentirem desde a infância os terrores e
insegurança desse isolamento definitivo, havia o medo da perseguição
do homem pelo homem, a rapacidade selvagem do homem para com o homem.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Isaac Asimov, Segunda Fundação.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Mon, 12 May 2008 14:53:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2008-05-12:/2008/05/12/fundacao/</guid><category>Livros</category></item><item><title>Okami</title><link>https://blog.luizirber.org/2008/05/03/okami/</link><description>&lt;p&gt;&lt;img class="left 150" src="/images/okami1.jpg"&gt;&lt;/p&gt;
&lt;p&gt;5 meses de silêncio. Não que eu tenha ido em retiro
espiritual, ou que não tenha acontecido nada dos últimos meses
(aconteceu muita coisa legal, com o tempo eu posto aqui), mas é que eu
sempre esqueço de escrever =D&lt;/p&gt;
&lt;p&gt;Mas hoje tem algo que vai quebrar meu silêncio. Na terça-feira chegou o
PS2 que eu comprei de um bixo. Meu primeiro videogame! Sim, você leu
corretamente, tive meu primeiro videogame com 22 anos!&lt;/p&gt;
&lt;p&gt;Na verdade, tem uma história legal sobre isso: quando eu era pequeno a
minha família foi visitar Foz do Iguaçu, e obviamente cruzamos a
fronteira para ir até Ciudad del Este. Lá, a minha mãe me fez uma
proposta: "O que tu prefere, um teclado musical ou um videogame?" . Como
toda boa criança consciente de seu potencial, respondi "Videogame!". E
ela me deu um teclado. Que, aliás, está até hoje encostado lá em casa.
Não que tenha me impedido de jogar, mais tarde eu ganhei um computador e
daí não teve jeito (ah, adventures da LucasArts...). Mas digresso.&lt;/p&gt;
&lt;p&gt;Hoje quero falar sobre um jogo chamado &lt;a href="http://www.capcom.com/okami/"&gt;Okami&lt;/a&gt;.  Ele foi desenvolvido
pelo &lt;a href="http://en.wikipedia.org/wiki/Clover_Studio"&gt;Clover Studio&lt;/a&gt; para o PS2, e conta a história de Okami
Amaterasu, um lobo que é a encarnação da deusa da mitologia japonesa
&lt;a href="http://en.wikipedia.org/wiki/Amaterasu"&gt;Amaterasu&lt;/a&gt;, e sua luta contra o monstro &lt;a href="http://en.wikipedia.org/wiki/Orochi"&gt;Orochi&lt;/a&gt;. Toda a história
do jogo segue a mitologia japonesa, e também a arte. Entre várias
características marcantes uma das mais interessantes é o uso de Cell
Shading, o que contribui muito para o impacto visual do jogo.&lt;/p&gt;
&lt;p&gt;Mas, apesar de ser de um nível técnico impressionante (existem poucos
jogos tão bonitos por aí, e isso no hardware do PS2, que nem é tão
poderoso assim hoje em dia), o que me chamou a atenção mesmo foi a
história. Muito bem escrita, com personagens cativantes e várias
referências a outras mitologias e culturas, pode-se perceber que muito
esforço foi dedicado ao roteiro, algo bem raro na indústria de
videogames.&lt;/p&gt;
&lt;p&gt;Para que? O Clover Studio sobreviveu durante dois anos, e foi fechado em
2006, porque não estava dando retorno financeiro. Por que as pessoas não
gostaram de Okami, apesar de toda a aclamação da crítica?&lt;/p&gt;
&lt;p&gt;O maior defeito, a meu ver, é o início do jogo. São quase 20 minutos
fazendo a introdução da história, e isso para os consumidores ávidos por
ação de hoje em dia é insuportável. E nem se tem a opção de pular a
introdução. Eu entendo porque eles fizeram isso, porque realmente é
importante para a história, mas o mundo não é muito paciente.&lt;/p&gt;
&lt;p&gt;Azar de quem não tem paciência, perderam um dos jogos com a jogabilidade
mais curiosa que já vi. Existem 13 Brush Gods no jogo, e cada um
possibilita o uso de uma técnica diferente. Para aplicar essa técnica,
você pára o jogo e aparece uma tela de pintura, e usa o controle
analógico para desenhar na tela. Um risco horizontal faz um corte, dois
riscos tornam o tempo mais lento, um símbolo de infinito gera fogo. É
simplesmente genial, e torna o jogo extremamente divertido.&lt;/p&gt;
&lt;p&gt;O final até dá certas esperanças de uma continuação, mas infelizmente o
Clover foi fechado logo após o lançamento do jogo. Uma pena, mas fica a
lição final dada pelo narrador ao término do jogo, que realmente mostra
uma preocupação que deveria ser mais recorrente na indústria dos
videogames.&lt;/p&gt;
&lt;p&gt;Apesar do Clover ter fechado, a Capcom portou o jogo para Wii e lançou-o
no dia 15 de abril, e com o Wiimote o uso dos poderes celestiais fica
muito mais interessante, porque você realmente usa o controle como um
pincel e desenha na tela, e não tem que usar o direcional analógico (que
é meio complicadinho às vezes...).&lt;/p&gt;
&lt;p&gt;Farewell, Okami!&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Sat, 03 May 2008 11:23:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2008-05-03:/2008/05/03/okami/</guid><category>Games</category></item><item><title>Feliz ano novo!</title><link>https://blog.luizirber.org/2008/01/01/feliz-ano-novo/</link><description>&lt;p&gt;&lt;img class="center" src="/images/7669141.jpg"&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Tue, 01 Jan 2008 07:02:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2008-01-01:/2008/01/01/feliz-ano-novo/</guid><category>A day in the life</category></item><item><title>Nicholas Was…</title><link>https://blog.luizirber.org/2007/12/24/nicholas-was/</link><description>&lt;blockquote&gt;
&lt;p&gt;older than sin, and his beard could grow no whiter. He wanted to
die.The dwarfish natives of the Arctic caverns did not speak his
language, but conversed in their own , twittering tongue, conducted
incomprehensible rituals, when they were not actually working in the
factories.&lt;/p&gt;
&lt;p&gt;Once every year they forced him, sobbing and protesting, into Endless
Night. During the journey he would stand near every child in the
world, leave one of the dwarves' invisible gifts by its bedside. The
children slept, frozen into time.&lt;/p&gt;
&lt;p&gt;He envied &lt;a href="http://en.wikipedia.org/wiki/Prometheus"&gt;Prometheus&lt;/a&gt; and &lt;a href="http://en.wikipedia.org/wiki/Loki"&gt;Loki&lt;/a&gt;, &lt;a href="http://en.wikipedia.org/wiki/Sisyphus"&gt;Sisyphus&lt;/a&gt; and &lt;a href="http://en.wikipedia.org/wiki/Judas_Iscariot"&gt;Judas&lt;/a&gt;. His
punishment was harsher.&lt;/p&gt;
&lt;p&gt;Ho.&lt;/p&gt;
&lt;p&gt;Ho.&lt;/p&gt;
&lt;p&gt;Ho.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="http://en.wikipedia.org/wiki/Neil_Gaiman"&gt;Neil Gaiman&lt;/a&gt;, &lt;a href="http://en.wikipedia.org/wiki/Smoke_and_Mirrors_%28book%29"&gt;Smoke and Mirrors&lt;/a&gt;. E um Feliz Natal! =D&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Mon, 24 Dec 2007 23:00:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-12-24:/2007/12/24/nicholas-was/</guid><category>Livros</category></item><item><title>Maestrograd</title><link>https://blog.luizirber.org/2007/12/19/maestrograd/</link><description>&lt;p&gt;&lt;a href="http://maestrograd.myminicity.com/"&gt;http://maestrograd.myminicity.com/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;O nome Maestrograd surgiu quando eu precisei fazer um repositório para
meus trabalhos de graduação (Maestro + Graduação = Maestrograd). Mas é
um nome tão legal, parece uma cidade da URSS...&lt;/p&gt;
&lt;p&gt;Então, aproveitando o tal My Mini City, resolvi fazer uma cidade! Ela
fica no Brasil, mas como não dá para especificar exatamente onde lá no
site, resolvi explicar aqui. Fica no noroeste gaúcho, perto de Três de
Maio (e isso explica porque tem tão poucos habitantes =] ), e é o último
refúgio dos comunistas russos no mundo. Ahm, pelo jeito, dos comunistas
russos ORIGINAIS, 1917 style, porque não tem quase ninguém lá =D&lt;/p&gt;
&lt;p&gt;Se você é um comunista russo, venha para nossa utópica terrinha! Venha
morar em Maestrograd!&lt;/p&gt;
&lt;p&gt;(Bah, que baita idéia a desses caras do MyMiniCity. Estupidamente
simples, estupidamente legal).&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Wed, 19 Dec 2007 00:47:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-12-19:/2007/12/19/maestrograd/</guid><category>Silly</category></item><item><title>Livro de auto-ajuda?</title><link>https://blog.luizirber.org/2007/11/20/livro-de-auto-ajuda/</link><description>&lt;blockquote&gt;
&lt;p&gt;Nevertheless, this algorithm is slower, more complicated, more
expensive, and less robust than the original centralized one. Why
bother studying it under these conditions? (...) &lt;strong&gt;Finally, like
eating spinach and learning Latin in high school, some things are said
to be good for you in some abstract way&lt;/strong&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Andrew Tanenbaum, Distributed Operating Systems. Às vezes o rapaz viaja
um pouco no meio das explicações =D&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Tue, 20 Nov 2007 01:04:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-11-20:/2007/11/20/livro-de-auto-ajuda/</guid><category>universidade</category></item><item><title>When yer 22</title><link>https://blog.luizirber.org/2007/11/17/when-yer-22/</link><description>&lt;p&gt;Stuck in the perpetual motion&lt;br&gt;
Dying against the machine&lt;br&gt;
The whole thing leaves&lt;br&gt;
You a nothing instead of a these&lt;br&gt;
The sun is black and the black halos fly&lt;br&gt;
And your number is backwards again when you try&lt;br&gt;
The sound is so cute when you're 22&lt;br&gt;
When you're 22&lt;/p&gt;
&lt;p&gt;Eggs break when you walk on the scramble&lt;br&gt;
You're living against the machine&lt;br&gt;
The whole thing leaves&lt;br&gt;
You a nothing instead of a these&lt;br&gt;
The bone is cracked and the cracked eggshells fly&lt;br&gt;
And your number is backwards again when you drive&lt;br&gt;
The whole thing's removed when you're 22&lt;br&gt;
When you're 22&lt;/p&gt;
&lt;p&gt;Nada a ver, mas não é todo dia que se faz aniversário e a idade bate com
a música de uma de suas &lt;a href="http://www.flaminglips.com"&gt;bandas preferidas&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;E isto também é um teste da adulteração de posts do wordpress, já que eu
não tinha internet dia 17 e postei isso no dia 19.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Sat, 17 Nov 2007 20:04:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-11-17:/2007/11/17/when-yer-22/</guid><category>A day in the life</category></item><item><title>Piada Nerd Infame do dia</title><link>https://blog.luizirber.org/2007/11/02/piada-nerd-infame-do-dia/</link><description>&lt;p&gt;Pelos poderes do GREP, eu sou...&lt;/p&gt;
&lt;p&gt;RE-MAN!&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Fri, 02 Nov 2007 20:50:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-11-02:/2007/11/02/piada-nerd-infame-do-dia/</guid><category>Silly</category></item><item><title>O fim da infância</title><link>https://blog.luizirber.org/2007/11/02/o-fim-da-infancia/</link><description>&lt;blockquote&gt;
&lt;p&gt;Havia, é claro, alguns vadios, mas o número de pessoas com a força de
vontade necessária para viver em completa ociosidade é muito menor do
que geralmente se supõe. Manter esses parasitas custava muito menos do
que sustentar os exércitos e coletores de bilhetes, empregados de
lojas, funcionários de bancos, corretores, etc., cuja principal
função, do ponto de vista global, era transladar itens de um livro
para outro.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Arthur C. Clarke, "O fim da infância", 1953.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Fri, 02 Nov 2007 20:41:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-11-02:/2007/11/02/o-fim-da-infancia/</guid><category>Livros</category></item><item><title>Matemática Concreta</title><link>https://blog.luizirber.org/2007/10/19/matematica-concreta/</link><description>&lt;p&gt;Aqui em São Carlos tem um sebo muito legal chamado Outros Contos. Eu
costumo ir pelo menos uma vez por mês lá, e ontem foi uma dessas idas.
Mas o sebo tinha mudado de local!&lt;/p&gt;
&lt;p&gt;Após muitas voltas, eu e o Frank achamos o novo lugar. Parece que a casa
onde ele ficava antigamente corria risco de desabamento, e fazia uma
semana que ele tinha reaberto. Depois de circular um pouco lá por
dentro, deu pra notar que ainda estava um tanto quanto desorganizado
(apesar de sebo desorganizado ser pleonasmo =D), mas ainda assim
consegui achar um Terry Pratchett novinho por R$ 10. Quando estávamos
quase indo embora, o Frank me aparece com um livro na mão. "Olha, é do
Knuth". Meu queixo quase caiu no chão.&lt;/p&gt;
&lt;p&gt;Não era nenhum volume do The Art of Programming, pois já seria pedir
demais. Era uma edição em português do Concrete Mathematics, um livro
que eu já tinha achado na biblioteca da USP e estava querendo comprar a
tempos. O problema é que o &lt;a href="http://www.amazon.com/Concrete-Mathematics-Foundation-Computer-Science/dp/0201558025/ref=pd_bbs_sr_1/105-2191388-3077258?ie=UTF8&amp;amp;s=books&amp;amp;qid=1192826225&amp;amp;sr=8-1"&gt;original americano&lt;/a&gt; custa US$ 55.29 na
Amazon, e meu bolso não aguenta uma compra dessas. Eu dei uma olhada e
devolvi pro Frank, pensando que ele fosse levar, mas ele virou-se e foi
recolocar ele no lugar.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Peraí, tu não vai levar? - Disse eu.  &lt;/li&gt;
&lt;li&gt;Não.  &lt;/li&gt;
&lt;li&gt;ENTÃO DÁ AQUI QUE EU LEVO!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;(Não foi tão gritado assim, mas quase =D). Fazia quase dois anos que ele
estava lá, mas eu nunca tinha visto. Lição: Não pulem a seção de
matemática só porque tem vários Lethoud lá.&lt;/p&gt;
&lt;p&gt;Agora tenho que começar a fazer os exercícios, por enquanto só li o
capítulo inicial. E obrigado mais uma vez, Frank! =D&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Fri, 19 Oct 2007 20:43:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-10-19:/2007/10/19/matematica-concreta/</guid><category>Livros</category></item><item><title>I gave my heart to a simple chord</title><link>https://blog.luizirber.org/2007/10/13/i-gave-my-heart-to-a-simple-chord/</link><description>&lt;blockquote&gt;
&lt;p&gt;People worry about kids playing with guns, and teenagers watching
violent videos; we are scared that some sort of culture of violence
will take them over. Nobody worries about kids listening to thousands
- literally thousands - of songs about broken hearts and rejection and
pain and misery and loss. The unhappiest people I know, romantically
speaking, are the ones who like pop music the most; and I don't know
whether pop music had caused this unhappiness, but I know that they've
been listening to sad songs longer than they've been living the
unhappy lives.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="http://en.wikipedia.org/wiki/High_Fidelity_%28novel%29"&gt;High Fidelity&lt;/a&gt;, by &lt;a href="http://en.wikipedia.org/wiki/Nick_Hornby"&gt;Nick Hornby&lt;/a&gt;.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Sat, 13 Oct 2007 03:25:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-10-13:/2007/10/13/i-gave-my-heart-to-a-simple-chord/</guid><category>Livros</category></item><item><title>Quase lá</title><link>https://blog.luizirber.org/2007/08/07/quase-la/</link><description>&lt;p&gt;&lt;a href="http://mingle2.com/geek-quiz"&gt;80% Geek&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Dica do &lt;a href="http://palacehotel.blogspot.com"&gt;André&lt;/a&gt;.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Tue, 07 Aug 2007 22:02:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-08-07:/2007/08/07/quase-la/</guid><category>Silly</category></item><item><title>Dia da Toalha!</title><link>https://blog.luizirber.org/2007/05/25/dia-da-toalha/</link><description>&lt;p&gt;&lt;a href="http://www.flickr.com/photos/luizirber/sets/72157600266409006/detail/"&gt;&lt;img class="center" src="https://farm1.static.flickr.com/198/513954323_d0936294fd.jpg"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Hoje comemorou-se mais um dia da toalha, homenagem dos fãs de Douglas
Adams à sua obra. Para mais algumas fotos tiradas durante o dia (ééé,
dessa vez fiquei com a toalha do meu lado o dia inteiro =D), cliquem na
foto acima.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Fri, 25 May 2007 23:00:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-05-25:/2007/05/25/dia-da-toalha/</guid><category>A day in the life</category><category>Dia da toalha</category><category>towel day</category></item><item><title>Um fim de semana produtivo</title><link>https://blog.luizirber.org/2007/05/21/um-fim-de-semana-produtivo/</link><description>&lt;p&gt;Um screenshot vale mais que mil palavras:&lt;/p&gt;
&lt;p&gt;&lt;img class="center" src="/images/bugbrother-stats.jpg" title=""Ignorem os vales, valorizem os picos!"" alt=""Ignorem os vales, valorizem os picos!""&gt;&lt;/p&gt;
&lt;p&gt;Brinde: com preguiça de escrever aquele monte de macros e boilerplate
pra declarar um GObject? Use o &lt;a href="http://www.5z.com/jirka/gob.html"&gt;gob&lt;/a&gt;! Aparentemente ele tá sem
desenvolvimento ativo a algum tempo, mas funciona bem. Mas é claro que
você vai escrever o código direitinho quando tiver tempo, certo? ;-D&lt;/p&gt;
&lt;p&gt;Outro software interessantíssimo: &lt;a href="http://sourceforge.net/projects/g-inspector"&gt;G-Inspector&lt;/a&gt;. Esse faz mais tempo
ainda que tá sem desenvolvimento, mas também funciona muito bem. Permite
que você analise interfaces gráficas construídas com GTK+. Basta passar
o mouse em cima e ele indica nome, posição na memória, e se você olhar
direitinho, mais um monte de propriedades.&lt;/p&gt;
&lt;p&gt;Happy Hacking!&lt;/p&gt;
&lt;p&gt;P.S: Esperem sentados pela segunda parte do relato do FISL.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Mon, 21 May 2007 00:17:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-05-21:/2007/05/21/um-fim-de-semana-produtivo/</guid><category>Projetos</category></item><item><title>FISL 8.0 - Primeira parte</title><link>https://blog.luizirber.org/2007/04/13/fisl-80-primeira-parte/</link><description>&lt;p&gt;&lt;strong&gt;11.04&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Madrugada. Chegada em Porto Alegre. Táxi, casa da irmã, cama.&lt;br&gt;
Manhã. Ajeitar modem adsl e access point (que ninguém é de ferro,
oras). Depois, fazer a apresentação pro WSL.  &lt;/p&gt;
&lt;p&gt;Meio dia. Irmã em casa. Saímos para almoçar, micro-passeio pelo centro,
mega-refeição, R$7,50 buffet livre, com sobremesa (sorvete). Barriga
dói. Voltamos pro apartamento, passando antes na Toca do Disco (que está
fechada). Apresentação ainda em branco.  &lt;/p&gt;
&lt;p&gt;Lá pelas 4 e pouco da tarde. Indo pro aeroporto. Ônibus passa na frente
do apartamento e deixa na frente do aeroporto. Mordomia, exceto pelo
fato de que o ônibus parece que vai desmontar cara vez que pára (ar
condicionado, pelo jeito). Mais um tempinho esperando o avião chegar e
lá vem as manchinhas vermelha e preta. Eram &lt;a href="http://fabiocpn.wordpress.com"&gt;Pacu&lt;/a&gt; e &lt;a href="http://vainalousachefe.wordpress.com"&gt;GG&lt;/a&gt;, este
último em sua primeira viagem de avião. Apresentação ainda em branco.&lt;br&gt;
Noite. Conexão WiFi zoada (culpa do note do Pacu, que não suporta WPA).
Access point resetado, sem criptografia. Gambiarra é o nome da nova
rede. Pizza. Banho.  &lt;/p&gt;
&lt;p&gt;Apresentação ainda em branco. OpenOffice aberto, artigo aberto, a
canvas ainda em branco. Rola certa emoção, pensando que aquela brancura
toda significa um mundo sem limites para a minha criatividade.  &lt;/p&gt;
&lt;p&gt;Meia hora depois. Termino de ler os RSS atrasados. Apresentação ainda
em branco. Hum. Hora de trabalhar.  &lt;/p&gt;
&lt;p&gt;Mais meia hora. Apresentação aparentemente pronta. Algumas pequenas
melhorias na disposição do texto. Salvar em PDF, copiar pro 770, Cama.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;12.04&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;Manhã. Algumas acordadas durante a noite, carros passando na rua
pareciam chuva. Logo surge a preocupação de ter de tomar táxi até o
evento. Preocupação infundada, dia nublado mas nem sinal de chuva. Saída
cedo para ir ao local do evento, que fica longe.  &lt;/p&gt;
&lt;p&gt;Quinze para as nove. Palestra inicia às 10 horas da manhã, mas já
estamos com crachá na mão. Algumas pequenas verificações no conteúdo do
kit FISL, separar propagandas que não interessam, lixo.  &lt;/p&gt;
&lt;p&gt;Nove e meia. Entro no hall principal, e erro a sala da minha palestra.
D''oh. Depois de achar a sala certa, primeiro a chegar. Aguardar.  &lt;/p&gt;
&lt;p&gt;Dez e quinze. Chegam mais dois palestrantes. Nada da coordenação do
WSL. Mais alguns minutos e chega Marinho, coordenador do WSL, mas não da
mesa. Aguardar. Aparentemente primeiro palestrante não veio, logo devo
fazer a primeira. Copiar palestra do 770 pro note, abrir, aguardar
início.  &lt;/p&gt;
&lt;p&gt;Dez e meia. Agora vai. Início da palestra. Algumas gaguejadinhas,
coloco a mão no bolso antes de me dar conta que não é o recomendado.
Palestra flui bem. &lt;a href="http://www.gnome.org/~lucasr/"&gt;Lucas&lt;/a&gt; aparece na entrada, cumprimenta e tira uma
foto. Devolvo o cumprimento com um aceno de mão, o que deve ter parecido
estranho pra quem está assistindo à palestra (pouca gente, basicamente
Pacu e GG, &lt;a href="http://www.iei.org.br/~rafael/blog/"&gt;Petro&lt;/a&gt; e seu irmão e os palestrantes). Enrolo-me um pouco
no final, abro para perguntas. Nada. OK, acabou. Não foi tão difícil.  &lt;/p&gt;
&lt;p&gt;Meio dia. Almoço. Mesmo lugar do ano passado.  &lt;/p&gt;
&lt;p&gt;Meio da tarde. Descubro que Kurt Vonnegut morreu ontem, aos 84 anos.
Luto oficial.  &lt;/p&gt;
&lt;p&gt;Fim da tarde. Vamos embora. Passamos no cinema e assisitimos As Férias
de Mr. Bean. Seria tolo, se não fosse tão engraçado.  &lt;/p&gt;
&lt;p&gt;Noite. Torradas de janta. Um pouco de enrolação. Cama.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Fri, 13 Apr 2007 21:05:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-04-13:/2007/04/13/fisl-80-primeira-parte/</guid><category>FLOSS</category></item><item><title>Poeminha da aula de Redes</title><link>https://blog.luizirber.org/2007/03/20/poeminha-da-aula-de-redes/</link><description>&lt;p&gt;&lt;strong&gt;A Sincronia do Amor&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;- Mariazinha, eu te amo.&lt;br&gt;
- ACK.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Tue, 20 Mar 2007 22:34:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-03-20:/2007/03/20/poeminha-da-aula-de-redes/</guid><category>Silly</category></item><item><title>Café-da-manhã dos Campeões</title><link>https://blog.luizirber.org/2007/01/13/cafe-da-manha-dos-campeoes/</link><description>&lt;blockquote&gt;
&lt;p&gt;Conforme meu qüinquagésimo aniversário se aproximava, tornava-me mais
e mais enfurecido e assombrado pelas decisões estúpidas tomadas pelos
meus compatriotas. E então, de repente, comecei a sentir pena deles,
porque compreendi como para eles era inocente e natural se comportar
de modo tão abominável e com resultados tão abomináveis: estavam
fazendo o melhor possível para viverem pessoas inventadas em livros de
histórias. Este era o motivo pelo qual os americanos matavam uns aos
outros a tiro com tanta freqüência: era um truque literário
conveniente para terminar contos e livros.&lt;br&gt;
 Por que tantos americanos eram tratados por seus governos como se
suas vidas fossem descartáveis como lenços de papel? Porque era assim
que os autores costumavam tratar personagens menores em suas histórias
inventadas.&lt;br&gt;
 E assim por diante.&lt;br&gt;
 Depois que compreendi o que estava tornando a América uma nação tão
perigosa e infeliz, de pessoas que não tinham nada a ver com a vida
real, decidi me abster de contar histórias. Eu escreveria sobre a
vida. Cada pessoa seria exatamente tão importante quanto qualquer
outra. Todos os fatos também receberiam o mesmo peso. Nada seria
deixado de fora. Deixaria os outros trazerem ordem ao caos. Eu, em vez
disso, traria caos à ordem, o que acho que acabei fazendo.&lt;br&gt;
 Se todos os escritores fizessem isso, talvez os cidadãos fora dos
ofícios literários compreendessem que não há uma ordem no mundo ao
nosso redor, que, em vez disso, devemos nos adaptar às exigências do
caos.&lt;br&gt;
 É difícil se adaptar ao caos, mas é possível. Sou uma prova viva
disso: é possível&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Kurt Vonnegut, Café-da-manhã dos Campeões (Breakfast of Champions),
1973.&lt;/p&gt;
&lt;p&gt;Postando muitos partes de livros do Vonnegut ultimamente, mas essa não
tinha como passar.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Sat, 13 Jan 2007 03:24:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-01-13:/2007/01/13/cafe-da-manha-dos-campeoes/</guid><category>Livros</category></item><item><title>Os próximos quatro anos prometem</title><link>https://blog.luizirber.org/2007/01/06/os-proximos-quatro-anos-prometem/</link><description>&lt;p&gt;&lt;img class="center" src="/images/yeda.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Ah, viva o anti-petismo aqui no RS. O mandato dela nem tinha começado e
ela já tinha um projeto de reforma tributária engavetado pela
assembléia, e com o apoio do vice-governador.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Sat, 06 Jan 2007 02:23:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2007-01-06:/2007/01/06/os-proximos-quatro-anos-prometem/</guid><category>Silly</category></item><item><title>Show dos Lips, um ano depois</title><link>https://blog.luizirber.org/2006/11/26/show-dos-lips-um-ano-depois/</link><description>&lt;p&gt;A preguiça é a mãe da invenção. Ou não?&lt;/p&gt;
&lt;p&gt;Pra não precisar escrever tudo de novo, resgato um texto do finado
Notícias do LC. Quase melhor show da vida, se Wilco não tivesse sido tão
foda, um mês antes.&lt;/p&gt;
&lt;p&gt;Boa leitura.&lt;/p&gt;
&lt;p&gt;x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x&lt;br&gt;
Postado originalmente em 4 de dezembro de 2005&lt;br&gt;
x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x-x&lt;/p&gt;
&lt;p&gt;Preciso erguer um altar às empresas de telefonia celular. Primeiro, a
TIM, que traz Wilco. E agora, a Claro, que trouxe Stooges, Nine Inch
Nails e Flaming Lips. Minhas duas bandas favoritas (Wilco ganha por uns
milímetros de Flaming Lips) em menos de um mês. Viva o celular! (apesar
de dar câncer).&lt;/p&gt;
&lt;p&gt;Só falta confirmarem show do Radiohead na Argentina. E ainda tem Rolling
Stones e U2 no começo do ano que vem, sendo que RS deve ser de GRAÇA.
Que temporada. (UPDATE: parece que o show do Radiohead vai desmentido
pelo porta-voz da banda. pena).&lt;/p&gt;
&lt;p&gt;UPDATE MESMO: Eu fui no show dos Rolling Stones. Lero lero! =D&lt;/p&gt;
&lt;p&gt;Pois bem, o show do Wilco foi relatado na última edição. Ainda acho esse
o melhor show do ano, principalmente considerando o aspecto emocional. O
que aqueles caras fazem apenas com os instrumentos deles, sem telões,
sem luzes, sem pirotecnia, é sublime. O CQÉR, por outro lado, foi a
apologia do efeito especial. Flaming Lips e Nine Inch Nails que o digam.&lt;/p&gt;
&lt;p&gt;Para mim, o festival começou no início de outubro, quando os ingressos
foram postos à venda. Estava no primeiro dia no local de venda para
comprar o meu. Na verdade não houve necessidade para tanto desespero,
pois não foram vendidos todos os ingressos (mas nada próximo do que
houve no Rio, onde cambistas vendiam 3 ingressos por R\$10). Mas eu não
podiam conceber a possibilidade de perder o show dos Lips. Notem que, do
mesmo modo que o último Notícias, eu pareço uma fanzoca de Backstreet
Boys, ou qualquer outro tipo de banda que menininhas adoram quando
adolescentes e depois de alguns anos tem vergonha de assumir. E eu não
vejo problema nenhum nisso, primeiro porque não dá pra comparar uma
banda com a outra, e segundo porque eu realmente acredito que a música
pode ser muito mais poderosa do que alguns acreditam. Pode-se mudar o
mundo com a música? Não, seu hippie. Pode-se mudar pessoas tentando
convencê-las a escutar determinado tipo de música? Não, seu fascista,
música não pode ser impingida. Mas a música pode mudar as pessoas?
Podem, e como. E, portanto, eu não vejo nada de estranho, exdrúxulo ou
ridículo no que vem agora.&lt;/p&gt;
&lt;p&gt;Duas semanas atrás, uma semana antes do show, um dos caras que mora na
minha república veio todo feliz pedir para mim entrar no site da rádio
89fm para escutar o programa em que a banda dele participou. Enquanto
entro no site para baixar o programa, vejo uma promoção: "Suba no palco
com os Flaming Lips!". Fiquei entusiasmado. Para quem nunca ouviu falar
deles: é uma banda de Oklahoma, EUA, com uns 20 anos de estrada. Sempre
foram reconhecidos pelos shows anárquicos. Mas, nas turnês dos dois
últimos discos, eles transformaram o show deles em algo que pode ser
comparado a ~~um circo~~ uma festa de aniversário psicodélica: o
vocalista anda dentro de uma bolha de plástico pela platéia antes
do/span&gt; show, tem máquina de fumaça, bolhas, confetes e serpentinas e,
para completar, várias pessoas fantasiadas nas laterais do palco (mais
ou menos mega-bichinhos Parmalat). Fui correndo me cadastrar e já mandei
e-mail para um amigo meu de são paulo, o &lt;a href="http://palacehotel.blogspot.com"&gt;André&lt;/a&gt;, que é o maior fã da
banda que eu conheço (depois de mim). Eu não consegui me cadastrar
(problemas no site), mas não me estressei muito, eu sabia que o show ia
ser espetacular de qualquer jeito.&lt;/p&gt;
&lt;p&gt;Sábado de tarde, chego na casa do André para ir pro show, e ele já chega
falando que ganhou a promoção. Ele ia subir no palco! Eu fiquei um tanto
boquiaberto, mas todo mundo por lá comemorou bastante. Haviam no mínimo
20 pessoas na casa dele para ir ao show, a maioria uma galera aqui de
São Carlos que tinha sido colega no curso de imagem e som, mas também
tinham dois caras de Santa Cruz do Sul. Que fizeram eu me sentir
envergonhado de estar perdendo o sotaque. Droga.&lt;/p&gt;
&lt;p&gt;Cinco e pouco da tarde foi toda a patota pegar ônibus para chegar no
local do show (que era longe pra burro). Busão lotado, meia hora de
viagem, chegamos: estava rolando o show do Good Charlotte. Pena que
ainda não tinha terminado. O ponto de encontro com os organizadores da
89fm era num posto médico ao lado do palco, e a gente ficou por perto
até os caras aparecerem e o André ir junto. Quando os caras apareceram,
começamos a ir embora, mas eu e o perdido (visitem
&lt;a href="http://www.roqueealfredo.com.br/"&gt;www.roqueealfredo.com.br&lt;/a&gt; , criação dele) vimos que estava faltando
gente. "e se a gente tentasse subir no palco?". Lá fomos nós dois, e
mais 4 outras pessoas que tavam junto com a gente. A saber: pereira,
daniel, tati, amiga da tati (não sei o nome dela) e tiago. E não é que
os caras da 89 deixaram a gente entrar?&lt;/p&gt;
&lt;p&gt;Chegando atrás do palco, um papai noel magricelo veio nos recepcionar.
Era o responsável pelas fantasias. Enquanto a gente assinava um contrato
de imagem com a MTV (cedendo direitos, tomara que não tenha cedido a
alma também, nem li), aparece Wayne Coyne, vocalista da banda. Eu
cutuquei o André, e nossos queixos caíram no chão. Tivemos a típica
conversa de fã babão e ele completou, quando o André perguntou o que
devíamos fazer no palco: "Act like you were on drugs!".&lt;/p&gt;
&lt;p&gt;Pausa para a explicação da apologia: realmente é difícil acreditar que
Wayne não toma ácido, como ele afirma. Aparentemente ele é a pessoa que
mais acredita em felicidade no mundo, mas sem se deslumbrar. Exemplo:
numa entrevista publicada antes do show ele disse que seria uma
"celebração pré-fim do mundo". Então, já que o mundo vai acabar, "que
esse seja em grande estilo". E, numa de suas melhores músicas, "Do You
Realize??", sai uma estrofe fantástica:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;"Do you realize? That you have the most beautiful face?&lt;br&gt;
 Do you realize? We're floating in space?&lt;br&gt;
 Do you realize? That everyone you know someday will die...&lt;/p&gt;
&lt;p&gt;And instead of saying all your goodbyes, let them know&lt;br&gt;
 You realize that life goes fast,&lt;br&gt;
 It's hard to make the good things last,&lt;br&gt;
 You realize the sun don't go down&lt;br&gt;
 It's just an illusion caused by the world spinning round..."&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Desculpe, mas ao menos pra mim isso faz todo o sentido do mundo. E
continuemos.&lt;/p&gt;
&lt;p&gt;Wayne entra no camarim, nós vamos botar a fantasia. Tiago foi de gorila.
Daniel de elefante. Pereira de pinguim. Tati de jacaré. Fabi de
pintinho. Perdido de zebra. André de girafa. E eu de dálmata. Quando
nossa felicidade não podia ser maior, aparece alguém falando que tem
cerveja e água de graça. Sendo que elas custavam 4 reais a latinha e 3
reais o copo nos bares. Tem como ficar melhor? Tem.&lt;/p&gt;
&lt;p&gt;Termina o show do Fantomas, e somos chamados para subir no palco. Atrás
do telão, esperando pelo início, está Steven Drozd, multinstrumentista e
cérebro musical da banda. Vestido de papai noel, mas com enchimento,
então esse realmente parecia um papai noel. Vou lá conversar com ele, e
quanto mostro a mão para ele apertar, ele tem que segurar a garrafa de
cerveja e a de whiski na mesma mão. Bem, pra quem era viciado em heroína
e conseguiu largar o vício, até que não é muito. Ele perguntou como eu
conhecia a banda, e eu tive que explicar que infelizmente os cd's deles
só sairiam em dezembro (agora já saíram), e que eu conheci pela
internet. Nisso aparece um cara da produção e ele vai pro palco.&lt;/p&gt;
&lt;p&gt;Volto pro meu lado (à esquerda do palco), e todos nos preparamos. Wayne
sobe no palco, faz um discurso (com tradução em português) e pede para
todos contarem uma mentirinha no outro dia, dizendo que ele veio do
espaço. É a deixa para ele entrar na Bolha. Ele entra e sai rolando pela
platéia, e dá pra ver na cara das pessoas a felicidade brotando. Alguns
já compararam um show dos lips à primeira vez em que uma criança vai ao
circo. E eu concordo. Voltando ao palco, começa "Race for the Prize",
uma música que fala sobre dois cientistas em busca da cura de uma doença
que irá salvar a humanidade, e como o sacríficio deles influi na sua
vida pessoal. Maravilha. Logo depois, uma cover de Bohemian Rhapsody, do
Queen, que eles gravaram para um tributo. O maior karaokê do mundo,
fácil. A letra aparecia no telão e até pessoas que tinham preconceito
com o Queen, como eu, cantaram a plenos pulmões, mais alto que o próprio
Wayne (culpa da produção, que não conseguiu equalizar o som dos dois
palcos do mesmo jeito. toscos. felizmente eu tava do lado da caixa de
som, então ouvi tudo).&lt;/p&gt;
&lt;p&gt;Depois, "Fight Test". Essa fala sobre como nem sempre é possível fugir
das lutas da vida, e que às vezes é necessário enfrentá-las, sem estar
pronto pra enfrentá-las. E aí começou a bater o calor. Estava 15ºC, mas
dentro de uma fantasia de pelúcia tava muito mais que isso. Acho que
nunca suei tanto na vida. Sorte que tinha água atrás do telão. Pega a
água, toma, e volta a pular. O legal é que algumas cabeças era abertas,
e outras, como a minha, fechadas (não dava pra ver nada). Então a gente
começou a trocar de cabeças. Teve dálmata-girafa, elefante-pinguim,
zebra-macaco, um verdadeiro zoológico transgênico.&lt;/p&gt;
&lt;p&gt;E, finalmente, a minha preferida: "The Gash". O subtítulo dessa é
"Battle Hymn of the wounded mathematician". O refrão?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;"Will the fight for our sanity&lt;br&gt;
 Be the fight of our lives?&lt;br&gt;
 Now that we´ve lost all the reasons&lt;br&gt;
 That we thought that we had"&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Só não chorei porque não sou disso. Mas acho que nunca vi meu sorriso
maior. Depois, a música que batiza o último cd, "Yoshimi Battles the
Pink Robots". Uma música de amor? Sei lá, mas Wayne tentou fazer todo
mundo cantar junto, com um fantoche de freira na mão. E o povo cantou,
apesar de não saber o que se passava. Terminada a música, Wayne fala
sobre um presente que ganhou de um fã em Indiana, um tecladinho de
criança com sons de bichinhos. E acontece a "Cow Jam", basicamente Wayne
apertando alternadamente o botão da vaca e do pato e Steven mandando ver
na guitarra. Aliás, Steven dava um golão no whiski ao fim de toda
música.&lt;/p&gt;
&lt;p&gt;Chegando perto do fim do show, finalmente o maior hit deles, "She Don't
Use Jelly", de 1993. Essa fala sobre uma garota que prefere que seu
cabelo seja realmente laranja, então usa tangerinas para tingí-lo. Entre
outras loucuras. Não é minha preferida, mas tem um baita riff de
guitarra, grudento que só ele.&lt;/p&gt;
&lt;p&gt;O momento da apoteose: "Do You Realize??". Todos os bichinhos se
abraçando no palco e fazendo coro. Pelo menos os do lado esquerdo,
porque no lado direito tinha muita gente que nem sabia o que ia fazer
quando resolveu participar do sorteio. E pensar que tanta gente queria
estar lá e não pode. Tsc.&lt;/p&gt;
&lt;p&gt;Finalizando o show, Wayne faz um discurso criticando Bush e emendam "War
Pigs", do Black Sabbath. Primeira vez na história que um dálmata faz air
guitar, acho. E, pra tristeza de todo mundo, Wayne agradece e o show
acaba. O público pede mais, mas Stooges já vai começar no outro palco.
Saímos todos, devolvemos a fantasia, e vamos assistir ao próximo show,
todos ainda estranhamente quietos. Quando finalmente caiu a ficha do que
tínhamos acabado de fazer, foi impossível não notar os sorrisos de
satisfação na cara de todos. Que dia.&lt;/p&gt;
&lt;p&gt;E ainda aconteceu muita coisa boa. Stooges é a coisa mais roqueira que
existe no mundo. Iggy Pop, no alto de seus 58 anos, corre o palco
inteiro, simula sexo com o amplificador, não pára de pular e ainda causa
confusão quando pede que todos subam no palco. Deixa qualquer moleque no
chinelo, quem dirá os caras cheios de "atitude" que aparecem por aí.
*COF*Chorão*COF*. Tocaram todos os clássicos, centrando o repertório
nos dois primeiros discos. Ou seja, teve "Raw Power", teve "I wanna be
your dog", teve "TV eye", teve "No fun". e teve mais. E ainda xingou a
MTV, que tava filmando o show e a toda hora ligava as luzes. "Turn the
fucking lights on! I don't care about MTV! FUCK MTV!". Genial.&lt;/p&gt;
&lt;p&gt;Depois, Sonic Youth. Que eu não conhecia muito, mas que seria realmente
impressionante se o som não estivesse tão baixo. Quase não dava pra
escutar. Pau no cu da produção. E, por fim, Nine Inch Nails. Com o som
mais alto de todo o festival. Fechando a noite. 25 toneladas de efeitos
especiais no palco. E, simplesmente, a coisa mais pesada que eu já ouvi.
Qualquer banda de heavy metal fica no chinelo. Sendo que as músicas são
algo bem próximo de música eletrônica, mas com guitarras distorcidas.
Quase não dava pra ficar parado, a vontade de sair pulando foi grande,
mas o cansaço venceu. Já tava no bagaço. Mas, sem dúvida, show digno de
fechar o festival, e olha que o lendário Stooges tinha tocado antes
deles. Foda.&lt;/p&gt;
&lt;p&gt;E terminou. Cheguei na casa do meu tio às 6 horas da manhã, cansado, com
fome, sujo de lama (por que o show foi num gramado, e tinha chovido à
tarde). Mas feliz. Com certeza um dos melhores dias da minha vida. E
viva o rock!&lt;/p&gt;
&lt;p&gt;E chega. Cansei de escrever. Se quiserem saber mais, o andré publicou
suas memórias nesses links:  &lt;/p&gt;
&lt;p&gt;&lt;a href="http://palacehotel.blogspot.com/2005/11/oh-my-gawd-its-flaming-lips-claro-que.html"&gt;http://palacehotel.blogspot.com/2005/11/oh-my-gawd-its-flaming-lips-claro-que.html&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;&lt;a href="http://palacehotel.blogspot.com/2005/11/this-here-giraffe-laughed-claro-que_29.html"&gt;http://palacehotel.blogspot.com/2005/11/this-here-giraffe-laughed-claro-que_29.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;inclusive tem fotos. Eu acabei tendo sorte, apareci numa lado do
baixista, bem quando tinha baixado John Travolta fase Embalos de Sábado
à Noite.&lt;/p&gt;
&lt;p&gt;x-x-x-x-x-x-x-x-x-x-x-x-x-x-x&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Sun, 26 Nov 2006 21:35:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2006-11-26:/2006/11/26/show-dos-lips-um-ano-depois/</guid><category>roque enrow</category></item><item><title>O ópio do povo</title><link>https://blog.luizirber.org/2006/11/21/o-opio-do-povo/</link><description>&lt;blockquote&gt;
&lt;p&gt;Quanto às igrejas fechadas por Stalin e aquelas fechadas na China de
hoje: tal supressão da religião foi supostamente justificada pela
afirmação de Karl Marx de que "a religião é o ópio do povo". Marx
disse isso em 1844, quando o ópio e derivados do ópio eram os únicos
analgésicos eficazes que uma pessoa podia tomar. O próprio Marx os
havia tomado. E ficara agradecido pelo alívio temporário que lhe
deram. Estava simplesmente observando, e certamente não condenando, o
fato de que a religião também podia ser confortadora para pessoas em
dificuldades econômicas ou sociais. Era um truísmo casual, não um
ditame.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Kurt Vonnegut, "Um Homem Sem Pátria", 2006.&lt;/p&gt;
&lt;p&gt;Gênio. Além de ter escrito Matadouro 5 e Hocus Pocus, ainda nos
presenteia com esse belo livro que, apesar de conter apenas comentários
um tanto randômicos, são melhores que quase tudo que se publica hoje no
mundo.&lt;/p&gt;
&lt;p&gt;Salve Kurt Vonnegut!&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Tue, 21 Nov 2006 22:55:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2006-11-21:/2006/11/21/o-opio-do-povo/</guid><category>Livros</category></item><item><title>Planeta Comp@UFSCAR</title><link>https://blog.luizirber.org/2006/11/12/planeta-compufscar/</link><description>&lt;p&gt;Grande Pacu! Agora você que quer saber tudo sobre o que rola nos
bastidores da vida computeira ufscariana já tem onde encontrar!&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.comp.ufscar.br/~fcpn/planet/"&gt;Planeta Comp@UFSCAR&lt;/a&gt; !&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Sun, 12 Nov 2006 00:29:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2006-11-12:/2006/11/12/planeta-compufscar/</guid><category>universidade</category></item><item><title>Orkut + GTalk?</title><link>https://blog.luizirber.org/2006/11/07/orkut-gtalk/</link><description>&lt;p&gt;Tava navegando no orkut hoje e percebi, graças ao flashblock, que tinha
algum flash sendo carregado. Peraí, flash no orkut? Essa é nova.&lt;/p&gt;
&lt;p&gt;Aí fui dar uma olhada no código da página, e achei isso:&lt;br&gt;
&lt;a href="http://www.orkut.com/GoogleTalkSignup.aspx"&gt;http://www.orkut.com/GoogleTalkSignup.aspx&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Pra quem não quiser acessar, taí o screenshot:&lt;/p&gt;
&lt;p&gt;&lt;img class="center" src="/images/screenshot-orkut-google-talk-firefox.png"&gt;&lt;/p&gt;
&lt;p&gt;Agora sim as coisas começam a ficar interessantes...&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Tue, 07 Nov 2006 23:25:00 -0200</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2006-11-07:/2006/11/07/orkut-gtalk/</guid><category>Curioso</category></item><item><title>Algo não cheira bem…</title><link>https://blog.luizirber.org/2006/11/03/algo-nao-cheira-bem/</link><description>&lt;blockquote&gt;
&lt;p&gt;“Novell is actually just a proxy for its customers, and it's only for
its customers. This does not apply to any forms of Linux other than
Novell's SUSE Linux. And if people want to have patent peace and
interoperability, they'll look at Novell's SUSE Linux. If they make
other choices, they have all of the compliance and intellectual
property issues that are associated with that,” commented Steve
Ballmer.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="http://www.businessreviewonline.com/os/archives/2006/11/novell_and_micr.html"&gt;Fonte&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Será que a Microsoft abraçou a Novell (abraço de urso, diga-se) por
causa do anúncio da Oracle na semana passada?&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Fri, 03 Nov 2006 15:05:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2006-11-03:/2006/11/03/algo-nao-cheira-bem/</guid><category>FLOSS</category></item><item><title>Ubuntu Feisty Fawn</title><link>https://blog.luizirber.org/2006/11/03/ubuntu-feisty-fawn/</link><description>&lt;p&gt;Você, como eu, sente aflição quando uma distribuição baseada em Debian é
estabilizada e pára de atualizar a maior parte dos pacotes? Não se
importa de possivelmente deixar sua máquina imprestável?&lt;/p&gt;
&lt;p&gt;Desde ontem estão funcionando os repositórios do Feisty, a próxima
versão do Ubuntu. Basta trocar o "edgy" do sources.list por "feisty".&lt;/p&gt;
&lt;p&gt;A melhor justificativa que eu achei é: Já que muitos reclamam que o
upgrade de versões estáveis estraga algumas configurações, por que não
fazer o upgrade agora, que os repositórios do Feisty são praticamente
idênticos ao do Edgy, e ir fazendo o upgrade aos poucos? =D&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Fri, 03 Nov 2006 13:04:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2006-11-03:/2006/11/03/ubuntu-feisty-fawn/</guid><category>FLOSS</category></item><item><title>Stevey' Blog Rants</title><link>https://blog.luizirber.org/2006/11/02/stevey-blog-rants/</link><description>&lt;p&gt;Nada pra fazer no feriadão?&lt;/p&gt;
&lt;p&gt;&lt;a href="http://steve-yegge.blogspot.com/"&gt;Stevey' Blog Rants&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Vários artigos interessantes (principalmente estes sobre &lt;a href="http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html"&gt;Java&lt;/a&gt;,
&lt;a href="http://steve-yegge.blogspot.com/2006/09/good-agile-bad-agile_27.html"&gt;metodologias ágeis&lt;/a&gt; e a &lt;a href="http://steve-yegge.blogspot.com/2006/10/egomania-itself.html"&gt;resposta&lt;/a&gt; desse último post).&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Thu, 02 Nov 2006 21:49:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2006-11-02:/2006/11/02/stevey-blog-rants/</guid><category>Blogroll</category></item><item><title>BugBrother</title><link>https://blog.luizirber.org/2006/10/31/bugbrother/</link><description>&lt;p&gt;&lt;a href="http://sourceforge.net/projects/bugbrother"&gt;BugBrother&lt;/a&gt; é o protótipo (ou melhor, versão de desenvolvimento) do
programa que eu estou desenvolvendo na &lt;a href="http://www.cnpdia.embrapa.br/"&gt;Embrapa&lt;/a&gt;, o &lt;a href="http://repositorio.agrolivre.gov.br/projects/sacam"&gt;SACAM&lt;/a&gt;, que
significa Sistema de Análise Comportamental de Animais em Movimento. Sua
função, agora que a sigla é conhecida, é um tanto óbvia: Consiste em
capturar imagens de uma entrada de vídeo e aplicar algoritmos de
detecção de movimento, a fim de guardar uma trilha do movimento
realizado pelo animal. A partir dessa trilha e após definir áreas numa
imagem de referência é possível reportar estatísticas úteis para
estudos, realizados geralmente por entomólogos. O experimento básico
feito por eles é realizado com o auxílio de um olfatômetro em forma de
Y, onde o inseto é liberado no pé do Y e nas outras duas extremidades
são liberados feromônios ou outras substâncias. As estatísticas geradas
são úteis no estudo de novas armadilhas químicas para insetos, muito
menos danosas do que agrotóxicos.O funcionamento básico do programa
passa por essas etapas:  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Capturar a imagem de uma entrada de vídeo (atualmente qualquer
dispositivo compatível com Video4Linux)  &lt;/li&gt;
&lt;li&gt;Aplicar um algoritmo de detecção de movimento e guardar as
coordenadas (X,Y) geradas pelo movimento detectado.  &lt;/li&gt;
&lt;li&gt;A partir dessas coordenadas calcular parâmetros como tortuosidade,
desvio angular e velocidade do inseto analisado.  &lt;/li&gt;
&lt;li&gt;Gerar relatórios.  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Atualmente os dois primeiros itens estão funcionais, o terceiro está
próximo de ser terminado e o último começará a ser desenvolvido na
próxima semana.&lt;/p&gt;
&lt;p&gt;Um ponto que possa ter causado interesse: digo que é o protótipo pois no
momento ele está sendo desenvolvido usando &lt;a href="http://www.python.org"&gt;Python&lt;/a&gt; + &lt;a href="http://www.pygtk.org"&gt;PyGTK&lt;/a&gt; +
&lt;a href="http://www.gstreamer.org"&gt;GStreamer&lt;/a&gt;. Devido a problemas de desempenho (principalmente em
relação ao algoritmo de detecção) ele será implementado novamente, em C
+ &lt;a href="http://www.gtk.org"&gt;GTK+&lt;/a&gt; + &lt;a href="http://www.gstreamer.org"&gt;GStreamer&lt;/a&gt;, após a conclusão e avaliação do protótipo. O
que é uma pena, pois do ponto de vista de clareza de código e
reaproveitamento será um retrocesso. Mas a vida não é sempre o que a
gente quer =D&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Tue, 31 Oct 2006 22:44:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2006-10-31:/2006/10/31/bugbrother/</guid><category>Projetos</category></item><item><title>GStreamer</title><link>https://blog.luizirber.org/2006/10/25/gstreamer/</link><description>&lt;p&gt;No ano passado eu descobri um dos melhores livros que eu li na minha
vida, &lt;a href="http://fcpn.multiply.com/reviews/item/1"&gt;O Guia do Mochileiro das Galáxias&lt;/a&gt;, de Douglas Adams. Pouco
depois de terminar de ler (duas vezes) eu fiz uma busca por Douglas
Adams no Google. E um dos links retornados foi uma sessão de perguntas e
respostas do &lt;a href="http://slashdot.org/interviews/00/06/21/1217242.shtml"&gt;Ask Slashdot&lt;/a&gt;, onde ele fala sobre &lt;a href="http://www.cycling74.com/twiki/bin/view/FAQs/MaxMSPHistory"&gt;MAX&lt;/a&gt;, uma
linguagem de programação musical de alto nível orientada a objetos,
quando perguntaram sobre a obsessão do personagem Richard McDuff, do
livro Dirk Gently's Holistic Detective Agency, de mapear processos
naturais em música. Eu comecei a procurar por MAX e acabei achando que
seu criador, &lt;a href="http://www.crca.ucsd.edu/%7Emsp/"&gt;Miller Puckette&lt;/a&gt;, criou também o PureData, que faz o
mesmo e é open source.  &lt;/p&gt;
&lt;p&gt;Depois de algum tempo eu entendi como ele funcionava, e eu fiz algumas
coisinhas simples, mas eu não usei ele por muito tempo. E então eu
fiquei sabendo da existência do GStreamer. Apesar de algumas diferenças,
eu fiquei maravilhado com quão simples era fazer algumas coisas que eram
bem difíceis no PureData.  &lt;/p&gt;
&lt;p&gt;De fato, eu não sei como as coisas funcionam dentro do PureData, mas eu
realmente gostei de como o GStreamer foi feito: existem Elements, que
tem uma função específica, como ler dados de um arquivo, decodificar
dados ou mandar dados para uma placa de som; existem Bins, um container
para uma coleção de elementos, e Pipelines, um tipo especial de Bin que
permite a execução dos elementos contidos; e existem Pads, que são
usadas para negociar ligações e fluxo de dados entre elementos. E é só
isso. Com essas partes simples, todas juntas, coisas muito complexas
podem ser feitas, como o &lt;a href="http://www.flumotion.net/"&gt;Flumotion&lt;/a&gt;, um servidor de streaming, e o
&lt;a href="http://pitivi.sourceforge.net/"&gt;PITIVI&lt;/a&gt;, um editor não-linear de vídeo.E, claro, o grande
&lt;a href="http://sourceforge.net/projects/bugbrother/"&gt;BugBrother&lt;/a&gt;, o protótipo do programa que eu estou fazendo lá na
Embrapa. Mais sobre esse em outro post.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">luizirber</dc:creator><pubDate>Wed, 25 Oct 2006 02:11:00 -0300</pubDate><guid isPermaLink="false">tag:blog.luizirber.org,2006-10-25:/2006/10/25/gstreamer/</guid><category>FLOSS</category></item></channel></rss>